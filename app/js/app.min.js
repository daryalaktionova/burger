/* Overlay menu */

  
  let menu = (function(options) {

    let button = document.querySelector(options.button);
    let menu = document.querySelector(options.menu);
    let body = document.querySelector('body');
    let link = document.querySelectorAll(".overlay-menu__link");
    



    let _toggleMenu = function(e) {
      button.classList.toggle('hamburger-bar--active');
      menu.classList.toggle('overlay--open');
      body.classList.toggle('body-active-menu');
    }

    let addListeners = function() {
      button.addEventListener('click', _toggleMenu);
        for (i=0;i<link.length;i++){
          link[i].addEventListener('click', _toggleMenu);
        }
    }

    
    return {
        openMenu: addListeners
      };

  })({
    button: '#toggle',
    menu: '#overlay'
  });

  menu.openMenu();


/*end overlay menu */

/*Accodeon team*/
let teamAccordeon = (function() {

    let linkAccordeon = document.querySelectorAll('.accordeon__link');
    
    let forEachAccordeon = linkAccordeon.forEach(function(personName) {
    personName.addEventListener('click', function(e) {
          e.preventDefault();
          let activePerson = document.querySelector('.accordeon__item.accordeon__item--is-active');
          if(activePerson) {
            let teamAccordeonDetails = activePerson.querySelector('.accordeon-content');
            teamAccordeonDetails.style.height = "";
            activePerson.classList.remove('accordeon__item--is-active');
          }

          if(!activePerson || activePerson.linkAccordeon !== this) {
            let currentPerson = this.closest('.accordeon__item');
            currentPerson.classList.add('accordeon__item--is-active');
            let currentPersonInfo = currentPerson.querySelector('.accordeon-content');
            currentPersonInfo.style.height = currentPersonInfo.scrollHeight + 'px';
          }
        })
    })
  })

teamAccordeon();
/*end Accordeon team */

/* Start accordeon horizontal */
let menuAccordeon = (function() {

    let linkMenuAccordeon = document.querySelectorAll('.accordeon-menu__link');
    let userWidth = window.innerWidth;
    let list = document.querySelector('.accordeon-menu__list');
    let itemsList = list.querySelectorAll('.accordeon-menu__item');
		let titleItem = list.querySelector('.accordeon-menu__link');
		let widthTitle = titleItem.clientWidth;
		var neededWidth = userWidth - itemsList.length * widthTitle;
		neededWidth = (neededWidth > 520) ? '520px' : neededWidth + 'px';
    
    let forEachMenuAccordeon = linkMenuAccordeon.forEach(function(categoryName) {
    categoryName.addEventListener('click', function(e) {
          e.preventDefault();
          let activeCategory = document.querySelector('.accordeon-menu__item.accordeon-menu__item--is-active');
          if(activeCategory) {
            let menuAccordeonDetails = activeCategory.querySelector('.accordeon-menu__item-content');
            menuAccordeonDetails.style.width = "";
            activeCategory.classList.remove('accordeon-menu__item--is-active');
          }

          if(!activeCategory|| activeCategory.linkMenuAccordeon !== this) {
            let currentCategory = this.closest('.accordeon-menu__item');
            currentCategory.classList.add('accordeon-menu__item--is-active');
            let currentCategoryInfo = currentCategory.querySelector('.accordeon-menu__item-content');
            currentCategoryInfo.style.width = neededWidth;
          }
        })
    })
  })

menuAccordeon();

/*End accordeon horinzontal */



/* popup */
let popup = (function(options) {
	let wrapper = document.querySelector('.reviews__list');

	let _tooglePopup = (function(e) {
		e.preventDefault();

		if (e.target.className == options.button) {
			_openPopup(e.target);
		}
	});

	let _openPopup = (function(button){
		let overlay = document.createElement('div');
		overlay.classList.add('overlay');

		let popupWindow = document.createElement('div');
		popupWindow.classList.add('popup');

		let contentText = document.createElement('div');
		contentText.classList.add('popup__content');

		let content = button.parentNode;

		let text = content.querySelector(options.text).textContent;
	 

		let titleItem= document.createElement('div');
		titleItem.classList.add('popup__title');

		let title = content.querySelector(options.title).textContent;
		

    const xhr = new XMLHttpRequest();
    xhr.responseType = 'json';
    //xhr.open('GET', 'https://webdev-api.loftschool.com/sendmail/fail'); //для отрицательного ответа
    xhr.open('POST', 'http://test.local/mail.php');   //для положительного ответа
    xhr.send();
    xhr.addEventListener('load', () => {
      
      if(xhr.status>=400) {
          contentText.innerHTML = 'Ошибка отправки данных';
      } else {
        if(xhr.response.status) {
           contentText.innerHTML = text;
           titleItem.innerHTML = title;
          console.log(text);
      }
      }
    })

		let closeIcon = document.createElement("a");
		closeIcon.classList.add("popup__close");
		closeIcon.innerHTML = '<svg class="popup__close-image"><use xlink:href="./images/icons/sprite.svg#close"></use></svg>';
		closeIcon.href = "#";
		closeIcon.addEventListener("click", (function(e){
			e.preventDefault();
			_closePopup(overlay);
		}));

		overlay.appendChild(popupWindow);
		popupWindow.appendChild(titleItem);
		popupWindow.appendChild(contentText);
		popupWindow.appendChild(closeIcon);

		document.body.appendChild(overlay);
	});

	let _closePopup = (function(overlay) {
		document.body.removeChild(overlay);
	});

	let addListeners = (function() {
		wrapper.addEventListener('click', _tooglePopup)
	});

	return {
		init: addListeners
	}
});

popup({
	button: "reviews__button",
	title: ".reviews__title",
	text: ".reviews__text"
}).init();


/* end popup */

/* form*/
const myForm = document.querySelector('#myForm');
const send = document.querySelector('#send');


send.addEventListener('click', event => {
  event.preventDefault();

  const data = {
    name: myForm.elements.name.value,
    phone: myForm.elements.phone.value,
    comment: myForm.elements.comment.value,
    to: "segezmundovna@gmail.com"
  };

  const xhr = new XMLHttpRequest();
  xhr.responseType='json';
  xhr.open('POST', 'https://webdev-api.loftschool.com/sendmail');
  xhr.send(JSON.stringify(data));
  xhr.addEventListener('load', () => {
    if(xhr.response.status) {
      console.log(xhr.response.status);
    }
  });

});

/*end form */

/* start burger__composition */
let isMobile = () => {
  let screen = document.documentElement.clientWidth;
	let mobile = false;
	if(screen<=768){
    mobile = true;
  } 
	return mobile;
};

let mobileComposition = () => {
		let buttonComposition = document.querySelector('.burger__composition');
		let buttonCloseComposition = document.querySelector('.dropdown__close');

		buttonCloseComposition.addEventListener('click', e => {
			e.preventDefault();

			buttonComposition.classList.remove('active');
		});
		buttonCloseComposition.addEventListener('touchstart', e => {
			e.preventDefault();

			buttonComposition.classList.remove('active');
		});

		if (isMobile) {
			buttonComposition.addEventListener('click', e => {
				buttonComposition.classList.add('active');
			});
		}
		buttonComposition.addEventListener('mouseenter', e => {
			buttonComposition.classList.add('active');
		});

		buttonComposition.addEventListener('mouseleave', e => {
			buttonComposition.classList.remove('active');
		});
	};
	mobileComposition();




/* end burger__composition*/


/* start slider */
let sliuder = options => {
  let wrapper = document.querySelector(options.wrapper);
  let list = document.querySelector(options.list);
  let items = document.querySelectorAll(options.item);
  let left = document.querySelector(options.left);
  let right = document.querySelector(options.right);
  



}({
  wrapper: '.burger-wrapper',
  list: '.burger-list',
  item: '.burger__item',
  right: '.burger__arrows-item--right',
  left: '.burger__arrows-item--right'
})



/*end slider*/
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIE92ZXJsYXkgbWVudSAqL1xyXG5cclxuICBcclxuICBsZXQgbWVudSA9IChmdW5jdGlvbihvcHRpb25zKSB7XHJcblxyXG4gICAgbGV0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5idXR0b24pO1xyXG4gICAgbGV0IG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMubWVudSk7XHJcbiAgICBsZXQgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcclxuICAgIGxldCBsaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5vdmVybGF5LW1lbnVfX2xpbmtcIik7XHJcbiAgICBcclxuXHJcblxyXG5cclxuICAgIGxldCBfdG9nZ2xlTWVudSA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgYnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2hhbWJ1cmdlci1iYXItLWFjdGl2ZScpO1xyXG4gICAgICBtZW51LmNsYXNzTGlzdC50b2dnbGUoJ292ZXJsYXktLW9wZW4nKTtcclxuICAgICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdib2R5LWFjdGl2ZS1tZW51Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGFkZExpc3RlbmVycyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfdG9nZ2xlTWVudSk7XHJcbiAgICAgICAgZm9yIChpPTA7aTxsaW5rLmxlbmd0aDtpKyspe1xyXG4gICAgICAgICAgbGlua1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF90b2dnbGVNZW51KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIG9wZW5NZW51OiBhZGRMaXN0ZW5lcnNcclxuICAgICAgfTtcclxuXHJcbiAgfSkoe1xyXG4gICAgYnV0dG9uOiAnI3RvZ2dsZScsXHJcbiAgICBtZW51OiAnI292ZXJsYXknXHJcbiAgfSk7XHJcblxyXG4gIG1lbnUub3Blbk1lbnUoKTtcclxuXHJcblxyXG4vKmVuZCBvdmVybGF5IG1lbnUgKi9cclxuXHJcbi8qQWNjb2Rlb24gdGVhbSovXHJcbmxldCB0ZWFtQWNjb3JkZW9uID0gKGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIGxldCBsaW5rQWNjb3JkZW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFjY29yZGVvbl9fbGluaycpO1xyXG4gICAgXHJcbiAgICBsZXQgZm9yRWFjaEFjY29yZGVvbiA9IGxpbmtBY2NvcmRlb24uZm9yRWFjaChmdW5jdGlvbihwZXJzb25OYW1lKSB7XHJcbiAgICBwZXJzb25OYW1lLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgbGV0IGFjdGl2ZVBlcnNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb25fX2l0ZW0uYWNjb3JkZW9uX19pdGVtLS1pcy1hY3RpdmUnKTtcclxuICAgICAgICAgIGlmKGFjdGl2ZVBlcnNvbikge1xyXG4gICAgICAgICAgICBsZXQgdGVhbUFjY29yZGVvbkRldGFpbHMgPSBhY3RpdmVQZXJzb24ucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1jb250ZW50Jyk7XHJcbiAgICAgICAgICAgIHRlYW1BY2NvcmRlb25EZXRhaWxzLnN0eWxlLmhlaWdodCA9IFwiXCI7XHJcbiAgICAgICAgICAgIGFjdGl2ZVBlcnNvbi5jbGFzc0xpc3QucmVtb3ZlKCdhY2NvcmRlb25fX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGlmKCFhY3RpdmVQZXJzb24gfHwgYWN0aXZlUGVyc29uLmxpbmtBY2NvcmRlb24gIT09IHRoaXMpIHtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRQZXJzb24gPSB0aGlzLmNsb3Nlc3QoJy5hY2NvcmRlb25fX2l0ZW0nKTtcclxuICAgICAgICAgICAgY3VycmVudFBlcnNvbi5jbGFzc0xpc3QuYWRkKCdhY2NvcmRlb25fX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICBsZXQgY3VycmVudFBlcnNvbkluZm8gPSBjdXJyZW50UGVyc29uLnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tY29udGVudCcpO1xyXG4gICAgICAgICAgICBjdXJyZW50UGVyc29uSW5mby5zdHlsZS5oZWlnaHQgPSBjdXJyZW50UGVyc29uSW5mby5zY3JvbGxIZWlnaHQgKyAncHgnO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG50ZWFtQWNjb3JkZW9uKCk7XHJcbi8qZW5kIEFjY29yZGVvbiB0ZWFtICovXHJcblxyXG4vKiBTdGFydCBhY2NvcmRlb24gaG9yaXpvbnRhbCAqL1xyXG5sZXQgbWVudUFjY29yZGVvbiA9IChmdW5jdGlvbigpIHtcclxuXHJcbiAgICBsZXQgbGlua01lbnVBY2NvcmRlb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYWNjb3JkZW9uLW1lbnVfX2xpbmsnKTtcclxuICAgIGxldCB1c2VyV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgIGxldCBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1tZW51X19saXN0Jyk7XHJcbiAgICBsZXQgaXRlbXNMaXN0ID0gbGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcuYWNjb3JkZW9uLW1lbnVfX2l0ZW0nKTtcclxuXHRcdGxldCB0aXRsZUl0ZW0gPSBsaXN0LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tbWVudV9fbGluaycpO1xyXG5cdFx0bGV0IHdpZHRoVGl0bGUgPSB0aXRsZUl0ZW0uY2xpZW50V2lkdGg7XHJcblx0XHR2YXIgbmVlZGVkV2lkdGggPSB1c2VyV2lkdGggLSBpdGVtc0xpc3QubGVuZ3RoICogd2lkdGhUaXRsZTtcclxuXHRcdG5lZWRlZFdpZHRoID0gKG5lZWRlZFdpZHRoID4gNTIwKSA/ICc1MjBweCcgOiBuZWVkZWRXaWR0aCArICdweCc7XHJcbiAgICBcclxuICAgIGxldCBmb3JFYWNoTWVudUFjY29yZGVvbiA9IGxpbmtNZW51QWNjb3JkZW9uLmZvckVhY2goZnVuY3Rpb24oY2F0ZWdvcnlOYW1lKSB7XHJcbiAgICBjYXRlZ29yeU5hbWUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICBsZXQgYWN0aXZlQ2F0ZWdvcnkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLW1lbnVfX2l0ZW0uYWNjb3JkZW9uLW1lbnVfX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgICAgICAgaWYoYWN0aXZlQ2F0ZWdvcnkpIHtcclxuICAgICAgICAgICAgbGV0IG1lbnVBY2NvcmRlb25EZXRhaWxzID0gYWN0aXZlQ2F0ZWdvcnkucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1tZW51X19pdGVtLWNvbnRlbnQnKTtcclxuICAgICAgICAgICAgbWVudUFjY29yZGVvbkRldGFpbHMuc3R5bGUud2lkdGggPSBcIlwiO1xyXG4gICAgICAgICAgICBhY3RpdmVDYXRlZ29yeS5jbGFzc0xpc3QucmVtb3ZlKCdhY2NvcmRlb24tbWVudV9faXRlbS0taXMtYWN0aXZlJyk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYoIWFjdGl2ZUNhdGVnb3J5fHwgYWN0aXZlQ2F0ZWdvcnkubGlua01lbnVBY2NvcmRlb24gIT09IHRoaXMpIHtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRDYXRlZ29yeSA9IHRoaXMuY2xvc2VzdCgnLmFjY29yZGVvbi1tZW51X19pdGVtJyk7XHJcbiAgICAgICAgICAgIGN1cnJlbnRDYXRlZ29yeS5jbGFzc0xpc3QuYWRkKCdhY2NvcmRlb24tbWVudV9faXRlbS0taXMtYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50Q2F0ZWdvcnlJbmZvID0gY3VycmVudENhdGVnb3J5LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tbWVudV9faXRlbS1jb250ZW50Jyk7XHJcbiAgICAgICAgICAgIGN1cnJlbnRDYXRlZ29yeUluZm8uc3R5bGUud2lkdGggPSBuZWVkZWRXaWR0aDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxubWVudUFjY29yZGVvbigpO1xyXG5cclxuLypFbmQgYWNjb3JkZW9uIGhvcmluem9udGFsICovXHJcblxyXG5cclxuXHJcbi8qIHBvcHVwICovXHJcbmxldCBwb3B1cCA9IChmdW5jdGlvbihvcHRpb25zKSB7XHJcblx0bGV0IHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmV2aWV3c19fbGlzdCcpO1xyXG5cclxuXHRsZXQgX3Rvb2dsZVBvcHVwID0gKGZ1bmN0aW9uKGUpIHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09IG9wdGlvbnMuYnV0dG9uKSB7XHJcblx0XHRcdF9vcGVuUG9wdXAoZS50YXJnZXQpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRsZXQgX29wZW5Qb3B1cCA9IChmdW5jdGlvbihidXR0b24pe1xyXG5cdFx0bGV0IG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdG92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnb3ZlcmxheScpO1xyXG5cclxuXHRcdGxldCBwb3B1cFdpbmRvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0cG9wdXBXaW5kb3cuY2xhc3NMaXN0LmFkZCgncG9wdXAnKTtcclxuXHJcblx0XHRsZXQgY29udGVudFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdGNvbnRlbnRUZXh0LmNsYXNzTGlzdC5hZGQoJ3BvcHVwX19jb250ZW50Jyk7XHJcblxyXG5cdFx0bGV0IGNvbnRlbnQgPSBidXR0b24ucGFyZW50Tm9kZTtcclxuXHJcblx0XHRsZXQgdGV4dCA9IGNvbnRlbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLnRleHQpLnRleHRDb250ZW50O1xyXG5cdCBcclxuXHJcblx0XHRsZXQgdGl0bGVJdGVtPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdHRpdGxlSXRlbS5jbGFzc0xpc3QuYWRkKCdwb3B1cF9fdGl0bGUnKTtcclxuXHJcblx0XHRsZXQgdGl0bGUgPSBjb250ZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy50aXRsZSkudGV4dENvbnRlbnQ7XHJcblx0XHRcclxuXHJcbiAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgIHhoci5yZXNwb25zZVR5cGUgPSAnanNvbic7XHJcbiAgICAvL3hoci5vcGVuKCdHRVQnLCAnaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsL2ZhaWwnKTsgLy/QtNC70Y8g0L7RgtGA0LjRhtCw0YLQtdC70YzQvdC+0LPQviDQvtGC0LLQtdGC0LBcclxuICAgIHhoci5vcGVuKCdQT1NUJywgJ2h0dHA6Ly90ZXN0LmxvY2FsL21haWwucGhwJyk7ICAgLy/QtNC70Y8g0L/QvtC70L7QttC40YLQtdC70YzQvdC+0LPQviDQvtGC0LLQtdGC0LBcclxuICAgIHhoci5zZW5kKCk7XHJcbiAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcclxuICAgICAgXHJcbiAgICAgIGlmKHhoci5zdGF0dXM+PTQwMCkge1xyXG4gICAgICAgICAgY29udGVudFRleHQuaW5uZXJIVE1MID0gJ9Ce0YjQuNCx0LrQsCDQvtGC0L/RgNCw0LLQutC4INC00LDQvdC90YvRhSc7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYoeGhyLnJlc3BvbnNlLnN0YXR1cykge1xyXG4gICAgICAgICAgIGNvbnRlbnRUZXh0LmlubmVySFRNTCA9IHRleHQ7XHJcbiAgICAgICAgICAgdGl0bGVJdGVtLmlubmVySFRNTCA9IHRpdGxlO1xyXG4gICAgICAgICAgY29uc29sZS5sb2codGV4dCk7XHJcbiAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcblx0XHRsZXQgY2xvc2VJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcblx0XHRjbG9zZUljb24uY2xhc3NMaXN0LmFkZChcInBvcHVwX19jbG9zZVwiKTtcclxuXHRcdGNsb3NlSWNvbi5pbm5lckhUTUwgPSAnPHN2ZyBjbGFzcz1cInBvcHVwX19jbG9zZS1pbWFnZVwiPjx1c2UgeGxpbms6aHJlZj1cIi4vaW1hZ2VzL2ljb25zL3Nwcml0ZS5zdmcjY2xvc2VcIj48L3VzZT48L3N2Zz4nO1xyXG5cdFx0Y2xvc2VJY29uLmhyZWYgPSBcIiNcIjtcclxuXHRcdGNsb3NlSWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGZ1bmN0aW9uKGUpe1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdF9jbG9zZVBvcHVwKG92ZXJsYXkpO1xyXG5cdFx0fSkpO1xyXG5cclxuXHRcdG92ZXJsYXkuYXBwZW5kQ2hpbGQocG9wdXBXaW5kb3cpO1xyXG5cdFx0cG9wdXBXaW5kb3cuYXBwZW5kQ2hpbGQodGl0bGVJdGVtKTtcclxuXHRcdHBvcHVwV2luZG93LmFwcGVuZENoaWxkKGNvbnRlbnRUZXh0KTtcclxuXHRcdHBvcHVwV2luZG93LmFwcGVuZENoaWxkKGNsb3NlSWNvbik7XHJcblxyXG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTtcclxuXHR9KTtcclxuXHJcblx0bGV0IF9jbG9zZVBvcHVwID0gKGZ1bmN0aW9uKG92ZXJsYXkpIHtcclxuXHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7XHJcblx0fSk7XHJcblxyXG5cdGxldCBhZGRMaXN0ZW5lcnMgPSAoZnVuY3Rpb24oKSB7XHJcblx0XHR3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX3Rvb2dsZVBvcHVwKVxyXG5cdH0pO1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0aW5pdDogYWRkTGlzdGVuZXJzXHJcblx0fVxyXG59KTtcclxuXHJcbnBvcHVwKHtcclxuXHRidXR0b246IFwicmV2aWV3c19fYnV0dG9uXCIsXHJcblx0dGl0bGU6IFwiLnJldmlld3NfX3RpdGxlXCIsXHJcblx0dGV4dDogXCIucmV2aWV3c19fdGV4dFwiXHJcbn0pLmluaXQoKTtcclxuXHJcblxyXG4vKiBlbmQgcG9wdXAgKi9cclxuXHJcbi8qIGZvcm0qL1xyXG5jb25zdCBteUZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbXlGb3JtJyk7XHJcbmNvbnN0IHNlbmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2VuZCcpO1xyXG5cclxuXHJcbnNlbmQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldmVudCA9PiB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgZGF0YSA9IHtcclxuICAgIG5hbWU6IG15Rm9ybS5lbGVtZW50cy5uYW1lLnZhbHVlLFxyXG4gICAgcGhvbmU6IG15Rm9ybS5lbGVtZW50cy5waG9uZS52YWx1ZSxcclxuICAgIGNvbW1lbnQ6IG15Rm9ybS5lbGVtZW50cy5jb21tZW50LnZhbHVlLFxyXG4gICAgdG86IFwic2VnZXptdW5kb3ZuYUBnbWFpbC5jb21cIlxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gIHhoci5yZXNwb25zZVR5cGU9J2pzb24nO1xyXG4gIHhoci5vcGVuKCdQT1NUJywgJ2h0dHBzOi8vd2ViZGV2LWFwaS5sb2Z0c2Nob29sLmNvbS9zZW5kbWFpbCcpO1xyXG4gIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcclxuICAgIGlmKHhoci5yZXNwb25zZS5zdGF0dXMpIHtcclxuICAgICAgY29uc29sZS5sb2coeGhyLnJlc3BvbnNlLnN0YXR1cyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG59KTtcclxuXHJcbi8qZW5kIGZvcm0gKi9cclxuXHJcbi8qIHN0YXJ0IGJ1cmdlcl9fY29tcG9zaXRpb24gKi9cclxubGV0IGlzTW9iaWxlID0gKCkgPT4ge1xyXG4gIGxldCBzY3JlZW4gPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7XHJcblx0bGV0IG1vYmlsZSA9IGZhbHNlO1xyXG5cdGlmKHNjcmVlbjw9NzY4KXtcclxuICAgIG1vYmlsZSA9IHRydWU7XHJcbiAgfSBcclxuXHRyZXR1cm4gbW9iaWxlO1xyXG59O1xyXG5cclxubGV0IG1vYmlsZUNvbXBvc2l0aW9uID0gKCkgPT4ge1xyXG5cdFx0bGV0IGJ1dHRvbkNvbXBvc2l0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1cmdlcl9fY29tcG9zaXRpb24nKTtcclxuXHRcdGxldCBidXR0b25DbG9zZUNvbXBvc2l0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRyb3Bkb3duX19jbG9zZScpO1xyXG5cclxuXHRcdGJ1dHRvbkNsb3NlQ29tcG9zaXRpb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdFx0YnV0dG9uQ29tcG9zaXRpb24uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcblx0XHR9KTtcclxuXHRcdGJ1dHRvbkNsb3NlQ29tcG9zaXRpb24uYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGUgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0XHRidXR0b25Db21wb3NpdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdGlmIChpc01vYmlsZSkge1xyXG5cdFx0XHRidXR0b25Db21wb3NpdGlvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG5cdFx0XHRcdGJ1dHRvbkNvbXBvc2l0aW9uLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHRcdGJ1dHRvbkNvbXBvc2l0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCBlID0+IHtcclxuXHRcdFx0YnV0dG9uQ29tcG9zaXRpb24uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcblx0XHR9KTtcclxuXHJcblx0XHRidXR0b25Db21wb3NpdGlvbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgZSA9PiB7XHJcblx0XHRcdGJ1dHRvbkNvbXBvc2l0aW9uLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG5cdFx0fSk7XHJcblx0fTtcclxuXHRtb2JpbGVDb21wb3NpdGlvbigpO1xyXG5cclxuXHJcblxyXG5cclxuLyogZW5kIGJ1cmdlcl9fY29tcG9zaXRpb24qL1xyXG5cclxuXHJcbi8qIHN0YXJ0IHNsaWRlciAqL1xyXG5sZXQgc2xpdWRlciA9IG9wdGlvbnMgPT4ge1xyXG4gIGxldCB3cmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLndyYXBwZXIpO1xyXG4gIGxldCBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLmxpc3QpO1xyXG4gIGxldCBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwob3B0aW9ucy5pdGVtKTtcclxuICBsZXQgbGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5sZWZ0KTtcclxuICBsZXQgcmlnaHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMucmlnaHQpO1xyXG4gIFxyXG5cclxuXHJcblxyXG59KHtcclxuICB3cmFwcGVyOiAnLmJ1cmdlci13cmFwcGVyJyxcclxuICBsaXN0OiAnLmJ1cmdlci1saXN0JyxcclxuICBpdGVtOiAnLmJ1cmdlcl9faXRlbScsXHJcbiAgcmlnaHQ6ICcuYnVyZ2VyX19hcnJvd3MtaXRlbS0tcmlnaHQnLFxyXG4gIGxlZnQ6ICcuYnVyZ2VyX19hcnJvd3MtaXRlbS0tcmlnaHQnXHJcbn0pXHJcblxyXG5cclxuXHJcbi8qZW5kIHNsaWRlciovIl19
