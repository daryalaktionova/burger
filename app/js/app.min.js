/* Overlay menu */

  
  let menu = (function(options) {

    let button = document.querySelector(options.button);
    let menu = document.querySelector(options.menu);
    let body = document.querySelector('body');
    let link = document.querySelectorAll(".overlay-menu__link");
    



    let _toggleMenu = function(e) {
      button.classList.toggle('hamburger-bar--active');
      menu.classList.toggle('overlay--open');
      body.classList.toggle('body-active-menu');
    }

    let addListeners = function() {
      button.addEventListener('click', _toggleMenu);
        for (i=0;i<link.length;i++){
          link[i].addEventListener('click', _toggleMenu);
        }
    }

    
    return {
        openMenu: addListeners
      };

  })({
    button: '#toggle',
    menu: '#overlay'
  });

  menu.openMenu();


/*end overlay menu */

/*Accodeon team*/
let teamAccordeon = (function() {

    let linkAccordeon = document.querySelectorAll('.accordeon__link');
    
    linkAccordeon.forEach(function(personName) {
    personName.addEventListener('click', function(e) {
          e.preventDefault();
          let activePerson = document.querySelector('.accordeon__item.accordeon__item--is-active');
          if(activePerson) {
            let teamAccordeonDetails = activePerson.querySelector('.accordeon-content');
            teamAccordeonDetails.style.maxHeight = "";
            activePerson.classList.remove('accordeon__item--is-active');
          }
					
          if(!activePerson || activePerson.querySelector('.accordeon__link') !== this) {
            let currentPerson = this.closest('.accordeon__item');
            currentPerson.classList.add('accordeon__item--is-active');
            let currentPersonInfo = currentPerson.querySelector('.accordeon-content');
            currentPersonInfo.style.maxHeight = currentPersonInfo.scrollHeight + 'px';
          }
        })
    })
  })

teamAccordeon();
/*end Accordeon team */

/* Start accordeon horizontal */
let menuAccordeon = (function() {

    let linkMenuAccordeon = document.querySelectorAll('.accordeon-menu__link');
    let userWidth = window.innerWidth;
    let list = document.querySelector('.accordeon-menu__list');
    let itemsList = list.querySelectorAll('.accordeon-menu__item');
		let titleItem = list.querySelector('.accordeon-menu__link');
		let widthTitle = titleItem.clientWidth;
		var neededWidth = userWidth - itemsList.length * widthTitle;
		neededWidth = (neededWidth > 520) ? '520px' : neededWidth + 'px';
    
    let forEachMenuAccordeon = linkMenuAccordeon.forEach(function(categoryName) {
    categoryName.addEventListener('click', function(e) {
          e.preventDefault();
          let activeCategory = document.querySelector('.accordeon-menu__item.accordeon-menu__item--is-active');
          if(activeCategory) {
            let menuAccordeonDetails = activeCategory.querySelector('.accordeon-menu__item-content');
            menuAccordeonDetails.style.maxWidth = "";
            activeCategory.classList.remove('accordeon-menu__item--is-active');
          }

          if(!activeCategory|| activeCategory.querySelector('.accordeon-menu__link') !== this) {
            let currentCategory = this.closest('.accordeon-menu__item');
            currentCategory.classList.add('accordeon-menu__item--is-active');
            let currentCategoryInfo = currentCategory.querySelector('.accordeon-menu__item-content');
            currentCategoryInfo.style.maxWidth = neededWidth;
          }
        })
    })
  })

menuAccordeon();

/*End accordeon horinzontal */



/* popup */
let popup = (function(options) {
	let wrapper = document.querySelector('.reviews__list');

	let _tooglePopup = (function(e) {
		e.preventDefault();

		if (e.target.className == options.button) {
			_openPopup(e.target);
		}
	});

	let _openPopup = (function(button){
		let overlay = document.createElement('div');
		overlay.classList.add('overlay');

		let popupWindow = document.createElement('div');
		popupWindow.classList.add('popup');

		let contentText = document.createElement('div');
		contentText.classList.add('popup__content');

		let content = button.parentNode;

		let text = content.querySelector(options.text).textContent;
	 

		let titleItem= document.createElement('div');
		titleItem.classList.add('popup__title');

    let title = content.querySelector(options.title).textContent;
    contentText.innerHTML = 'Ошибка отправки данных';
    contentText.innerHTML = text;
    titleItem.innerHTML = title;

		let closeIcon = document.createElement("a");
		closeIcon.classList.add("popup__close");
		closeIcon.innerHTML = '<svg class="popup__close-image"><use xlink:href="./images/icons/sprite.svg#close"></use></svg>';
		closeIcon.href = "#";
		closeIcon.addEventListener("click", (function(e){
			e.preventDefault();
			_closePopup(overlay);
		}));

		overlay.appendChild(popupWindow);
		popupWindow.appendChild(titleItem);
		popupWindow.appendChild(contentText);
		popupWindow.appendChild(closeIcon);

		document.body.appendChild(overlay);
	});

	let _closePopup = (function(overlay) {
		document.body.removeChild(overlay);
	});

	let addListeners = (function() {
		wrapper.addEventListener('click', _tooglePopup)
	});

	return {
		init: addListeners
	}
});

popup({
	button: "reviews__button",
	title: ".reviews__title",
	text: ".reviews__text"
}).init();


/* end popup */

/* form*/

let formFunction = (function(options) {

  const myForm = document.querySelector('#myForm');
  const send = document.querySelector('#send');
  const data = {
    name: myForm.elements.name.value,
    phone: myForm.elements.phone.value,
    comment: myForm.elements.comment.value,
    to: "segezmundovna@gmail.com"
  };

	let _ajaxInquiry = (function(e){
    e.preventDefault();
		let overlay = document.createElement('div');
		overlay.classList.add('overlay');
		let popupWindow = document.createElement('div');
		popupWindow.classList.add('popup--form');
		let contentText = document.createElement('div');
		contentText.classList.add('popup__content');

    const xhr = new XMLHttpRequest();
    xhr.responseType = 'json';
    //xhr.open('GET', 'https://webdev-api.loftschool.com/sendmail/fail'); //для отрицательного ответа
    xhr.open('POST', 'http://test.local/mail.php');   //для положительного ответа
    xhr.send(JSON.stringify(data));
    xhr.addEventListener('load', () => {
      
      if(xhr.status>=400) {
        let content = 'Ошибка, данные не отправлены, попробуйте позже';
        contentText.innerHTML = content;
      } else {
        if(xhr.response.status) {
          let content = 'Сообщение отправлено';
          contentText.innerHTML = content;
      } else {
          let content = 'Соединение с сервером не установлено';
          contentText.innerHTML = content;
      }
      }
    })
    
		let closeIcon = document.createElement("a");
		closeIcon.classList.add("popup__close-button");
		closeIcon.innerHTML = 'Закрыть';
		closeIcon.href = "#";
		closeIcon.addEventListener("click", (function(e){
			e.preventDefault();
			_closePopup(overlay);
    }));


		overlay.appendChild(popupWindow);
		popupWindow.appendChild(contentText);
		popupWindow.appendChild(closeIcon);
    document.body.appendChild(overlay);
  
	});

	let _closePopup = (function(overlay) {
		document.body.removeChild(overlay);
	});

	let addListeners = (function() {
    send.addEventListener('click', _ajaxInquiry)
	});

	return {
		init: addListeners
	}
});

formFunction({
	text: ".reviews__text"
}).init();


/*end form */

/* start burger__composition */
let isMobile = () => {
  let screen = document.documentElement.clientWidth;
	let mobile = false;
	if(screen<=768){
    mobile = true;
  } 
	return mobile;
};

let mobileComposition = () => {
		let burgersCompositions = document.querySelectorAll('.burger__composition');
		let buttonsCloseComposition = document.querySelectorAll('.dropdown__close-image');

	for (i=0;i<burgersCompositions.length;i++){
		burgersCompositions[i].addEventListener('mouseenter', e => {
			document.querySelector('.burger__composition').classList.add('active');
		});
		if (isMobile) {
			burgersCompositions[i].addEventListener('click', e => {
				document.querySelector('.burger__composition').classList.add('active');
			});
		}
	}

	for (i=0;i<burgersCompositions.length;i++){
		burgersCompositions[i].addEventListener('mouseleave', e => {
			document.querySelector('.burger__composition').classList.remove('active');
		});
	}


	for (i=0;i<buttonsCloseComposition.length;i++){
			buttonsCloseComposition[i].addEventListener('click', e => {
				e.preventDefault();
				document.querySelector('.burger__composition').classList.remove('active');
			});
		}
	};
	mobileComposition();





/* end burger__composition*/

/* slider*/

let slider = options => {
	let wrapper = document.querySelector(options.wrapper);
	let width = wrapper.clientWidth;
	wrapper.style.width = width  + 'px';
	let step = width;
	let list = document.querySelector(options.list);
	let items = document.querySelectorAll(options.item);

	let left = document.querySelector(options.left);
	let right = document.querySelector(options.right);

	items.forEach(element => {
		element.style.width = width  + 'px';
	});

	let positionMaxRight = width * (items.length - 1);

	let positionRight = 0;

	let _right = position => {
		if (position <= positionMaxRight) {
			positionRight = positionRight + step;
			list.style.right = positionRight + "px";
		}
	};

	let _left = position => {
		if (position >= 0) {
			positionRight = positionRight - step;
			list.style.right = positionRight + "px";
		}
	};

	let initial = () => {
		list.style.right = positionRight;

		right.addEventListener("click", e => {
			e.preventDefault();

			_right(positionRight + step);
		});

		left.addEventListener("click", e => {
			e.preventDefault();

			_left(positionRight - step);
		});

	};

	return {
		init: initial
	}
};

slider({
	wrapper: '.burger__wrapper',
	list: '.burger__list',
	item: '.burger__item',
	right: '.burger__arrows-item--right',
	left: '.burger__arrows-item--left'
}).init();



/*end slider*/


/*start map */
var placemarks = [
	{
		latitude: 59.97, 
		langetude: 30.31,
		hintContent: 'ул. Литераторов, дом 10',
		balloonContent: 'Самые вкусные бургеры у нас!'

	},
	{
		latitude: 59.94, 
		langetude: 30.25,
		hintContent: 'Малый проспект В О, дом 64',
		balloonContent: 'Самые вкусные бургеры у нас!'
	},
	{
		latitude: 59.93, 
		langetude: 30.34,
		hintContent: 'наб. реки Фонтанки, д. 56',
		balloonContent: 'Самые вкусные бургеры у нас!'
	}
];


ymaps.ready(init);

geoObjects = [];

function init() {
	var map = new ymaps.Map('map', {
		center: [59.94, 30.32],
		zoom: 12,
		controls: ['zoomControl'],
		behaviors: ['drag']
	});

	for(var i=0; i < placemarks.length; i++) {
		geoObjects[i] = new ymaps.Placemark([placemarks[i].latitude, placemarks[i].langetude], 
			{
				hintContent: placemarks[i].hintContent,
				balloonContent: placemarks[i].balloonContent
			},
			{
				iconLayout: 'default#image',
				iconImageHref: 'images/icons/map-marker.svg',
				iconImageSize: [46, 57],
				iconImageOffset: [-23, -57]
			});	
	}

	var clusterer = new ymaps.Clusterer({
		clusterIcons: [
			{
				href: "/images/section-main/burger.png",
				size: [100, 100],
				offset: [-50, -50]
			}
		],
		clusterIconContentLayout: null
	});
	
	map.geoObjects.add(clusterer);
	clusterer.add(geoObjects);
}

/*end map */


/*start OPS */
const sections = $('.section');
const display = $('.content');
const dots = $('.paginator__item');

let inscroll = false;

const md = new MobileDetect(window.navigator.userAgent);
const isItMobile = md.mobile();

const performTransition = sectionEq => {
	
	if(inscroll) return;

	inscroll = true;

	sectionEq = parseInt(sectionEq);

	const position = (sectionEq * -100) + '%';


	sections.eq(sectionEq)
		.addClass('active')
		.siblings()
		.removeClass('active');

	dots.eq(sectionEq)
		.addClass('paginator__item--active')
		.siblings()
		.removeClass('paginator__item--active');

	setTimeout(() => {
		inscroll = false;
	}, 1300);
	display.css({
		'transform' : 'translateY(' + (position) + ')'
	});
	
}

const defineSections = sections => {
	const activeSection = sections.filter('.active');
	return {
		activeSection: activeSection,
		nextSection: activeSection.next(),
		prevSection: activeSection.prev()
	}

}

const scrollToSection = direction => {
	const section = defineSections(sections);

	if(direction == 'up' && section.nextSection.length) {
		performTransition(section.nextSection.index());
	}

	if(direction == "down" && section.prevSection.length) {
		performTransition(section.prevSection.index());
	}
}

$('.wrapper').on({
	wheel: e => {
		const deltaY = e.originalEvent.deltaY;
		const direction = (deltaY>0) 
		? 'up' 
		: 'down';
		scrollToSection(direction);
	},
	touchmove: e => (e.preventDefault())
});


/*OPS keyboard */
$(document).on('keydown', e => {

	console.log(e.keyCode);
	switch(e.keyCode) {
		case 40: //up
			scrollToSection('up')
			break;

		case 38: //down
			scrollToSection('down')
			break;
	}

});

$('[data-scroll-to]').on('click', e => {
	e.preventDefault();
	const sectionNum = $(e.currentTarget).attr('data-scroll-to');
	performTransition(sectionNum);
})


/*start mobile ops */
if(isItMobile) {
	$(window).swipe( {
		swipe:function(
			event,
			direction
		) {
			scrollToSection(direction);
		}
	});
}


/*end OPS */


/*start HTML5 video */
let video;
let durationControl; 
let soundControl;
let intervalId;

// документ полностью загружен
$().ready(function(){
    video = document.getElementById("player"); 

    // вешаем обработчик события onclick на тег video
    video.addEventListener('click', playStop);

    // обработчики событий для кнопок play
    let playButtons = document.querySelectorAll(".play");
    for (let i = 0; i < playButtons.length;i++){
        playButtons[i].addEventListener('click',playStop);
    }

    // обработчик событий для кнопки динамик
    let micControl = document.getElementById("mic");
    micControl.addEventListener('click',soundOf)
    
    // обработчики событий для ползунка продолжительности видео
    durationControl = document.getElementById("durationLevel");    
    durationControl.addEventListener('click',setVideoDuration);
    durationControl.addEventListener('onmousemove',setVideoDuration);
    durationControl.addEventListener('mousedown', stopInterval); 
    durationControl.min = 0;
    durationControl.value = 0;    

    // обработчики событий для ползунка громокости
    soundControl = document.getElementById("micLevel");    
    soundControl.addEventListener('click', changeSoundVolume);
    soundControl.addEventListener('onmousemove', changeSoundVolume);

    // задаем максимальные и минимальные значения громокости
    soundControl.min = 0;
    soundControl.max = 10;
    // присваиваем ползунку максимальное значение
    soundControl.value = soundControl.max;
    
});

/*
 Воспроизведение видео
*/
function playStop(){
    // показывает или скрывает белую кнопку play
    $(".video__player-img").toggleClass("video__player-img--active");
    
    // присваиваем ползунку продолжительности максимальное значение равное продолжительности нашего видео (в секундах)
    durationControl.max = video.duration;

    // проверим стоит ли видео на паузе, если да то продолжим воспроизведение. Если, наоборот, проигрыавыется, то остановим.
    if (video.paused){
        // запускаем видео
        video.play();
        intervalId = setInterval(updateDuration,1)
        // video.webkitRequestFullScreen(); возможность открыть в полноэкранном режиме
    }else{
        // останавливаем видео
        video.pause();  
        clearInterval(intervalId);
        // document.webkitExitFullscreen(); выйти из полноэкранного режима
    }
}

/*
    Управление звуком
*/
function soundOf(){    
    /*
        Делаем проверку уровня громкости. 
        Если у нас нашего видео есть звук, то мы его выключаем. 
        Предварительно запомнив текущую позицию громкости в переменную soundLevel
    */
    if (video.volume ===0){
        video.volume = soundLevel;
        soundControl.value = soundLevel*10;
    }else{
        /*
            Если у нашего видео нет звука, то выставляем уровень громкости на прежний уровень.
            Хранится в перменной soundLevel
        */
        soundLevel = video.volume;
        video.volume = 0;
        soundControl.value = 0;
    }    
}

function stopInterval(){
    clearInterval(intervalId);
}

/*
    Реализует возможность перемотки нашего видео
*/
function setVideoDuration(){
    video.currentTime = durationControl.value;   
    intervalId = setInterval(updateDuration,1000/66);    
}

/*
    Управление звуком видео
*/
function changeSoundVolume(){
    /*
        Св-во volume может принимать значения от 0 до 1
        Делим на 10 для того что бы, была возможность более точной регулировки видео. 
    */
    video.volume = soundControl.value/10;  
}

/*
  Функция для обновления позиции ползунка продолжительности видео.   
*/
function updateDuration(){    
    durationControl.value = video.currentTime;
}
/*end HTML5 video */
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBPdmVybGF5IG1lbnUgKi9cclxuXHJcbiAgXHJcbiAgbGV0IG1lbnUgPSAoZnVuY3Rpb24ob3B0aW9ucykge1xyXG5cclxuICAgIGxldCBidXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMuYnV0dG9uKTtcclxuICAgIGxldCBtZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLm1lbnUpO1xyXG4gICAgbGV0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XHJcbiAgICBsZXQgbGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIub3ZlcmxheS1tZW51X19saW5rXCIpO1xyXG4gICAgXHJcblxyXG5cclxuXHJcbiAgICBsZXQgX3RvZ2dsZU1lbnUgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdoYW1idXJnZXItYmFyLS1hY3RpdmUnKTtcclxuICAgICAgbWVudS5jbGFzc0xpc3QudG9nZ2xlKCdvdmVybGF5LS1vcGVuJyk7XHJcbiAgICAgIGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnYm9keS1hY3RpdmUtbWVudScpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBhZGRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX3RvZ2dsZU1lbnUpO1xyXG4gICAgICAgIGZvciAoaT0wO2k8bGluay5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgIGxpbmtbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfdG9nZ2xlTWVudSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBvcGVuTWVudTogYWRkTGlzdGVuZXJzXHJcbiAgICAgIH07XHJcblxyXG4gIH0pKHtcclxuICAgIGJ1dHRvbjogJyN0b2dnbGUnLFxyXG4gICAgbWVudTogJyNvdmVybGF5J1xyXG4gIH0pO1xyXG5cclxuICBtZW51Lm9wZW5NZW51KCk7XHJcblxyXG5cclxuLyplbmQgb3ZlcmxheSBtZW51ICovXHJcblxyXG4vKkFjY29kZW9uIHRlYW0qL1xyXG5sZXQgdGVhbUFjY29yZGVvbiA9IChmdW5jdGlvbigpIHtcclxuXHJcbiAgICBsZXQgbGlua0FjY29yZGVvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvcmRlb25fX2xpbmsnKTtcclxuICAgIFxyXG4gICAgbGlua0FjY29yZGVvbi5mb3JFYWNoKGZ1bmN0aW9uKHBlcnNvbk5hbWUpIHtcclxuICAgIHBlcnNvbk5hbWUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICBsZXQgYWN0aXZlUGVyc29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbl9faXRlbS5hY2NvcmRlb25fX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgICAgICAgaWYoYWN0aXZlUGVyc29uKSB7XHJcbiAgICAgICAgICAgIGxldCB0ZWFtQWNjb3JkZW9uRGV0YWlscyA9IGFjdGl2ZVBlcnNvbi5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLWNvbnRlbnQnKTtcclxuICAgICAgICAgICAgdGVhbUFjY29yZGVvbkRldGFpbHMuc3R5bGUubWF4SGVpZ2h0ID0gXCJcIjtcclxuICAgICAgICAgICAgYWN0aXZlUGVyc29uLmNsYXNzTGlzdC5yZW1vdmUoJ2FjY29yZGVvbl9faXRlbS0taXMtYWN0aXZlJyk7XHJcbiAgICAgICAgICB9XHJcblx0XHRcdFx0XHRcclxuICAgICAgICAgIGlmKCFhY3RpdmVQZXJzb24gfHwgYWN0aXZlUGVyc29uLnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb25fX2xpbmsnKSAhPT0gdGhpcykge1xyXG4gICAgICAgICAgICBsZXQgY3VycmVudFBlcnNvbiA9IHRoaXMuY2xvc2VzdCgnLmFjY29yZGVvbl9faXRlbScpO1xyXG4gICAgICAgICAgICBjdXJyZW50UGVyc29uLmNsYXNzTGlzdC5hZGQoJ2FjY29yZGVvbl9faXRlbS0taXMtYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50UGVyc29uSW5mbyA9IGN1cnJlbnRQZXJzb24ucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1jb250ZW50Jyk7XHJcbiAgICAgICAgICAgIGN1cnJlbnRQZXJzb25JbmZvLnN0eWxlLm1heEhlaWdodCA9IGN1cnJlbnRQZXJzb25JbmZvLnNjcm9sbEhlaWdodCArICdweCc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcbiAgfSlcclxuXHJcbnRlYW1BY2NvcmRlb24oKTtcclxuLyplbmQgQWNjb3JkZW9uIHRlYW0gKi9cclxuXHJcbi8qIFN0YXJ0IGFjY29yZGVvbiBob3Jpem9udGFsICovXHJcbmxldCBtZW51QWNjb3JkZW9uID0gKGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIGxldCBsaW5rTWVudUFjY29yZGVvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvcmRlb24tbWVudV9fbGluaycpO1xyXG4gICAgbGV0IHVzZXJXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgbGV0IGxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLW1lbnVfX2xpc3QnKTtcclxuICAgIGxldCBpdGVtc0xpc3QgPSBsaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvcmRlb24tbWVudV9faXRlbScpO1xyXG5cdFx0bGV0IHRpdGxlSXRlbSA9IGxpc3QucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1tZW51X19saW5rJyk7XHJcblx0XHRsZXQgd2lkdGhUaXRsZSA9IHRpdGxlSXRlbS5jbGllbnRXaWR0aDtcclxuXHRcdHZhciBuZWVkZWRXaWR0aCA9IHVzZXJXaWR0aCAtIGl0ZW1zTGlzdC5sZW5ndGggKiB3aWR0aFRpdGxlO1xyXG5cdFx0bmVlZGVkV2lkdGggPSAobmVlZGVkV2lkdGggPiA1MjApID8gJzUyMHB4JyA6IG5lZWRlZFdpZHRoICsgJ3B4JztcclxuICAgIFxyXG4gICAgbGV0IGZvckVhY2hNZW51QWNjb3JkZW9uID0gbGlua01lbnVBY2NvcmRlb24uZm9yRWFjaChmdW5jdGlvbihjYXRlZ29yeU5hbWUpIHtcclxuICAgIGNhdGVnb3J5TmFtZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgIGxldCBhY3RpdmVDYXRlZ29yeSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tbWVudV9faXRlbS5hY2NvcmRlb24tbWVudV9faXRlbS0taXMtYWN0aXZlJyk7XHJcbiAgICAgICAgICBpZihhY3RpdmVDYXRlZ29yeSkge1xyXG4gICAgICAgICAgICBsZXQgbWVudUFjY29yZGVvbkRldGFpbHMgPSBhY3RpdmVDYXRlZ29yeS5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLW1lbnVfX2l0ZW0tY29udGVudCcpO1xyXG4gICAgICAgICAgICBtZW51QWNjb3JkZW9uRGV0YWlscy5zdHlsZS5tYXhXaWR0aCA9IFwiXCI7XHJcbiAgICAgICAgICAgIGFjdGl2ZUNhdGVnb3J5LmNsYXNzTGlzdC5yZW1vdmUoJ2FjY29yZGVvbi1tZW51X19pdGVtLS1pcy1hY3RpdmUnKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZighYWN0aXZlQ2F0ZWdvcnl8fCBhY3RpdmVDYXRlZ29yeS5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLW1lbnVfX2xpbmsnKSAhPT0gdGhpcykge1xyXG4gICAgICAgICAgICBsZXQgY3VycmVudENhdGVnb3J5ID0gdGhpcy5jbG9zZXN0KCcuYWNjb3JkZW9uLW1lbnVfX2l0ZW0nKTtcclxuICAgICAgICAgICAgY3VycmVudENhdGVnb3J5LmNsYXNzTGlzdC5hZGQoJ2FjY29yZGVvbi1tZW51X19pdGVtLS1pcy1hY3RpdmUnKTtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRDYXRlZ29yeUluZm8gPSBjdXJyZW50Q2F0ZWdvcnkucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1tZW51X19pdGVtLWNvbnRlbnQnKTtcclxuICAgICAgICAgICAgY3VycmVudENhdGVnb3J5SW5mby5zdHlsZS5tYXhXaWR0aCA9IG5lZWRlZFdpZHRoO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG5tZW51QWNjb3JkZW9uKCk7XHJcblxyXG4vKkVuZCBhY2NvcmRlb24gaG9yaW56b250YWwgKi9cclxuXHJcblxyXG5cclxuLyogcG9wdXAgKi9cclxubGV0IHBvcHVwID0gKGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHRsZXQgd3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yZXZpZXdzX19saXN0Jyk7XHJcblxyXG5cdGxldCBfdG9vZ2xlUG9wdXAgPSAoZnVuY3Rpb24oZSkge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT0gb3B0aW9ucy5idXR0b24pIHtcclxuXHRcdFx0X29wZW5Qb3B1cChlLnRhcmdldCk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdGxldCBfb3BlblBvcHVwID0gKGZ1bmN0aW9uKGJ1dHRvbil7XHJcblx0XHRsZXQgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0b3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdvdmVybGF5Jyk7XHJcblxyXG5cdFx0bGV0IHBvcHVwV2luZG93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRwb3B1cFdpbmRvdy5jbGFzc0xpc3QuYWRkKCdwb3B1cCcpO1xyXG5cclxuXHRcdGxldCBjb250ZW50VGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0Y29udGVudFRleHQuY2xhc3NMaXN0LmFkZCgncG9wdXBfX2NvbnRlbnQnKTtcclxuXHJcblx0XHRsZXQgY29udGVudCA9IGJ1dHRvbi5wYXJlbnROb2RlO1xyXG5cclxuXHRcdGxldCB0ZXh0ID0gY29udGVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMudGV4dCkudGV4dENvbnRlbnQ7XHJcblx0IFxyXG5cclxuXHRcdGxldCB0aXRsZUl0ZW09IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0dGl0bGVJdGVtLmNsYXNzTGlzdC5hZGQoJ3BvcHVwX190aXRsZScpO1xyXG5cclxuICAgIGxldCB0aXRsZSA9IGNvbnRlbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLnRpdGxlKS50ZXh0Q29udGVudDtcclxuICAgIGNvbnRlbnRUZXh0LmlubmVySFRNTCA9ICfQntGI0LjQsdC60LAg0L7RgtC/0YDQsNCy0LrQuCDQtNCw0L3QvdGL0YUnO1xyXG4gICAgY29udGVudFRleHQuaW5uZXJIVE1MID0gdGV4dDtcclxuICAgIHRpdGxlSXRlbS5pbm5lckhUTUwgPSB0aXRsZTtcclxuXHJcblx0XHRsZXQgY2xvc2VJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcblx0XHRjbG9zZUljb24uY2xhc3NMaXN0LmFkZChcInBvcHVwX19jbG9zZVwiKTtcclxuXHRcdGNsb3NlSWNvbi5pbm5lckhUTUwgPSAnPHN2ZyBjbGFzcz1cInBvcHVwX19jbG9zZS1pbWFnZVwiPjx1c2UgeGxpbms6aHJlZj1cIi4vaW1hZ2VzL2ljb25zL3Nwcml0ZS5zdmcjY2xvc2VcIj48L3VzZT48L3N2Zz4nO1xyXG5cdFx0Y2xvc2VJY29uLmhyZWYgPSBcIiNcIjtcclxuXHRcdGNsb3NlSWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGZ1bmN0aW9uKGUpe1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdF9jbG9zZVBvcHVwKG92ZXJsYXkpO1xyXG5cdFx0fSkpO1xyXG5cclxuXHRcdG92ZXJsYXkuYXBwZW5kQ2hpbGQocG9wdXBXaW5kb3cpO1xyXG5cdFx0cG9wdXBXaW5kb3cuYXBwZW5kQ2hpbGQodGl0bGVJdGVtKTtcclxuXHRcdHBvcHVwV2luZG93LmFwcGVuZENoaWxkKGNvbnRlbnRUZXh0KTtcclxuXHRcdHBvcHVwV2luZG93LmFwcGVuZENoaWxkKGNsb3NlSWNvbik7XHJcblxyXG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTtcclxuXHR9KTtcclxuXHJcblx0bGV0IF9jbG9zZVBvcHVwID0gKGZ1bmN0aW9uKG92ZXJsYXkpIHtcclxuXHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7XHJcblx0fSk7XHJcblxyXG5cdGxldCBhZGRMaXN0ZW5lcnMgPSAoZnVuY3Rpb24oKSB7XHJcblx0XHR3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX3Rvb2dsZVBvcHVwKVxyXG5cdH0pO1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0aW5pdDogYWRkTGlzdGVuZXJzXHJcblx0fVxyXG59KTtcclxuXHJcbnBvcHVwKHtcclxuXHRidXR0b246IFwicmV2aWV3c19fYnV0dG9uXCIsXHJcblx0dGl0bGU6IFwiLnJldmlld3NfX3RpdGxlXCIsXHJcblx0dGV4dDogXCIucmV2aWV3c19fdGV4dFwiXHJcbn0pLmluaXQoKTtcclxuXHJcblxyXG4vKiBlbmQgcG9wdXAgKi9cclxuXHJcbi8qIGZvcm0qL1xyXG5cclxubGV0IGZvcm1GdW5jdGlvbiA9IChmdW5jdGlvbihvcHRpb25zKSB7XHJcblxyXG4gIGNvbnN0IG15Rm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNteUZvcm0nKTtcclxuICBjb25zdCBzZW5kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NlbmQnKTtcclxuICBjb25zdCBkYXRhID0ge1xyXG4gICAgbmFtZTogbXlGb3JtLmVsZW1lbnRzLm5hbWUudmFsdWUsXHJcbiAgICBwaG9uZTogbXlGb3JtLmVsZW1lbnRzLnBob25lLnZhbHVlLFxyXG4gICAgY29tbWVudDogbXlGb3JtLmVsZW1lbnRzLmNvbW1lbnQudmFsdWUsXHJcbiAgICB0bzogXCJzZWdlem11bmRvdm5hQGdtYWlsLmNvbVwiXHJcbiAgfTtcclxuXHJcblx0bGV0IF9hamF4SW5xdWlyeSA9IChmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdGxldCBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRvdmVybGF5LmNsYXNzTGlzdC5hZGQoJ292ZXJsYXknKTtcclxuXHRcdGxldCBwb3B1cFdpbmRvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0cG9wdXBXaW5kb3cuY2xhc3NMaXN0LmFkZCgncG9wdXAtLWZvcm0nKTtcclxuXHRcdGxldCBjb250ZW50VGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0Y29udGVudFRleHQuY2xhc3NMaXN0LmFkZCgncG9wdXBfX2NvbnRlbnQnKTtcclxuXHJcbiAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgIHhoci5yZXNwb25zZVR5cGUgPSAnanNvbic7XHJcbiAgICAvL3hoci5vcGVuKCdHRVQnLCAnaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsL2ZhaWwnKTsgLy/QtNC70Y8g0L7RgtGA0LjRhtCw0YLQtdC70YzQvdC+0LPQviDQvtGC0LLQtdGC0LBcclxuICAgIHhoci5vcGVuKCdQT1NUJywgJ2h0dHA6Ly90ZXN0LmxvY2FsL21haWwucGhwJyk7ICAgLy/QtNC70Y8g0L/QvtC70L7QttC40YLQtdC70YzQvdC+0LPQviDQvtGC0LLQtdGC0LBcclxuICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xyXG4gICAgICBcclxuICAgICAgaWYoeGhyLnN0YXR1cz49NDAwKSB7XHJcbiAgICAgICAgbGV0IGNvbnRlbnQgPSAn0J7RiNC40LHQutCwLCDQtNCw0L3QvdGL0LUg0L3QtSDQvtGC0L/RgNCw0LLQu9C10L3Riywg0L/QvtC/0YDQvtCx0YPQudGC0LUg0L/QvtC30LbQtSc7XHJcbiAgICAgICAgY29udGVudFRleHQuaW5uZXJIVE1MID0gY29udGVudDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZih4aHIucmVzcG9uc2Uuc3RhdHVzKSB7XHJcbiAgICAgICAgICBsZXQgY29udGVudCA9ICfQodC+0L7QsdGJ0LXQvdC40LUg0L7RgtC/0YDQsNCy0LvQtdC90L4nO1xyXG4gICAgICAgICAgY29udGVudFRleHQuaW5uZXJIVE1MID0gY29udGVudDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxldCBjb250ZW50ID0gJ9Ch0L7QtdC00LjQvdC10L3QuNC1INGBINGB0LXRgNCy0LXRgNC+0Lwg0L3QtSDRg9GB0YLQsNC90L7QstC70LXQvdC+JztcclxuICAgICAgICAgIGNvbnRlbnRUZXh0LmlubmVySFRNTCA9IGNvbnRlbnQ7XHJcbiAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIFxyXG5cdFx0bGV0IGNsb3NlSWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG5cdFx0Y2xvc2VJY29uLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9fY2xvc2UtYnV0dG9uXCIpO1xyXG5cdFx0Y2xvc2VJY29uLmlubmVySFRNTCA9ICfQl9Cw0LrRgNGL0YLRjCc7XHJcblx0XHRjbG9zZUljb24uaHJlZiA9IFwiI1wiO1xyXG5cdFx0Y2xvc2VJY29uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZnVuY3Rpb24oZSl7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0X2Nsb3NlUG9wdXAob3ZlcmxheSk7XHJcbiAgICB9KSk7XHJcblxyXG5cclxuXHRcdG92ZXJsYXkuYXBwZW5kQ2hpbGQocG9wdXBXaW5kb3cpO1xyXG5cdFx0cG9wdXBXaW5kb3cuYXBwZW5kQ2hpbGQoY29udGVudFRleHQpO1xyXG5cdFx0cG9wdXBXaW5kb3cuYXBwZW5kQ2hpbGQoY2xvc2VJY29uKTtcclxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheSk7XHJcbiAgXHJcblx0fSk7XHJcblxyXG5cdGxldCBfY2xvc2VQb3B1cCA9IChmdW5jdGlvbihvdmVybGF5KSB7XHJcblx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpO1xyXG5cdH0pO1xyXG5cclxuXHRsZXQgYWRkTGlzdGVuZXJzID0gKGZ1bmN0aW9uKCkge1xyXG4gICAgc2VuZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF9hamF4SW5xdWlyeSlcclxuXHR9KTtcclxuXHJcblx0cmV0dXJuIHtcclxuXHRcdGluaXQ6IGFkZExpc3RlbmVyc1xyXG5cdH1cclxufSk7XHJcblxyXG5mb3JtRnVuY3Rpb24oe1xyXG5cdHRleHQ6IFwiLnJldmlld3NfX3RleHRcIlxyXG59KS5pbml0KCk7XHJcblxyXG5cclxuLyplbmQgZm9ybSAqL1xyXG5cclxuLyogc3RhcnQgYnVyZ2VyX19jb21wb3NpdGlvbiAqL1xyXG5sZXQgaXNNb2JpbGUgPSAoKSA9PiB7XHJcbiAgbGV0IHNjcmVlbiA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcclxuXHRsZXQgbW9iaWxlID0gZmFsc2U7XHJcblx0aWYoc2NyZWVuPD03Njgpe1xyXG4gICAgbW9iaWxlID0gdHJ1ZTtcclxuICB9IFxyXG5cdHJldHVybiBtb2JpbGU7XHJcbn07XHJcblxyXG5sZXQgbW9iaWxlQ29tcG9zaXRpb24gPSAoKSA9PiB7XHJcblx0XHRsZXQgYnVyZ2Vyc0NvbXBvc2l0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5idXJnZXJfX2NvbXBvc2l0aW9uJyk7XHJcblx0XHRsZXQgYnV0dG9uc0Nsb3NlQ29tcG9zaXRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZHJvcGRvd25fX2Nsb3NlLWltYWdlJyk7XHJcblxyXG5cdGZvciAoaT0wO2k8YnVyZ2Vyc0NvbXBvc2l0aW9ucy5sZW5ndGg7aSsrKXtcclxuXHRcdGJ1cmdlcnNDb21wb3NpdGlvbnNbaV0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIGUgPT4ge1xyXG5cdFx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnVyZ2VyX19jb21wb3NpdGlvbicpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG5cdFx0fSk7XHJcblx0XHRpZiAoaXNNb2JpbGUpIHtcclxuXHRcdFx0YnVyZ2Vyc0NvbXBvc2l0aW9uc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG5cdFx0XHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXJnZXJfX2NvbXBvc2l0aW9uJykuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Zm9yIChpPTA7aTxidXJnZXJzQ29tcG9zaXRpb25zLmxlbmd0aDtpKyspe1xyXG5cdFx0YnVyZ2Vyc0NvbXBvc2l0aW9uc1tpXS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgZSA9PiB7XHJcblx0XHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXJnZXJfX2NvbXBvc2l0aW9uJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cclxuXHRmb3IgKGk9MDtpPGJ1dHRvbnNDbG9zZUNvbXBvc2l0aW9uLmxlbmd0aDtpKyspe1xyXG5cdFx0XHRidXR0b25zQ2xvc2VDb21wb3NpdGlvbltpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnVyZ2VyX19jb21wb3NpdGlvbicpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9O1xyXG5cdG1vYmlsZUNvbXBvc2l0aW9uKCk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuLyogZW5kIGJ1cmdlcl9fY29tcG9zaXRpb24qL1xyXG5cclxuLyogc2xpZGVyKi9cclxuXHJcbmxldCBzbGlkZXIgPSBvcHRpb25zID0+IHtcclxuXHRsZXQgd3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy53cmFwcGVyKTtcclxuXHRsZXQgd2lkdGggPSB3cmFwcGVyLmNsaWVudFdpZHRoO1xyXG5cdHdyYXBwZXIuc3R5bGUud2lkdGggPSB3aWR0aCAgKyAncHgnO1xyXG5cdGxldCBzdGVwID0gd2lkdGg7XHJcblx0bGV0IGxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMubGlzdCk7XHJcblx0bGV0IGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChvcHRpb25zLml0ZW0pO1xyXG5cclxuXHRsZXQgbGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5sZWZ0KTtcclxuXHRsZXQgcmlnaHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMucmlnaHQpO1xyXG5cclxuXHRpdGVtcy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG5cdFx0ZWxlbWVudC5zdHlsZS53aWR0aCA9IHdpZHRoICArICdweCc7XHJcblx0fSk7XHJcblxyXG5cdGxldCBwb3NpdGlvbk1heFJpZ2h0ID0gd2lkdGggKiAoaXRlbXMubGVuZ3RoIC0gMSk7XHJcblxyXG5cdGxldCBwb3NpdGlvblJpZ2h0ID0gMDtcclxuXHJcblx0bGV0IF9yaWdodCA9IHBvc2l0aW9uID0+IHtcclxuXHRcdGlmIChwb3NpdGlvbiA8PSBwb3NpdGlvbk1heFJpZ2h0KSB7XHJcblx0XHRcdHBvc2l0aW9uUmlnaHQgPSBwb3NpdGlvblJpZ2h0ICsgc3RlcDtcclxuXHRcdFx0bGlzdC5zdHlsZS5yaWdodCA9IHBvc2l0aW9uUmlnaHQgKyBcInB4XCI7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0bGV0IF9sZWZ0ID0gcG9zaXRpb24gPT4ge1xyXG5cdFx0aWYgKHBvc2l0aW9uID49IDApIHtcclxuXHRcdFx0cG9zaXRpb25SaWdodCA9IHBvc2l0aW9uUmlnaHQgLSBzdGVwO1xyXG5cdFx0XHRsaXN0LnN0eWxlLnJpZ2h0ID0gcG9zaXRpb25SaWdodCArIFwicHhcIjtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRsZXQgaW5pdGlhbCA9ICgpID0+IHtcclxuXHRcdGxpc3Quc3R5bGUucmlnaHQgPSBwb3NpdGlvblJpZ2h0O1xyXG5cclxuXHRcdHJpZ2h0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdFx0X3JpZ2h0KHBvc2l0aW9uUmlnaHQgKyBzdGVwKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdGxlZnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0XHRfbGVmdChwb3NpdGlvblJpZ2h0IC0gc3RlcCk7XHJcblx0XHR9KTtcclxuXHJcblx0fTtcclxuXHJcblx0cmV0dXJuIHtcclxuXHRcdGluaXQ6IGluaXRpYWxcclxuXHR9XHJcbn07XHJcblxyXG5zbGlkZXIoe1xyXG5cdHdyYXBwZXI6ICcuYnVyZ2VyX193cmFwcGVyJyxcclxuXHRsaXN0OiAnLmJ1cmdlcl9fbGlzdCcsXHJcblx0aXRlbTogJy5idXJnZXJfX2l0ZW0nLFxyXG5cdHJpZ2h0OiAnLmJ1cmdlcl9fYXJyb3dzLWl0ZW0tLXJpZ2h0JyxcclxuXHRsZWZ0OiAnLmJ1cmdlcl9fYXJyb3dzLWl0ZW0tLWxlZnQnXHJcbn0pLmluaXQoKTtcclxuXHJcblxyXG5cclxuLyplbmQgc2xpZGVyKi9cclxuXHJcblxyXG4vKnN0YXJ0IG1hcCAqL1xyXG52YXIgcGxhY2VtYXJrcyA9IFtcclxuXHR7XHJcblx0XHRsYXRpdHVkZTogNTkuOTcsIFxyXG5cdFx0bGFuZ2V0dWRlOiAzMC4zMSxcclxuXHRcdGhpbnRDb250ZW50OiAn0YPQuy4g0JvQuNGC0LXRgNCw0YLQvtGA0L7Qsiwg0LTQvtC8IDEwJyxcclxuXHRcdGJhbGxvb25Db250ZW50OiAn0KHQsNC80YvQtSDQstC60YPRgdC90YvQtSDQsdGD0YDQs9C10YDRiyDRgyDQvdCw0YEhJ1xyXG5cclxuXHR9LFxyXG5cdHtcclxuXHRcdGxhdGl0dWRlOiA1OS45NCwgXHJcblx0XHRsYW5nZXR1ZGU6IDMwLjI1LFxyXG5cdFx0aGludENvbnRlbnQ6ICfQnNCw0LvRi9C5INC/0YDQvtGB0L/QtdC60YIg0JIg0J4sINC00L7QvCA2NCcsXHJcblx0XHRiYWxsb29uQ29udGVudDogJ9Ch0LDQvNGL0LUg0LLQutGD0YHQvdGL0LUg0LHRg9GA0LPQtdGA0Ysg0YMg0L3QsNGBISdcclxuXHR9LFxyXG5cdHtcclxuXHRcdGxhdGl0dWRlOiA1OS45MywgXHJcblx0XHRsYW5nZXR1ZGU6IDMwLjM0LFxyXG5cdFx0aGludENvbnRlbnQ6ICfQvdCw0LEuINGA0LXQutC4INCk0L7QvdGC0LDQvdC60LgsINC0LiA1NicsXHJcblx0XHRiYWxsb29uQ29udGVudDogJ9Ch0LDQvNGL0LUg0LLQutGD0YHQvdGL0LUg0LHRg9GA0LPQtdGA0Ysg0YMg0L3QsNGBISdcclxuXHR9XHJcbl07XHJcblxyXG5cclxueW1hcHMucmVhZHkoaW5pdCk7XHJcblxyXG5nZW9PYmplY3RzID0gW107XHJcblxyXG5mdW5jdGlvbiBpbml0KCkge1xyXG5cdHZhciBtYXAgPSBuZXcgeW1hcHMuTWFwKCdtYXAnLCB7XHJcblx0XHRjZW50ZXI6IFs1OS45NCwgMzAuMzJdLFxyXG5cdFx0em9vbTogMTIsXHJcblx0XHRjb250cm9sczogWyd6b29tQ29udHJvbCddLFxyXG5cdFx0YmVoYXZpb3JzOiBbJ2RyYWcnXVxyXG5cdH0pO1xyXG5cclxuXHRmb3IodmFyIGk9MDsgaSA8IHBsYWNlbWFya3MubGVuZ3RoOyBpKyspIHtcclxuXHRcdGdlb09iamVjdHNbaV0gPSBuZXcgeW1hcHMuUGxhY2VtYXJrKFtwbGFjZW1hcmtzW2ldLmxhdGl0dWRlLCBwbGFjZW1hcmtzW2ldLmxhbmdldHVkZV0sIFxyXG5cdFx0XHR7XHJcblx0XHRcdFx0aGludENvbnRlbnQ6IHBsYWNlbWFya3NbaV0uaGludENvbnRlbnQsXHJcblx0XHRcdFx0YmFsbG9vbkNvbnRlbnQ6IHBsYWNlbWFya3NbaV0uYmFsbG9vbkNvbnRlbnRcclxuXHRcdFx0fSxcclxuXHRcdFx0e1xyXG5cdFx0XHRcdGljb25MYXlvdXQ6ICdkZWZhdWx0I2ltYWdlJyxcclxuXHRcdFx0XHRpY29uSW1hZ2VIcmVmOiAnaW1hZ2VzL2ljb25zL21hcC1tYXJrZXIuc3ZnJyxcclxuXHRcdFx0XHRpY29uSW1hZ2VTaXplOiBbNDYsIDU3XSxcclxuXHRcdFx0XHRpY29uSW1hZ2VPZmZzZXQ6IFstMjMsIC01N11cclxuXHRcdFx0fSk7XHRcclxuXHR9XHJcblxyXG5cdHZhciBjbHVzdGVyZXIgPSBuZXcgeW1hcHMuQ2x1c3RlcmVyKHtcclxuXHRcdGNsdXN0ZXJJY29uczogW1xyXG5cdFx0XHR7XHJcblx0XHRcdFx0aHJlZjogXCIvaW1hZ2VzL3NlY3Rpb24tbWFpbi9idXJnZXIucG5nXCIsXHJcblx0XHRcdFx0c2l6ZTogWzEwMCwgMTAwXSxcclxuXHRcdFx0XHRvZmZzZXQ6IFstNTAsIC01MF1cclxuXHRcdFx0fVxyXG5cdFx0XSxcclxuXHRcdGNsdXN0ZXJJY29uQ29udGVudExheW91dDogbnVsbFxyXG5cdH0pO1xyXG5cdFxyXG5cdG1hcC5nZW9PYmplY3RzLmFkZChjbHVzdGVyZXIpO1xyXG5cdGNsdXN0ZXJlci5hZGQoZ2VvT2JqZWN0cyk7XHJcbn1cclxuXHJcbi8qZW5kIG1hcCAqL1xyXG5cclxuXHJcbi8qc3RhcnQgT1BTICovXHJcbmNvbnN0IHNlY3Rpb25zID0gJCgnLnNlY3Rpb24nKTtcclxuY29uc3QgZGlzcGxheSA9ICQoJy5jb250ZW50Jyk7XHJcbmNvbnN0IGRvdHMgPSAkKCcucGFnaW5hdG9yX19pdGVtJyk7XHJcblxyXG5sZXQgaW5zY3JvbGwgPSBmYWxzZTtcclxuXHJcbmNvbnN0IG1kID0gbmV3IE1vYmlsZURldGVjdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XHJcbmNvbnN0IGlzSXRNb2JpbGUgPSBtZC5tb2JpbGUoKTtcclxuXHJcbmNvbnN0IHBlcmZvcm1UcmFuc2l0aW9uID0gc2VjdGlvbkVxID0+IHtcclxuXHRcclxuXHRpZihpbnNjcm9sbCkgcmV0dXJuO1xyXG5cclxuXHRpbnNjcm9sbCA9IHRydWU7XHJcblxyXG5cdHNlY3Rpb25FcSA9IHBhcnNlSW50KHNlY3Rpb25FcSk7XHJcblxyXG5cdGNvbnN0IHBvc2l0aW9uID0gKHNlY3Rpb25FcSAqIC0xMDApICsgJyUnO1xyXG5cclxuXHJcblx0c2VjdGlvbnMuZXEoc2VjdGlvbkVxKVxyXG5cdFx0LmFkZENsYXNzKCdhY3RpdmUnKVxyXG5cdFx0LnNpYmxpbmdzKClcclxuXHRcdC5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcblxyXG5cdGRvdHMuZXEoc2VjdGlvbkVxKVxyXG5cdFx0LmFkZENsYXNzKCdwYWdpbmF0b3JfX2l0ZW0tLWFjdGl2ZScpXHJcblx0XHQuc2libGluZ3MoKVxyXG5cdFx0LnJlbW92ZUNsYXNzKCdwYWdpbmF0b3JfX2l0ZW0tLWFjdGl2ZScpO1xyXG5cclxuXHRzZXRUaW1lb3V0KCgpID0+IHtcclxuXHRcdGluc2Nyb2xsID0gZmFsc2U7XHJcblx0fSwgMTMwMCk7XHJcblx0ZGlzcGxheS5jc3Moe1xyXG5cdFx0J3RyYW5zZm9ybScgOiAndHJhbnNsYXRlWSgnICsgKHBvc2l0aW9uKSArICcpJ1xyXG5cdH0pO1xyXG5cdFxyXG59XHJcblxyXG5jb25zdCBkZWZpbmVTZWN0aW9ucyA9IHNlY3Rpb25zID0+IHtcclxuXHRjb25zdCBhY3RpdmVTZWN0aW9uID0gc2VjdGlvbnMuZmlsdGVyKCcuYWN0aXZlJyk7XHJcblx0cmV0dXJuIHtcclxuXHRcdGFjdGl2ZVNlY3Rpb246IGFjdGl2ZVNlY3Rpb24sXHJcblx0XHRuZXh0U2VjdGlvbjogYWN0aXZlU2VjdGlvbi5uZXh0KCksXHJcblx0XHRwcmV2U2VjdGlvbjogYWN0aXZlU2VjdGlvbi5wcmV2KClcclxuXHR9XHJcblxyXG59XHJcblxyXG5jb25zdCBzY3JvbGxUb1NlY3Rpb24gPSBkaXJlY3Rpb24gPT4ge1xyXG5cdGNvbnN0IHNlY3Rpb24gPSBkZWZpbmVTZWN0aW9ucyhzZWN0aW9ucyk7XHJcblxyXG5cdGlmKGRpcmVjdGlvbiA9PSAndXAnICYmIHNlY3Rpb24ubmV4dFNlY3Rpb24ubGVuZ3RoKSB7XHJcblx0XHRwZXJmb3JtVHJhbnNpdGlvbihzZWN0aW9uLm5leHRTZWN0aW9uLmluZGV4KCkpO1xyXG5cdH1cclxuXHJcblx0aWYoZGlyZWN0aW9uID09IFwiZG93blwiICYmIHNlY3Rpb24ucHJldlNlY3Rpb24ubGVuZ3RoKSB7XHJcblx0XHRwZXJmb3JtVHJhbnNpdGlvbihzZWN0aW9uLnByZXZTZWN0aW9uLmluZGV4KCkpO1xyXG5cdH1cclxufVxyXG5cclxuJCgnLndyYXBwZXInKS5vbih7XHJcblx0d2hlZWw6IGUgPT4ge1xyXG5cdFx0Y29uc3QgZGVsdGFZID0gZS5vcmlnaW5hbEV2ZW50LmRlbHRhWTtcclxuXHRcdGNvbnN0IGRpcmVjdGlvbiA9IChkZWx0YVk+MCkgXHJcblx0XHQ/ICd1cCcgXHJcblx0XHQ6ICdkb3duJztcclxuXHRcdHNjcm9sbFRvU2VjdGlvbihkaXJlY3Rpb24pO1xyXG5cdH0sXHJcblx0dG91Y2htb3ZlOiBlID0+IChlLnByZXZlbnREZWZhdWx0KCkpXHJcbn0pO1xyXG5cclxuXHJcbi8qT1BTIGtleWJvYXJkICovXHJcbiQoZG9jdW1lbnQpLm9uKCdrZXlkb3duJywgZSA9PiB7XHJcblxyXG5cdGNvbnNvbGUubG9nKGUua2V5Q29kZSk7XHJcblx0c3dpdGNoKGUua2V5Q29kZSkge1xyXG5cdFx0Y2FzZSA0MDogLy91cFxyXG5cdFx0XHRzY3JvbGxUb1NlY3Rpb24oJ3VwJylcclxuXHRcdFx0YnJlYWs7XHJcblxyXG5cdFx0Y2FzZSAzODogLy9kb3duXHJcblx0XHRcdHNjcm9sbFRvU2VjdGlvbignZG93bicpXHJcblx0XHRcdGJyZWFrO1xyXG5cdH1cclxuXHJcbn0pO1xyXG5cclxuJCgnW2RhdGEtc2Nyb2xsLXRvXScpLm9uKCdjbGljaycsIGUgPT4ge1xyXG5cdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRjb25zdCBzZWN0aW9uTnVtID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoJ2RhdGEtc2Nyb2xsLXRvJyk7XHJcblx0cGVyZm9ybVRyYW5zaXRpb24oc2VjdGlvbk51bSk7XHJcbn0pXHJcblxyXG5cclxuLypzdGFydCBtb2JpbGUgb3BzICovXHJcbmlmKGlzSXRNb2JpbGUpIHtcclxuXHQkKHdpbmRvdykuc3dpcGUoIHtcclxuXHRcdHN3aXBlOmZ1bmN0aW9uKFxyXG5cdFx0XHRldmVudCxcclxuXHRcdFx0ZGlyZWN0aW9uXHJcblx0XHQpIHtcclxuXHRcdFx0c2Nyb2xsVG9TZWN0aW9uKGRpcmVjdGlvbik7XHJcblx0XHR9XHJcblx0fSk7XHJcbn1cclxuXHJcblxyXG4vKmVuZCBPUFMgKi9cclxuXHJcblxyXG4vKnN0YXJ0IEhUTUw1IHZpZGVvICovXHJcbmxldCB2aWRlbztcclxubGV0IGR1cmF0aW9uQ29udHJvbDsgXHJcbmxldCBzb3VuZENvbnRyb2w7XHJcbmxldCBpbnRlcnZhbElkO1xyXG5cclxuLy8g0LTQvtC60YPQvNC10L3RgiDQv9C+0LvQvdC+0YHRgtGM0Y4g0LfQsNCz0YDRg9C20LXQvVxyXG4kKCkucmVhZHkoZnVuY3Rpb24oKXtcclxuICAgIHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5ZXJcIik7IFxyXG5cclxuICAgIC8vINCy0LXRiNCw0LXQvCDQvtCx0YDQsNCx0L7RgtGH0LjQuiDRgdC+0LHRi9GC0LjRjyBvbmNsaWNrINC90LAg0YLQtdCzIHZpZGVvXHJcbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHBsYXlTdG9wKTtcclxuXHJcbiAgICAvLyDQvtCx0YDQsNCx0L7RgtGH0LjQutC4INGB0L7QsdGL0YLQuNC5INC00LvRjyDQutC90L7Qv9C+0LogcGxheVxyXG4gICAgbGV0IHBsYXlCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wbGF5XCIpO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbGF5QnV0dG9ucy5sZW5ndGg7aSsrKXtcclxuICAgICAgICBwbGF5QnV0dG9uc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycscGxheVN0b3ApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vINC+0LHRgNCw0LHQvtGC0YfQuNC6INGB0L7QsdGL0YLQuNC5INC00LvRjyDQutC90L7Qv9C60Lgg0LTQuNC90LDQvNC40LpcclxuICAgIGxldCBtaWNDb250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaWNcIik7XHJcbiAgICBtaWNDb250cm9sLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxzb3VuZE9mKVxyXG4gICAgXHJcbiAgICAvLyDQvtCx0YDQsNCx0L7RgtGH0LjQutC4INGB0L7QsdGL0YLQuNC5INC00LvRjyDQv9C+0LvQt9GD0L3QutCwINC/0YDQvtC00L7Qu9C20LjRgtC10LvRjNC90L7RgdGC0Lgg0LLQuNC00LXQvlxyXG4gICAgZHVyYXRpb25Db250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkdXJhdGlvbkxldmVsXCIpOyAgICBcclxuICAgIGR1cmF0aW9uQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsc2V0VmlkZW9EdXJhdGlvbik7XHJcbiAgICBkdXJhdGlvbkNvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignb25tb3VzZW1vdmUnLHNldFZpZGVvRHVyYXRpb24pO1xyXG4gICAgZHVyYXRpb25Db250cm9sLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHN0b3BJbnRlcnZhbCk7IFxyXG4gICAgZHVyYXRpb25Db250cm9sLm1pbiA9IDA7XHJcbiAgICBkdXJhdGlvbkNvbnRyb2wudmFsdWUgPSAwOyAgICBcclxuXHJcbiAgICAvLyDQvtCx0YDQsNCx0L7RgtGH0LjQutC4INGB0L7QsdGL0YLQuNC5INC00LvRjyDQv9C+0LvQt9GD0L3QutCwINCz0YDQvtC80L7QutC+0YHRgtC4XHJcbiAgICBzb3VuZENvbnRyb2wgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1pY0xldmVsXCIpOyAgICBcclxuICAgIHNvdW5kQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNoYW5nZVNvdW5kVm9sdW1lKTtcclxuICAgIHNvdW5kQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdvbm1vdXNlbW92ZScsIGNoYW5nZVNvdW5kVm9sdW1lKTtcclxuXHJcbiAgICAvLyDQt9Cw0LTQsNC10Lwg0LzQsNC60YHQuNC80LDQu9GM0L3Ri9C1INC4INC80LjQvdC40LzQsNC70YzQvdGL0LUg0LfQvdCw0YfQtdC90LjRjyDQs9GA0L7QvNC+0LrQvtGB0YLQuFxyXG4gICAgc291bmRDb250cm9sLm1pbiA9IDA7XHJcbiAgICBzb3VuZENvbnRyb2wubWF4ID0gMTA7XHJcbiAgICAvLyDQv9GA0LjRgdCy0LDQuNCy0LDQtdC8INC/0L7Qu9C30YPQvdC60YMg0LzQsNC60YHQuNC80LDQu9GM0L3QvtC1INC30L3QsNGH0LXQvdC40LVcclxuICAgIHNvdW5kQ29udHJvbC52YWx1ZSA9IHNvdW5kQ29udHJvbC5tYXg7XHJcbiAgICBcclxufSk7XHJcblxyXG4vKlxyXG4g0JLQvtGB0L/RgNC+0LjQt9Cy0LXQtNC10L3QuNC1INCy0LjQtNC10L5cclxuKi9cclxuZnVuY3Rpb24gcGxheVN0b3AoKXtcclxuICAgIC8vINC/0L7QutCw0LfRi9Cy0LDQtdGCINC40LvQuCDRgdC60YDRi9Cy0LDQtdGCINCx0LXQu9GD0Y4g0LrQvdC+0L/QutGDIHBsYXlcclxuICAgICQoXCIudmlkZW9fX3BsYXllci1pbWdcIikudG9nZ2xlQ2xhc3MoXCJ2aWRlb19fcGxheWVyLWltZy0tYWN0aXZlXCIpO1xyXG4gICAgXHJcbiAgICAvLyDQv9GA0LjRgdCy0LDQuNCy0LDQtdC8INC/0L7Qu9C30YPQvdC60YMg0L/RgNC+0LTQvtC70LbQuNGC0LXQu9GM0L3QvtGB0YLQuCDQvNCw0LrRgdC40LzQsNC70YzQvdC+0LUg0LfQvdCw0YfQtdC90LjQtSDRgNCw0LLQvdC+0LUg0L/RgNC+0LTQvtC70LbQuNGC0LXQu9GM0L3QvtGB0YLQuCDQvdCw0YjQtdCz0L4g0LLQuNC00LXQviAo0LIg0YHQtdC60YPQvdC00LDRhSlcclxuICAgIGR1cmF0aW9uQ29udHJvbC5tYXggPSB2aWRlby5kdXJhdGlvbjtcclxuXHJcbiAgICAvLyDQv9GA0L7QstC10YDQuNC8INGB0YLQvtC40YIg0LvQuCDQstC40LTQtdC+INC90LAg0L/QsNGD0LfQtSwg0LXRgdC70Lgg0LTQsCDRgtC+INC/0YDQvtC00L7Qu9C20LjQvCDQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40LUuINCV0YHQu9C4LCDQvdCw0L7QsdC+0YDQvtGCLCDQv9GA0L7QuNCz0YDRi9Cw0LLRi9C10YLRgdGPLCDRgtC+INC+0YHRgtCw0L3QvtCy0LjQvC5cclxuICAgIGlmICh2aWRlby5wYXVzZWQpe1xyXG4gICAgICAgIC8vINC30LDQv9GD0YHQutCw0LXQvCDQstC40LTQtdC+XHJcbiAgICAgICAgdmlkZW8ucGxheSgpO1xyXG4gICAgICAgIGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCh1cGRhdGVEdXJhdGlvbiwxKVxyXG4gICAgICAgIC8vIHZpZGVvLndlYmtpdFJlcXVlc3RGdWxsU2NyZWVuKCk7INCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0L7RgtC60YDRi9GC0Ywg0LIg0L/QvtC70L3QvtGN0LrRgNCw0L3QvdC+0Lwg0YDQtdC20LjQvNC1XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICAvLyDQvtGB0YLQsNC90LDQstC70LjQstCw0LXQvCDQstC40LTQtdC+XHJcbiAgICAgICAgdmlkZW8ucGF1c2UoKTsgIFxyXG4gICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZCk7XHJcbiAgICAgICAgLy8gZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4oKTsg0LLRi9C50YLQuCDQuNC3INC/0L7Qu9C90L7RjdC60YDQsNC90L3QvtCz0L4g0YDQtdC20LjQvNCwXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qXHJcbiAgICDQo9C/0YDQsNCy0LvQtdC90LjQtSDQt9Cy0YPQutC+0LxcclxuKi9cclxuZnVuY3Rpb24gc291bmRPZigpeyAgICBcclxuICAgIC8qXHJcbiAgICAgICAg0JTQtdC70LDQtdC8INC/0YDQvtCy0LXRgNC60YMg0YPRgNC+0LLQvdGPINCz0YDQvtC80LrQvtGB0YLQuC4gXHJcbiAgICAgICAg0JXRgdC70Lgg0YMg0L3QsNGBINC90LDRiNC10LPQviDQstC40LTQtdC+INC10YHRgtGMINC30LLRg9C6LCDRgtC+INC80Ysg0LXQs9C+INCy0YvQutC70Y7Rh9Cw0LXQvC4gXHJcbiAgICAgICAg0J/RgNC10LTQstCw0YDQuNGC0LXQu9GM0L3QviDQt9Cw0L/QvtC80L3QuNCyINGC0LXQutGD0YnRg9GOINC/0L7Qt9C40YbQuNGOINCz0YDQvtC80LrQvtGB0YLQuCDQsiDQv9C10YDQtdC80LXQvdC90YPRjiBzb3VuZExldmVsXHJcbiAgICAqL1xyXG4gICAgaWYgKHZpZGVvLnZvbHVtZSA9PT0wKXtcclxuICAgICAgICB2aWRlby52b2x1bWUgPSBzb3VuZExldmVsO1xyXG4gICAgICAgIHNvdW5kQ29udHJvbC52YWx1ZSA9IHNvdW5kTGV2ZWwqMTA7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICAvKlxyXG4gICAgICAgICAgICDQldGB0LvQuCDRgyDQvdCw0YjQtdCz0L4g0LLQuNC00LXQviDQvdC10YIg0LfQstGD0LrQsCwg0YLQviDQstGL0YHRgtCw0LLQu9GP0LXQvCDRg9GA0L7QstC10L3RjCDQs9GA0L7QvNC60L7RgdGC0Lgg0L3QsCDQv9GA0LXQttC90LjQuSDRg9GA0L7QstC10L3RjC5cclxuICAgICAgICAgICAg0KXRgNCw0L3QuNGC0YHRjyDQsiDQv9C10YDQvNC10L3QvdC+0Lkgc291bmRMZXZlbFxyXG4gICAgICAgICovXHJcbiAgICAgICAgc291bmRMZXZlbCA9IHZpZGVvLnZvbHVtZTtcclxuICAgICAgICB2aWRlby52b2x1bWUgPSAwO1xyXG4gICAgICAgIHNvdW5kQ29udHJvbC52YWx1ZSA9IDA7XHJcbiAgICB9ICAgIFxyXG59XHJcblxyXG5mdW5jdGlvbiBzdG9wSW50ZXJ2YWwoKXtcclxuICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZCk7XHJcbn1cclxuXHJcbi8qXHJcbiAgICDQoNC10LDQu9C40LfRg9C10YIg0LLQvtC30LzQvtC20L3QvtGB0YLRjCDQv9C10YDQtdC80L7RgtC60Lgg0L3QsNGI0LXQs9C+INCy0LjQtNC10L5cclxuKi9cclxuZnVuY3Rpb24gc2V0VmlkZW9EdXJhdGlvbigpe1xyXG4gICAgdmlkZW8uY3VycmVudFRpbWUgPSBkdXJhdGlvbkNvbnRyb2wudmFsdWU7ICAgXHJcbiAgICBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwodXBkYXRlRHVyYXRpb24sMTAwMC82Nik7ICAgIFxyXG59XHJcblxyXG4vKlxyXG4gICAg0KPQv9GA0LDQstC70LXQvdC40LUg0LfQstGD0LrQvtC8INCy0LjQtNC10L5cclxuKi9cclxuZnVuY3Rpb24gY2hhbmdlU291bmRWb2x1bWUoKXtcclxuICAgIC8qXHJcbiAgICAgICAg0KHQsi3QstC+IHZvbHVtZSDQvNC+0LbQtdGCINC/0YDQuNC90LjQvNCw0YLRjCDQt9C90LDRh9C10L3QuNGPINC+0YIgMCDQtNC+IDFcclxuICAgICAgICDQlNC10LvQuNC8INC90LAgMTAg0LTQu9GPINGC0L7Qs9C+INGH0YLQviDQsdGLLCDQsdGL0LvQsCDQstC+0LfQvNC+0LbQvdC+0YHRgtGMINCx0L7Qu9C10LUg0YLQvtGH0L3QvtC5INGA0LXQs9GD0LvQuNGA0L7QstC60Lgg0LLQuNC00LXQvi4gXHJcbiAgICAqL1xyXG4gICAgdmlkZW8udm9sdW1lID0gc291bmRDb250cm9sLnZhbHVlLzEwOyAgXHJcbn1cclxuXHJcbi8qXHJcbiAg0KTRg9C90LrRhtC40Y8g0LTQu9GPINC+0LHQvdC+0LLQu9C10L3QuNGPINC/0L7Qt9C40YbQuNC4INC/0L7Qu9C30YPQvdC60LAg0L/RgNC+0LTQvtC70LbQuNGC0LXQu9GM0L3QvtGB0YLQuCDQstC40LTQtdC+LiAgIFxyXG4qL1xyXG5mdW5jdGlvbiB1cGRhdGVEdXJhdGlvbigpeyAgICBcclxuICAgIGR1cmF0aW9uQ29udHJvbC52YWx1ZSA9IHZpZGVvLmN1cnJlbnRUaW1lO1xyXG59XHJcbi8qZW5kIEhUTUw1IHZpZGVvICovIl19
