/* Overlay menu */

  
  let menu = (function(options) {

    let button = document.querySelector(options.button);
    let menu = document.querySelector(options.menu);
    let body = document.querySelector('body');
    let link = document.querySelectorAll(".overlay-menu__link");
    



    let _toggleMenu = function(e) {
      button.classList.toggle('hamburger-bar--active');
      menu.classList.toggle('overlay--open');
      body.classList.toggle('body-active-menu');
    }

    let addListeners = function() {
      button.addEventListener('click', _toggleMenu);
        for (let i=0;i<link.length;i++){
          link[i].addEventListener('click', _toggleMenu);
        }
    }

    
    return {
        openMenu: addListeners
      };

  })({
    button: '#toggle',
    menu: '#overlay'
  });

  menu.openMenu();


/*end overlay menu */

/*Accodeon team*/
let teamAccordeon = (function() {

    let linkAccordeon = document.querySelectorAll('.accordeon__link');
    
    linkAccordeon.forEach(function(personName) {
    personName.addEventListener('click', function(e) {
          e.preventDefault();
          let activePerson = document.querySelector('.accordeon__item.accordeon__item--is-active');
          if(activePerson) {
            let teamAccordeonDetails = activePerson.querySelector('.accordeon-content');
            teamAccordeonDetails.style.maxHeight = "";
            activePerson.classList.remove('accordeon__item--is-active');
          }
					
          if(!activePerson || activePerson.querySelector('.accordeon__link') !== this) {
            let currentPerson = this.closest('.accordeon__item');
            currentPerson.classList.add('accordeon__item--is-active');
            let currentPersonInfo = currentPerson.querySelector('.accordeon-content');
            currentPersonInfo.style.maxHeight = currentPersonInfo.scrollHeight + 'px';
          }
        })
    })
  })

teamAccordeon();
/*end Accordeon team */

/* Start accordeon horizontal */
let menuAccordeon = (function() {

    let linkMenuAccordeon = document.querySelectorAll('.accordeon-menu__link');
    let userWidth = window.innerWidth;
    let list = document.querySelector('.accordeon-menu__list');
    let itemsList = list.querySelectorAll('.accordeon-menu__item');
		let titleItem = list.querySelector('.accordeon-menu__link');
		let widthTitle = titleItem.clientWidth;
		var neededWidth = userWidth - itemsList.length * widthTitle;
		neededWidth = (neededWidth > 520) ? '520px' : neededWidth + 'px';
    
    let forEachMenuAccordeon = linkMenuAccordeon.forEach(function(categoryName) {
    categoryName.addEventListener('click', function(e) {
          e.preventDefault();
          let activeCategory = document.querySelector('.accordeon-menu__item.accordeon-menu__item--is-active');
          if(activeCategory) {
            let menuAccordeonDetails = activeCategory.querySelector('.accordeon-menu__item-content');
            menuAccordeonDetails.style.maxWidth = "";
            activeCategory.classList.remove('accordeon-menu__item--is-active');
          }

          if(!activeCategory|| activeCategory.querySelector('.accordeon-menu__link') !== this) {
            let currentCategory = this.closest('.accordeon-menu__item');
            currentCategory.classList.add('accordeon-menu__item--is-active');
            let currentCategoryInfo = currentCategory.querySelector('.accordeon-menu__item-content');
            currentCategoryInfo.style.maxWidth = neededWidth;
          }
        })
    })
  })

menuAccordeon();

/*End accordeon horinzontal */



/* popup */
let popup = (function(options) {
	let wrapper = document.querySelector('.reviews__list');

	let _tooglePopup = (function(e) {
		e.preventDefault();

		if (e.target.className == options.button) {
			_openPopup(e.target);
		}
	});

	let _openPopup = (function(button){
		let overlay = document.createElement('div');
		overlay.classList.add('overlay');

		let popupWindow = document.createElement('div');
		popupWindow.classList.add('popup');

		let contentText = document.createElement('div');
		contentText.classList.add('popup__content');

		let content = button.parentNode;

		let text = content.querySelector(options.text).textContent;
	 

		let titleItem= document.createElement('div');
		titleItem.classList.add('popup__title');

    let title = content.querySelector(options.title).textContent;
    contentText.innerHTML = 'Ошибка отправки данных';
    contentText.innerHTML = text;
    titleItem.innerHTML = title;

		let closeIcon = document.createElement("a");
		closeIcon.classList.add("popup__close");
		closeIcon.innerHTML = '<svg class="popup__close-image"><use xlink:href="./images/icons/sprite.svg#close"></use></svg>';
		closeIcon.href = "#";
		closeIcon.addEventListener("click", (function(e){
			e.preventDefault();
			_closePopup(overlay);
		}));

		overlay.appendChild(popupWindow);
		popupWindow.appendChild(titleItem);
		popupWindow.appendChild(contentText);
		popupWindow.appendChild(closeIcon);

		document.body.appendChild(overlay);
	});

	let _closePopup = (function(overlay) {
		document.body.removeChild(overlay);
	});

	let addListeners = (function() {
		wrapper.addEventListener('click', _tooglePopup)
	});

	return {
		init: addListeners
	}
});

popup({
	button: "reviews__button",
	title: ".reviews__title",
	text: ".reviews__text"
}).init();


/* end popup */

/* form*/

let formFunction = (function(options) {

  const myForm = document.querySelector('#myForm');
  const send = document.querySelector('#send');
  const data = {
    name: myForm.elements.name.value,
    phone: myForm.elements.phone.value,
    comment: myForm.elements.comment.value,
    to: "segezmundovna@gmail.com"
  };

	let _ajaxInquiry = (function(e){
    e.preventDefault();
		let overlay = document.createElement('div');
		overlay.classList.add('overlay');
		let popupWindow = document.createElement('div');
		popupWindow.classList.add('popup--form');
		let contentText = document.createElement('div');
		contentText.classList.add('popup__content');

    const xhr = new XMLHttpRequest();
    xhr.responseType = 'json';
    //xhr.open('GET', 'https://webdev-api.loftschool.com/sendmail/fail'); //для отрицательного ответа
    xhr.open('POST', 'http://test.local/mail.php');   //для положительного ответа
    xhr.send(JSON.stringify(data));
    xhr.addEventListener('load', () => {
      
      if(xhr.status>=400) {
        let content = 'Ошибка, данные не отправлены, попробуйте позже';
        contentText.innerHTML = content;
      } else {
        if(xhr.response.status) {
          let content = 'Сообщение отправлено';
          contentText.innerHTML = content;
      } else {
          let content = 'Соединение с сервером не установлено';
          contentText.innerHTML = content;
      }
      }
    })
    
		let closeIcon = document.createElement("a");
		closeIcon.classList.add("popup__close-button");
		closeIcon.innerHTML = 'Закрыть';
		closeIcon.href = "#";
		closeIcon.addEventListener("click", (function(e){
			e.preventDefault();
			_closePopup(overlay);
    }));


		overlay.appendChild(popupWindow);
		popupWindow.appendChild(contentText);
		popupWindow.appendChild(closeIcon);
    document.body.appendChild(overlay);
  
	});

	let _closePopup = (function(overlay) {
		document.body.removeChild(overlay);
	});

	let addListeners = (function() {
    send.addEventListener('click', _ajaxInquiry)
	});

	return {
		init: addListeners
	}
});

formFunction({
	text: ".reviews__text"
}).init();


/*end form */

/* start burger__composition */
let isMobile = () => {
  let screen = document.documentElement.clientWidth;
	let mobile = false;
	if(screen<=768){
    mobile = true;
  } 
	return mobile;
};

let mobileComposition = () => {
		let burgersCompositions = document.querySelectorAll('.burger__composition');
		let buttonsCloseComposition = document.querySelectorAll('.dropdown__close-image');

	for (let i=0;i<burgersCompositions.length;i++){
		burgersCompositions[i].addEventListener('mouseenter', e => {
			burgersCompositions[i].classList.add('active');
		});
		/*
		if (isMobile) {
			burgersCompositions[i].addEventListener('click', e => {
				document.querySelector('.burger__composition').classList.add('active');
			});
		} */
	}

	for (let i=0;i<burgersCompositions.length;i++){
		burgersCompositions[i].addEventListener('mouseleave', e => {
			burgersCompositions[i].closest('.active').classList.remove('active');
		});
	}


	for (let i=0;i<buttonsCloseComposition.length;i++){
			buttonsCloseComposition[i].addEventListener('click', e => {
				e.preventDefault();
				buttonsCloseComposition[i].closest('.active').classList.remove('active');
			});
		}
	};
	mobileComposition();





/* end burger__composition*/

/* slider*/

let slider = options => {
	let wrapper = document.querySelector(options.wrapper);
	let width = wrapper.clientWidth;
	wrapper.style.width = width  + 'px';
	let step = width;
	let list = document.querySelector(options.list);
	let items = document.querySelectorAll(options.item);

	let left = document.querySelector(options.left);
	let right = document.querySelector(options.right);

	items.forEach(element => {
		element.style.width = width  + 'px';
	});

	let positionMaxRight = width * (items.length - 1);

	let positionRight = 0;

	let _right = position => {
		if (position <= positionMaxRight) {
			positionRight = positionRight + step;
			list.style.right = positionRight + "px";
		}
	};

	let _left = position => {
		if (position >= 0) {
			positionRight = positionRight - step;
			list.style.right = positionRight + "px";
		}
	};

	let initial = () => {
		list.style.right = positionRight;

		right.addEventListener("click", e => {
			e.preventDefault();

			_right(positionRight + step);
		});

		left.addEventListener("click", e => {
			e.preventDefault();

			_left(positionRight - step);
		});

	};

	return {
		init: initial
	}
};

slider({
	wrapper: '.burger__wrapper',
	list: '.burger__list',
	item: '.burger__item',
	right: '.burger__arrows-item--right',
	left: '.burger__arrows-item--left'
}).init();



/*end slider*/


/*start map */
var placemarks = [
	{
		latitude: 59.97, 
		langetude: 30.31,
		hintContent: 'ул. Литераторов, дом 10',
		balloonContent: 'Самые вкусные бургеры у нас!'

	},
	{
		latitude: 59.94, 
		langetude: 30.25,
		hintContent: 'Малый проспект В О, дом 64',
		balloonContent: 'Самые вкусные бургеры у нас!'
	},
	{
		latitude: 59.93, 
		langetude: 30.34,
		hintContent: 'наб. реки Фонтанки, д. 56',
		balloonContent: 'Самые вкусные бургеры у нас!'
	}
];


ymaps.ready(init);

geoObjects = [];

function init() {
	var map = new ymaps.Map('map', {
		center: [59.94, 30.32],
		zoom: 12,
		controls: ['zoomControl'],
		behaviors: ['drag']
	});

	for(var i=0; i < placemarks.length; i++) {
		geoObjects[i] = new ymaps.Placemark([placemarks[i].latitude, placemarks[i].langetude], 
			{
				hintContent: placemarks[i].hintContent,
				balloonContent: placemarks[i].balloonContent
			},
			{
				iconLayout: 'default#image',
				iconImageHref: 'images/icons/map-marker.svg',
				iconImageSize: [46, 57],
				iconImageOffset: [-23, -57]
			});	
	}

	var clusterer = new ymaps.Clusterer({
		clusterIcons: [
			{
				href: "/images/section-main/burger.png",
				size: [100, 100],
				offset: [-50, -50]
			}
		],
		clusterIconContentLayout: null
	});
	
	map.geoObjects.add(clusterer);
	clusterer.add(geoObjects);
}

/*end map */


/*start OPS */
const sections = $('.section');
const display = $('.content');
const dots = $('.paginator__item');

let inscroll = false;

const md = new MobileDetect(window.navigator.userAgent);
const isItMobile = md.mobile();

const performTransition = sectionEq => {
	
	if(inscroll) return;

	inscroll = true;

	sectionEq = parseInt(sectionEq);

	const position = (sectionEq * -100) + '%';


	sections.eq(sectionEq)
		.addClass('active')
		.siblings()
		.removeClass('active');

	dots.eq(sectionEq)
		.addClass('paginator__item--active')
		.siblings()
		.removeClass('paginator__item--active');

	setTimeout(() => {
		inscroll = false;
	}, 1300);
	display.css({
		'transform' : 'translateY(' + (position) + ')'
	});
	
}

const defineSections = sections => {
	const activeSection = sections.filter('.active');
	return {
		activeSection: activeSection,
		nextSection: activeSection.next(),
		prevSection: activeSection.prev()
	}

}

const scrollToSection = direction => {
	const section = defineSections(sections);

	if(direction == 'up' && section.nextSection.length) {
		performTransition(section.nextSection.index());
	}

	if(direction == "down" && section.prevSection.length) {
		performTransition(section.prevSection.index());
	}
}

$('.wrapper').on({
	wheel: e => {
		const deltaY = e.originalEvent.deltaY;
		const direction = (deltaY>0) 
		? 'up' 
		: 'down';
		scrollToSection(direction);
	},
	touchmove: e => (e.preventDefault())
});


/*OPS keyboard */
$(document).on('keydown', e => {

	console.log(e.keyCode);
	switch(e.keyCode) {
		case 40: //up
			scrollToSection('up')
			break;

		case 38: //down
			scrollToSection('down')
			break;
	}

});

$('[data-scroll-to]').on('click', e => {
	e.preventDefault();
	const sectionNum = $(e.currentTarget).attr('data-scroll-to');
	performTransition(sectionNum);
})


/*start mobile ops */
if(isItMobile) {
	$(window).swipe( {
		swipe:function(
			event,
			direction
		) {
			scrollToSection(direction);
		}
	});
}


/*end OPS */


/*start HTML5 video */
let video;
let durationControl; 
let soundControl;
let intervalId;

// документ полностью загружен
$().ready(function(){
    video = document.getElementById("player"); 

    // вешаем обработчик события onclick на тег video
    video.addEventListener('click', playStop);

    // обработчики событий для кнопок play
    let playButtons = document.querySelectorAll(".play");
    for (let i = 0; i < playButtons.length;i++){
        playButtons[i].addEventListener('click',playStop);
    }

    // обработчик событий для кнопки динамик
    let micControl = document.getElementById("mic");
    micControl.addEventListener('click',soundOf)
    
    // обработчики событий для ползунка продолжительности видео
    durationControl = document.getElementById("durationLevel");    
    durationControl.addEventListener('click',setVideoDuration);
    durationControl.addEventListener('onmousemove',setVideoDuration);
    durationControl.addEventListener('mousedown', stopInterval); 
    durationControl.min = 0;
    durationControl.value = 0;    

    // обработчики событий для ползунка громокости
    soundControl = document.getElementById("micLevel");    
    soundControl.addEventListener('click', changeSoundVolume);
    soundControl.addEventListener('onmousemove', changeSoundVolume);

    // задаем максимальные и минимальные значения громокости
    soundControl.min = 0;
    soundControl.max = 10;
    // присваиваем ползунку максимальное значение
    soundControl.value = soundControl.max;
    
});

/*
 Воспроизведение видео
*/
function playStop(){
    // показывает или скрывает белую кнопку play
    $(".video__player-img").toggleClass("video__player-img--active");
    
    // присваиваем ползунку продолжительности максимальное значение равное продолжительности нашего видео (в секундах)
    durationControl.max = video.duration;

    // проверим стоит ли видео на паузе, если да то продолжим воспроизведение. Если, наоборот, проигрыавыется, то остановим.
    if (video.paused){
        // запускаем видео
        video.play();
        intervalId = setInterval(updateDuration,1)
        // video.webkitRequestFullScreen(); возможность открыть в полноэкранном режиме
    }else{
        // останавливаем видео
        video.pause();  
        clearInterval(intervalId);
        // document.webkitExitFullscreen(); выйти из полноэкранного режима
    }
}

/*
    Управление звуком
*/
function soundOf(){    
    /*
        Делаем проверку уровня громкости. 
        Если у нас нашего видео есть звук, то мы его выключаем. 
        Предварительно запомнив текущую позицию громкости в переменную soundLevel
    */
    if (video.volume ===0){
        video.volume = soundLevel;
        soundControl.value = soundLevel*10;
    }else{
        /*
            Если у нашего видео нет звука, то выставляем уровень громкости на прежний уровень.
            Хранится в перменной soundLevel
        */
        soundLevel = video.volume;
        video.volume = 0;
        soundControl.value = 0;
    }    
}

function stopInterval(){
    clearInterval(intervalId);
}

/*
    Реализует возможность перемотки нашего видео
*/
function setVideoDuration(){
    video.currentTime = durationControl.value;   
    intervalId = setInterval(updateDuration,1000/66);    
}

/*
    Управление звуком видео
*/
function changeSoundVolume(){
    /*
        Св-во volume может принимать значения от 0 до 1
        Делим на 10 для того что бы, была возможность более точной регулировки видео. 
    */
    video.volume = soundControl.value/10;  
}

/*
  Функция для обновления позиции ползунка продолжительности видео.   
*/
function updateDuration(){    
    durationControl.value = video.currentTime;
}
/*end HTML5 video */
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIE92ZXJsYXkgbWVudSAqL1xyXG5cclxuICBcclxuICBsZXQgbWVudSA9IChmdW5jdGlvbihvcHRpb25zKSB7XHJcblxyXG4gICAgbGV0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5idXR0b24pO1xyXG4gICAgbGV0IG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMubWVudSk7XHJcbiAgICBsZXQgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcclxuICAgIGxldCBsaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5vdmVybGF5LW1lbnVfX2xpbmtcIik7XHJcbiAgICBcclxuXHJcblxyXG5cclxuICAgIGxldCBfdG9nZ2xlTWVudSA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgYnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2hhbWJ1cmdlci1iYXItLWFjdGl2ZScpO1xyXG4gICAgICBtZW51LmNsYXNzTGlzdC50b2dnbGUoJ292ZXJsYXktLW9wZW4nKTtcclxuICAgICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdib2R5LWFjdGl2ZS1tZW51Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGFkZExpc3RlbmVycyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfdG9nZ2xlTWVudSk7XHJcbiAgICAgICAgZm9yIChsZXQgaT0wO2k8bGluay5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgIGxpbmtbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfdG9nZ2xlTWVudSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBvcGVuTWVudTogYWRkTGlzdGVuZXJzXHJcbiAgICAgIH07XHJcblxyXG4gIH0pKHtcclxuICAgIGJ1dHRvbjogJyN0b2dnbGUnLFxyXG4gICAgbWVudTogJyNvdmVybGF5J1xyXG4gIH0pO1xyXG5cclxuICBtZW51Lm9wZW5NZW51KCk7XHJcblxyXG5cclxuLyplbmQgb3ZlcmxheSBtZW51ICovXHJcblxyXG4vKkFjY29kZW9uIHRlYW0qL1xyXG5sZXQgdGVhbUFjY29yZGVvbiA9IChmdW5jdGlvbigpIHtcclxuXHJcbiAgICBsZXQgbGlua0FjY29yZGVvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvcmRlb25fX2xpbmsnKTtcclxuICAgIFxyXG4gICAgbGlua0FjY29yZGVvbi5mb3JFYWNoKGZ1bmN0aW9uKHBlcnNvbk5hbWUpIHtcclxuICAgIHBlcnNvbk5hbWUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICBsZXQgYWN0aXZlUGVyc29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbl9faXRlbS5hY2NvcmRlb25fX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgICAgICAgaWYoYWN0aXZlUGVyc29uKSB7XHJcbiAgICAgICAgICAgIGxldCB0ZWFtQWNjb3JkZW9uRGV0YWlscyA9IGFjdGl2ZVBlcnNvbi5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLWNvbnRlbnQnKTtcclxuICAgICAgICAgICAgdGVhbUFjY29yZGVvbkRldGFpbHMuc3R5bGUubWF4SGVpZ2h0ID0gXCJcIjtcclxuICAgICAgICAgICAgYWN0aXZlUGVyc29uLmNsYXNzTGlzdC5yZW1vdmUoJ2FjY29yZGVvbl9faXRlbS0taXMtYWN0aXZlJyk7XHJcbiAgICAgICAgICB9XHJcblx0XHRcdFx0XHRcclxuICAgICAgICAgIGlmKCFhY3RpdmVQZXJzb24gfHwgYWN0aXZlUGVyc29uLnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb25fX2xpbmsnKSAhPT0gdGhpcykge1xyXG4gICAgICAgICAgICBsZXQgY3VycmVudFBlcnNvbiA9IHRoaXMuY2xvc2VzdCgnLmFjY29yZGVvbl9faXRlbScpO1xyXG4gICAgICAgICAgICBjdXJyZW50UGVyc29uLmNsYXNzTGlzdC5hZGQoJ2FjY29yZGVvbl9faXRlbS0taXMtYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50UGVyc29uSW5mbyA9IGN1cnJlbnRQZXJzb24ucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1jb250ZW50Jyk7XHJcbiAgICAgICAgICAgIGN1cnJlbnRQZXJzb25JbmZvLnN0eWxlLm1heEhlaWdodCA9IGN1cnJlbnRQZXJzb25JbmZvLnNjcm9sbEhlaWdodCArICdweCc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcbiAgfSlcclxuXHJcbnRlYW1BY2NvcmRlb24oKTtcclxuLyplbmQgQWNjb3JkZW9uIHRlYW0gKi9cclxuXHJcbi8qIFN0YXJ0IGFjY29yZGVvbiBob3Jpem9udGFsICovXHJcbmxldCBtZW51QWNjb3JkZW9uID0gKGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIGxldCBsaW5rTWVudUFjY29yZGVvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvcmRlb24tbWVudV9fbGluaycpO1xyXG4gICAgbGV0IHVzZXJXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgbGV0IGxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLW1lbnVfX2xpc3QnKTtcclxuICAgIGxldCBpdGVtc0xpc3QgPSBsaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvcmRlb24tbWVudV9faXRlbScpO1xyXG5cdFx0bGV0IHRpdGxlSXRlbSA9IGxpc3QucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1tZW51X19saW5rJyk7XHJcblx0XHRsZXQgd2lkdGhUaXRsZSA9IHRpdGxlSXRlbS5jbGllbnRXaWR0aDtcclxuXHRcdHZhciBuZWVkZWRXaWR0aCA9IHVzZXJXaWR0aCAtIGl0ZW1zTGlzdC5sZW5ndGggKiB3aWR0aFRpdGxlO1xyXG5cdFx0bmVlZGVkV2lkdGggPSAobmVlZGVkV2lkdGggPiA1MjApID8gJzUyMHB4JyA6IG5lZWRlZFdpZHRoICsgJ3B4JztcclxuICAgIFxyXG4gICAgbGV0IGZvckVhY2hNZW51QWNjb3JkZW9uID0gbGlua01lbnVBY2NvcmRlb24uZm9yRWFjaChmdW5jdGlvbihjYXRlZ29yeU5hbWUpIHtcclxuICAgIGNhdGVnb3J5TmFtZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgIGxldCBhY3RpdmVDYXRlZ29yeSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tbWVudV9faXRlbS5hY2NvcmRlb24tbWVudV9faXRlbS0taXMtYWN0aXZlJyk7XHJcbiAgICAgICAgICBpZihhY3RpdmVDYXRlZ29yeSkge1xyXG4gICAgICAgICAgICBsZXQgbWVudUFjY29yZGVvbkRldGFpbHMgPSBhY3RpdmVDYXRlZ29yeS5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLW1lbnVfX2l0ZW0tY29udGVudCcpO1xyXG4gICAgICAgICAgICBtZW51QWNjb3JkZW9uRGV0YWlscy5zdHlsZS5tYXhXaWR0aCA9IFwiXCI7XHJcbiAgICAgICAgICAgIGFjdGl2ZUNhdGVnb3J5LmNsYXNzTGlzdC5yZW1vdmUoJ2FjY29yZGVvbi1tZW51X19pdGVtLS1pcy1hY3RpdmUnKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZighYWN0aXZlQ2F0ZWdvcnl8fCBhY3RpdmVDYXRlZ29yeS5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLW1lbnVfX2xpbmsnKSAhPT0gdGhpcykge1xyXG4gICAgICAgICAgICBsZXQgY3VycmVudENhdGVnb3J5ID0gdGhpcy5jbG9zZXN0KCcuYWNjb3JkZW9uLW1lbnVfX2l0ZW0nKTtcclxuICAgICAgICAgICAgY3VycmVudENhdGVnb3J5LmNsYXNzTGlzdC5hZGQoJ2FjY29yZGVvbi1tZW51X19pdGVtLS1pcy1hY3RpdmUnKTtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRDYXRlZ29yeUluZm8gPSBjdXJyZW50Q2F0ZWdvcnkucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1tZW51X19pdGVtLWNvbnRlbnQnKTtcclxuICAgICAgICAgICAgY3VycmVudENhdGVnb3J5SW5mby5zdHlsZS5tYXhXaWR0aCA9IG5lZWRlZFdpZHRoO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG5tZW51QWNjb3JkZW9uKCk7XHJcblxyXG4vKkVuZCBhY2NvcmRlb24gaG9yaW56b250YWwgKi9cclxuXHJcblxyXG5cclxuLyogcG9wdXAgKi9cclxubGV0IHBvcHVwID0gKGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHRsZXQgd3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yZXZpZXdzX19saXN0Jyk7XHJcblxyXG5cdGxldCBfdG9vZ2xlUG9wdXAgPSAoZnVuY3Rpb24oZSkge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT0gb3B0aW9ucy5idXR0b24pIHtcclxuXHRcdFx0X29wZW5Qb3B1cChlLnRhcmdldCk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdGxldCBfb3BlblBvcHVwID0gKGZ1bmN0aW9uKGJ1dHRvbil7XHJcblx0XHRsZXQgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0b3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdvdmVybGF5Jyk7XHJcblxyXG5cdFx0bGV0IHBvcHVwV2luZG93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRwb3B1cFdpbmRvdy5jbGFzc0xpc3QuYWRkKCdwb3B1cCcpO1xyXG5cclxuXHRcdGxldCBjb250ZW50VGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0Y29udGVudFRleHQuY2xhc3NMaXN0LmFkZCgncG9wdXBfX2NvbnRlbnQnKTtcclxuXHJcblx0XHRsZXQgY29udGVudCA9IGJ1dHRvbi5wYXJlbnROb2RlO1xyXG5cclxuXHRcdGxldCB0ZXh0ID0gY29udGVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMudGV4dCkudGV4dENvbnRlbnQ7XHJcblx0IFxyXG5cclxuXHRcdGxldCB0aXRsZUl0ZW09IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0dGl0bGVJdGVtLmNsYXNzTGlzdC5hZGQoJ3BvcHVwX190aXRsZScpO1xyXG5cclxuICAgIGxldCB0aXRsZSA9IGNvbnRlbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLnRpdGxlKS50ZXh0Q29udGVudDtcclxuICAgIGNvbnRlbnRUZXh0LmlubmVySFRNTCA9ICfQntGI0LjQsdC60LAg0L7RgtC/0YDQsNCy0LrQuCDQtNCw0L3QvdGL0YUnO1xyXG4gICAgY29udGVudFRleHQuaW5uZXJIVE1MID0gdGV4dDtcclxuICAgIHRpdGxlSXRlbS5pbm5lckhUTUwgPSB0aXRsZTtcclxuXHJcblx0XHRsZXQgY2xvc2VJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcblx0XHRjbG9zZUljb24uY2xhc3NMaXN0LmFkZChcInBvcHVwX19jbG9zZVwiKTtcclxuXHRcdGNsb3NlSWNvbi5pbm5lckhUTUwgPSAnPHN2ZyBjbGFzcz1cInBvcHVwX19jbG9zZS1pbWFnZVwiPjx1c2UgeGxpbms6aHJlZj1cIi4vaW1hZ2VzL2ljb25zL3Nwcml0ZS5zdmcjY2xvc2VcIj48L3VzZT48L3N2Zz4nO1xyXG5cdFx0Y2xvc2VJY29uLmhyZWYgPSBcIiNcIjtcclxuXHRcdGNsb3NlSWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGZ1bmN0aW9uKGUpe1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdF9jbG9zZVBvcHVwKG92ZXJsYXkpO1xyXG5cdFx0fSkpO1xyXG5cclxuXHRcdG92ZXJsYXkuYXBwZW5kQ2hpbGQocG9wdXBXaW5kb3cpO1xyXG5cdFx0cG9wdXBXaW5kb3cuYXBwZW5kQ2hpbGQodGl0bGVJdGVtKTtcclxuXHRcdHBvcHVwV2luZG93LmFwcGVuZENoaWxkKGNvbnRlbnRUZXh0KTtcclxuXHRcdHBvcHVwV2luZG93LmFwcGVuZENoaWxkKGNsb3NlSWNvbik7XHJcblxyXG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTtcclxuXHR9KTtcclxuXHJcblx0bGV0IF9jbG9zZVBvcHVwID0gKGZ1bmN0aW9uKG92ZXJsYXkpIHtcclxuXHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7XHJcblx0fSk7XHJcblxyXG5cdGxldCBhZGRMaXN0ZW5lcnMgPSAoZnVuY3Rpb24oKSB7XHJcblx0XHR3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX3Rvb2dsZVBvcHVwKVxyXG5cdH0pO1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0aW5pdDogYWRkTGlzdGVuZXJzXHJcblx0fVxyXG59KTtcclxuXHJcbnBvcHVwKHtcclxuXHRidXR0b246IFwicmV2aWV3c19fYnV0dG9uXCIsXHJcblx0dGl0bGU6IFwiLnJldmlld3NfX3RpdGxlXCIsXHJcblx0dGV4dDogXCIucmV2aWV3c19fdGV4dFwiXHJcbn0pLmluaXQoKTtcclxuXHJcblxyXG4vKiBlbmQgcG9wdXAgKi9cclxuXHJcbi8qIGZvcm0qL1xyXG5cclxubGV0IGZvcm1GdW5jdGlvbiA9IChmdW5jdGlvbihvcHRpb25zKSB7XHJcblxyXG4gIGNvbnN0IG15Rm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNteUZvcm0nKTtcclxuICBjb25zdCBzZW5kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NlbmQnKTtcclxuICBjb25zdCBkYXRhID0ge1xyXG4gICAgbmFtZTogbXlGb3JtLmVsZW1lbnRzLm5hbWUudmFsdWUsXHJcbiAgICBwaG9uZTogbXlGb3JtLmVsZW1lbnRzLnBob25lLnZhbHVlLFxyXG4gICAgY29tbWVudDogbXlGb3JtLmVsZW1lbnRzLmNvbW1lbnQudmFsdWUsXHJcbiAgICB0bzogXCJzZWdlem11bmRvdm5hQGdtYWlsLmNvbVwiXHJcbiAgfTtcclxuXHJcblx0bGV0IF9hamF4SW5xdWlyeSA9IChmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdGxldCBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRvdmVybGF5LmNsYXNzTGlzdC5hZGQoJ292ZXJsYXknKTtcclxuXHRcdGxldCBwb3B1cFdpbmRvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0cG9wdXBXaW5kb3cuY2xhc3NMaXN0LmFkZCgncG9wdXAtLWZvcm0nKTtcclxuXHRcdGxldCBjb250ZW50VGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0Y29udGVudFRleHQuY2xhc3NMaXN0LmFkZCgncG9wdXBfX2NvbnRlbnQnKTtcclxuXHJcbiAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgIHhoci5yZXNwb25zZVR5cGUgPSAnanNvbic7XHJcbiAgICAvL3hoci5vcGVuKCdHRVQnLCAnaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsL2ZhaWwnKTsgLy/QtNC70Y8g0L7RgtGA0LjRhtCw0YLQtdC70YzQvdC+0LPQviDQvtGC0LLQtdGC0LBcclxuICAgIHhoci5vcGVuKCdQT1NUJywgJ2h0dHA6Ly90ZXN0LmxvY2FsL21haWwucGhwJyk7ICAgLy/QtNC70Y8g0L/QvtC70L7QttC40YLQtdC70YzQvdC+0LPQviDQvtGC0LLQtdGC0LBcclxuICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xyXG4gICAgICBcclxuICAgICAgaWYoeGhyLnN0YXR1cz49NDAwKSB7XHJcbiAgICAgICAgbGV0IGNvbnRlbnQgPSAn0J7RiNC40LHQutCwLCDQtNCw0L3QvdGL0LUg0L3QtSDQvtGC0L/RgNCw0LLQu9C10L3Riywg0L/QvtC/0YDQvtCx0YPQudGC0LUg0L/QvtC30LbQtSc7XHJcbiAgICAgICAgY29udGVudFRleHQuaW5uZXJIVE1MID0gY29udGVudDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZih4aHIucmVzcG9uc2Uuc3RhdHVzKSB7XHJcbiAgICAgICAgICBsZXQgY29udGVudCA9ICfQodC+0L7QsdGJ0LXQvdC40LUg0L7RgtC/0YDQsNCy0LvQtdC90L4nO1xyXG4gICAgICAgICAgY29udGVudFRleHQuaW5uZXJIVE1MID0gY29udGVudDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxldCBjb250ZW50ID0gJ9Ch0L7QtdC00LjQvdC10L3QuNC1INGBINGB0LXRgNCy0LXRgNC+0Lwg0L3QtSDRg9GB0YLQsNC90L7QstC70LXQvdC+JztcclxuICAgICAgICAgIGNvbnRlbnRUZXh0LmlubmVySFRNTCA9IGNvbnRlbnQ7XHJcbiAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIFxyXG5cdFx0bGV0IGNsb3NlSWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG5cdFx0Y2xvc2VJY29uLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9fY2xvc2UtYnV0dG9uXCIpO1xyXG5cdFx0Y2xvc2VJY29uLmlubmVySFRNTCA9ICfQl9Cw0LrRgNGL0YLRjCc7XHJcblx0XHRjbG9zZUljb24uaHJlZiA9IFwiI1wiO1xyXG5cdFx0Y2xvc2VJY29uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZnVuY3Rpb24oZSl7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0X2Nsb3NlUG9wdXAob3ZlcmxheSk7XHJcbiAgICB9KSk7XHJcblxyXG5cclxuXHRcdG92ZXJsYXkuYXBwZW5kQ2hpbGQocG9wdXBXaW5kb3cpO1xyXG5cdFx0cG9wdXBXaW5kb3cuYXBwZW5kQ2hpbGQoY29udGVudFRleHQpO1xyXG5cdFx0cG9wdXBXaW5kb3cuYXBwZW5kQ2hpbGQoY2xvc2VJY29uKTtcclxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheSk7XHJcbiAgXHJcblx0fSk7XHJcblxyXG5cdGxldCBfY2xvc2VQb3B1cCA9IChmdW5jdGlvbihvdmVybGF5KSB7XHJcblx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpO1xyXG5cdH0pO1xyXG5cclxuXHRsZXQgYWRkTGlzdGVuZXJzID0gKGZ1bmN0aW9uKCkge1xyXG4gICAgc2VuZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF9hamF4SW5xdWlyeSlcclxuXHR9KTtcclxuXHJcblx0cmV0dXJuIHtcclxuXHRcdGluaXQ6IGFkZExpc3RlbmVyc1xyXG5cdH1cclxufSk7XHJcblxyXG5mb3JtRnVuY3Rpb24oe1xyXG5cdHRleHQ6IFwiLnJldmlld3NfX3RleHRcIlxyXG59KS5pbml0KCk7XHJcblxyXG5cclxuLyplbmQgZm9ybSAqL1xyXG5cclxuLyogc3RhcnQgYnVyZ2VyX19jb21wb3NpdGlvbiAqL1xyXG5sZXQgaXNNb2JpbGUgPSAoKSA9PiB7XHJcbiAgbGV0IHNjcmVlbiA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcclxuXHRsZXQgbW9iaWxlID0gZmFsc2U7XHJcblx0aWYoc2NyZWVuPD03Njgpe1xyXG4gICAgbW9iaWxlID0gdHJ1ZTtcclxuICB9IFxyXG5cdHJldHVybiBtb2JpbGU7XHJcbn07XHJcblxyXG5sZXQgbW9iaWxlQ29tcG9zaXRpb24gPSAoKSA9PiB7XHJcblx0XHRsZXQgYnVyZ2Vyc0NvbXBvc2l0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5idXJnZXJfX2NvbXBvc2l0aW9uJyk7XHJcblx0XHRsZXQgYnV0dG9uc0Nsb3NlQ29tcG9zaXRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZHJvcGRvd25fX2Nsb3NlLWltYWdlJyk7XHJcblxyXG5cdGZvciAobGV0IGk9MDtpPGJ1cmdlcnNDb21wb3NpdGlvbnMubGVuZ3RoO2krKyl7XHJcblx0XHRidXJnZXJzQ29tcG9zaXRpb25zW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCBlID0+IHtcclxuXHRcdFx0YnVyZ2Vyc0NvbXBvc2l0aW9uc1tpXS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuXHRcdH0pO1xyXG5cdFx0LypcclxuXHRcdGlmIChpc01vYmlsZSkge1xyXG5cdFx0XHRidXJnZXJzQ29tcG9zaXRpb25zW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcblx0XHRcdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1cmdlcl9fY29tcG9zaXRpb24nKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9ICovXHJcblx0fVxyXG5cclxuXHRmb3IgKGxldCBpPTA7aTxidXJnZXJzQ29tcG9zaXRpb25zLmxlbmd0aDtpKyspe1xyXG5cdFx0YnVyZ2Vyc0NvbXBvc2l0aW9uc1tpXS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgZSA9PiB7XHJcblx0XHRcdGJ1cmdlcnNDb21wb3NpdGlvbnNbaV0uY2xvc2VzdCgnLmFjdGl2ZScpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHJcblx0Zm9yIChsZXQgaT0wO2k8YnV0dG9uc0Nsb3NlQ29tcG9zaXRpb24ubGVuZ3RoO2krKyl7XHJcblx0XHRcdGJ1dHRvbnNDbG9zZUNvbXBvc2l0aW9uW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdGJ1dHRvbnNDbG9zZUNvbXBvc2l0aW9uW2ldLmNsb3Nlc3QoJy5hY3RpdmUnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fTtcclxuXHRtb2JpbGVDb21wb3NpdGlvbigpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcbi8qIGVuZCBidXJnZXJfX2NvbXBvc2l0aW9uKi9cclxuXHJcbi8qIHNsaWRlciovXHJcblxyXG5sZXQgc2xpZGVyID0gb3B0aW9ucyA9PiB7XHJcblx0bGV0IHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMud3JhcHBlcik7XHJcblx0bGV0IHdpZHRoID0gd3JhcHBlci5jbGllbnRXaWR0aDtcclxuXHR3cmFwcGVyLnN0eWxlLndpZHRoID0gd2lkdGggICsgJ3B4JztcclxuXHRsZXQgc3RlcCA9IHdpZHRoO1xyXG5cdGxldCBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLmxpc3QpO1xyXG5cdGxldCBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwob3B0aW9ucy5pdGVtKTtcclxuXHJcblx0bGV0IGxlZnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMubGVmdCk7XHJcblx0bGV0IHJpZ2h0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLnJpZ2h0KTtcclxuXHJcblx0aXRlbXMuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuXHRcdGVsZW1lbnQuc3R5bGUud2lkdGggPSB3aWR0aCAgKyAncHgnO1xyXG5cdH0pO1xyXG5cclxuXHRsZXQgcG9zaXRpb25NYXhSaWdodCA9IHdpZHRoICogKGl0ZW1zLmxlbmd0aCAtIDEpO1xyXG5cclxuXHRsZXQgcG9zaXRpb25SaWdodCA9IDA7XHJcblxyXG5cdGxldCBfcmlnaHQgPSBwb3NpdGlvbiA9PiB7XHJcblx0XHRpZiAocG9zaXRpb24gPD0gcG9zaXRpb25NYXhSaWdodCkge1xyXG5cdFx0XHRwb3NpdGlvblJpZ2h0ID0gcG9zaXRpb25SaWdodCArIHN0ZXA7XHJcblx0XHRcdGxpc3Quc3R5bGUucmlnaHQgPSBwb3NpdGlvblJpZ2h0ICsgXCJweFwiO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGxldCBfbGVmdCA9IHBvc2l0aW9uID0+IHtcclxuXHRcdGlmIChwb3NpdGlvbiA+PSAwKSB7XHJcblx0XHRcdHBvc2l0aW9uUmlnaHQgPSBwb3NpdGlvblJpZ2h0IC0gc3RlcDtcclxuXHRcdFx0bGlzdC5zdHlsZS5yaWdodCA9IHBvc2l0aW9uUmlnaHQgKyBcInB4XCI7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0bGV0IGluaXRpYWwgPSAoKSA9PiB7XHJcblx0XHRsaXN0LnN0eWxlLnJpZ2h0ID0gcG9zaXRpb25SaWdodDtcclxuXHJcblx0XHRyaWdodC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRcdF9yaWdodChwb3NpdGlvblJpZ2h0ICsgc3RlcCk7XHJcblx0XHR9KTtcclxuXHJcblx0XHRsZWZ0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdFx0X2xlZnQocG9zaXRpb25SaWdodCAtIHN0ZXApO1xyXG5cdFx0fSk7XHJcblxyXG5cdH07XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRpbml0OiBpbml0aWFsXHJcblx0fVxyXG59O1xyXG5cclxuc2xpZGVyKHtcclxuXHR3cmFwcGVyOiAnLmJ1cmdlcl9fd3JhcHBlcicsXHJcblx0bGlzdDogJy5idXJnZXJfX2xpc3QnLFxyXG5cdGl0ZW06ICcuYnVyZ2VyX19pdGVtJyxcclxuXHRyaWdodDogJy5idXJnZXJfX2Fycm93cy1pdGVtLS1yaWdodCcsXHJcblx0bGVmdDogJy5idXJnZXJfX2Fycm93cy1pdGVtLS1sZWZ0J1xyXG59KS5pbml0KCk7XHJcblxyXG5cclxuXHJcbi8qZW5kIHNsaWRlciovXHJcblxyXG5cclxuLypzdGFydCBtYXAgKi9cclxudmFyIHBsYWNlbWFya3MgPSBbXHJcblx0e1xyXG5cdFx0bGF0aXR1ZGU6IDU5Ljk3LCBcclxuXHRcdGxhbmdldHVkZTogMzAuMzEsXHJcblx0XHRoaW50Q29udGVudDogJ9GD0LsuINCb0LjRgtC10YDQsNGC0L7RgNC+0LIsINC00L7QvCAxMCcsXHJcblx0XHRiYWxsb29uQ29udGVudDogJ9Ch0LDQvNGL0LUg0LLQutGD0YHQvdGL0LUg0LHRg9GA0LPQtdGA0Ysg0YMg0L3QsNGBISdcclxuXHJcblx0fSxcclxuXHR7XHJcblx0XHRsYXRpdHVkZTogNTkuOTQsIFxyXG5cdFx0bGFuZ2V0dWRlOiAzMC4yNSxcclxuXHRcdGhpbnRDb250ZW50OiAn0JzQsNC70YvQuSDQv9GA0L7RgdC/0LXQutGCINCSINCeLCDQtNC+0LwgNjQnLFxyXG5cdFx0YmFsbG9vbkNvbnRlbnQ6ICfQodCw0LzRi9C1INCy0LrRg9GB0L3Ri9C1INCx0YPRgNCz0LXRgNGLINGDINC90LDRgSEnXHJcblx0fSxcclxuXHR7XHJcblx0XHRsYXRpdHVkZTogNTkuOTMsIFxyXG5cdFx0bGFuZ2V0dWRlOiAzMC4zNCxcclxuXHRcdGhpbnRDb250ZW50OiAn0L3QsNCxLiDRgNC10LrQuCDQpNC+0L3RgtCw0L3QutC4LCDQtC4gNTYnLFxyXG5cdFx0YmFsbG9vbkNvbnRlbnQ6ICfQodCw0LzRi9C1INCy0LrRg9GB0L3Ri9C1INCx0YPRgNCz0LXRgNGLINGDINC90LDRgSEnXHJcblx0fVxyXG5dO1xyXG5cclxuXHJcbnltYXBzLnJlYWR5KGluaXQpO1xyXG5cclxuZ2VvT2JqZWN0cyA9IFtdO1xyXG5cclxuZnVuY3Rpb24gaW5pdCgpIHtcclxuXHR2YXIgbWFwID0gbmV3IHltYXBzLk1hcCgnbWFwJywge1xyXG5cdFx0Y2VudGVyOiBbNTkuOTQsIDMwLjMyXSxcclxuXHRcdHpvb206IDEyLFxyXG5cdFx0Y29udHJvbHM6IFsnem9vbUNvbnRyb2wnXSxcclxuXHRcdGJlaGF2aW9yczogWydkcmFnJ11cclxuXHR9KTtcclxuXHJcblx0Zm9yKHZhciBpPTA7IGkgPCBwbGFjZW1hcmtzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRnZW9PYmplY3RzW2ldID0gbmV3IHltYXBzLlBsYWNlbWFyayhbcGxhY2VtYXJrc1tpXS5sYXRpdHVkZSwgcGxhY2VtYXJrc1tpXS5sYW5nZXR1ZGVdLCBcclxuXHRcdFx0e1xyXG5cdFx0XHRcdGhpbnRDb250ZW50OiBwbGFjZW1hcmtzW2ldLmhpbnRDb250ZW50LFxyXG5cdFx0XHRcdGJhbGxvb25Db250ZW50OiBwbGFjZW1hcmtzW2ldLmJhbGxvb25Db250ZW50XHJcblx0XHRcdH0sXHJcblx0XHRcdHtcclxuXHRcdFx0XHRpY29uTGF5b3V0OiAnZGVmYXVsdCNpbWFnZScsXHJcblx0XHRcdFx0aWNvbkltYWdlSHJlZjogJ2ltYWdlcy9pY29ucy9tYXAtbWFya2VyLnN2ZycsXHJcblx0XHRcdFx0aWNvbkltYWdlU2l6ZTogWzQ2LCA1N10sXHJcblx0XHRcdFx0aWNvbkltYWdlT2Zmc2V0OiBbLTIzLCAtNTddXHJcblx0XHRcdH0pO1x0XHJcblx0fVxyXG5cclxuXHR2YXIgY2x1c3RlcmVyID0gbmV3IHltYXBzLkNsdXN0ZXJlcih7XHJcblx0XHRjbHVzdGVySWNvbnM6IFtcclxuXHRcdFx0e1xyXG5cdFx0XHRcdGhyZWY6IFwiL2ltYWdlcy9zZWN0aW9uLW1haW4vYnVyZ2VyLnBuZ1wiLFxyXG5cdFx0XHRcdHNpemU6IFsxMDAsIDEwMF0sXHJcblx0XHRcdFx0b2Zmc2V0OiBbLTUwLCAtNTBdXHJcblx0XHRcdH1cclxuXHRcdF0sXHJcblx0XHRjbHVzdGVySWNvbkNvbnRlbnRMYXlvdXQ6IG51bGxcclxuXHR9KTtcclxuXHRcclxuXHRtYXAuZ2VvT2JqZWN0cy5hZGQoY2x1c3RlcmVyKTtcclxuXHRjbHVzdGVyZXIuYWRkKGdlb09iamVjdHMpO1xyXG59XHJcblxyXG4vKmVuZCBtYXAgKi9cclxuXHJcblxyXG4vKnN0YXJ0IE9QUyAqL1xyXG5jb25zdCBzZWN0aW9ucyA9ICQoJy5zZWN0aW9uJyk7XHJcbmNvbnN0IGRpc3BsYXkgPSAkKCcuY29udGVudCcpO1xyXG5jb25zdCBkb3RzID0gJCgnLnBhZ2luYXRvcl9faXRlbScpO1xyXG5cclxubGV0IGluc2Nyb2xsID0gZmFsc2U7XHJcblxyXG5jb25zdCBtZCA9IG5ldyBNb2JpbGVEZXRlY3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xyXG5jb25zdCBpc0l0TW9iaWxlID0gbWQubW9iaWxlKCk7XHJcblxyXG5jb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IHNlY3Rpb25FcSA9PiB7XHJcblx0XHJcblx0aWYoaW5zY3JvbGwpIHJldHVybjtcclxuXHJcblx0aW5zY3JvbGwgPSB0cnVlO1xyXG5cclxuXHRzZWN0aW9uRXEgPSBwYXJzZUludChzZWN0aW9uRXEpO1xyXG5cclxuXHRjb25zdCBwb3NpdGlvbiA9IChzZWN0aW9uRXEgKiAtMTAwKSArICclJztcclxuXHJcblxyXG5cdHNlY3Rpb25zLmVxKHNlY3Rpb25FcSlcclxuXHRcdC5hZGRDbGFzcygnYWN0aXZlJylcclxuXHRcdC5zaWJsaW5ncygpXHJcblx0XHQucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cclxuXHRkb3RzLmVxKHNlY3Rpb25FcSlcclxuXHRcdC5hZGRDbGFzcygncGFnaW5hdG9yX19pdGVtLS1hY3RpdmUnKVxyXG5cdFx0LnNpYmxpbmdzKClcclxuXHRcdC5yZW1vdmVDbGFzcygncGFnaW5hdG9yX19pdGVtLS1hY3RpdmUnKTtcclxuXHJcblx0c2V0VGltZW91dCgoKSA9PiB7XHJcblx0XHRpbnNjcm9sbCA9IGZhbHNlO1xyXG5cdH0sIDEzMDApO1xyXG5cdGRpc3BsYXkuY3NzKHtcclxuXHRcdCd0cmFuc2Zvcm0nIDogJ3RyYW5zbGF0ZVkoJyArIChwb3NpdGlvbikgKyAnKSdcclxuXHR9KTtcclxuXHRcclxufVxyXG5cclxuY29uc3QgZGVmaW5lU2VjdGlvbnMgPSBzZWN0aW9ucyA9PiB7XHJcblx0Y29uc3QgYWN0aXZlU2VjdGlvbiA9IHNlY3Rpb25zLmZpbHRlcignLmFjdGl2ZScpO1xyXG5cdHJldHVybiB7XHJcblx0XHRhY3RpdmVTZWN0aW9uOiBhY3RpdmVTZWN0aW9uLFxyXG5cdFx0bmV4dFNlY3Rpb246IGFjdGl2ZVNlY3Rpb24ubmV4dCgpLFxyXG5cdFx0cHJldlNlY3Rpb246IGFjdGl2ZVNlY3Rpb24ucHJldigpXHJcblx0fVxyXG5cclxufVxyXG5cclxuY29uc3Qgc2Nyb2xsVG9TZWN0aW9uID0gZGlyZWN0aW9uID0+IHtcclxuXHRjb25zdCBzZWN0aW9uID0gZGVmaW5lU2VjdGlvbnMoc2VjdGlvbnMpO1xyXG5cclxuXHRpZihkaXJlY3Rpb24gPT0gJ3VwJyAmJiBzZWN0aW9uLm5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG5cdFx0cGVyZm9ybVRyYW5zaXRpb24oc2VjdGlvbi5uZXh0U2VjdGlvbi5pbmRleCgpKTtcclxuXHR9XHJcblxyXG5cdGlmKGRpcmVjdGlvbiA9PSBcImRvd25cIiAmJiBzZWN0aW9uLnByZXZTZWN0aW9uLmxlbmd0aCkge1xyXG5cdFx0cGVyZm9ybVRyYW5zaXRpb24oc2VjdGlvbi5wcmV2U2VjdGlvbi5pbmRleCgpKTtcclxuXHR9XHJcbn1cclxuXHJcbiQoJy53cmFwcGVyJykub24oe1xyXG5cdHdoZWVsOiBlID0+IHtcclxuXHRcdGNvbnN0IGRlbHRhWSA9IGUub3JpZ2luYWxFdmVudC5kZWx0YVk7XHJcblx0XHRjb25zdCBkaXJlY3Rpb24gPSAoZGVsdGFZPjApIFxyXG5cdFx0PyAndXAnIFxyXG5cdFx0OiAnZG93bic7XHJcblx0XHRzY3JvbGxUb1NlY3Rpb24oZGlyZWN0aW9uKTtcclxuXHR9LFxyXG5cdHRvdWNobW92ZTogZSA9PiAoZS5wcmV2ZW50RGVmYXVsdCgpKVxyXG59KTtcclxuXHJcblxyXG4vKk9QUyBrZXlib2FyZCAqL1xyXG4kKGRvY3VtZW50KS5vbigna2V5ZG93bicsIGUgPT4ge1xyXG5cclxuXHRjb25zb2xlLmxvZyhlLmtleUNvZGUpO1xyXG5cdHN3aXRjaChlLmtleUNvZGUpIHtcclxuXHRcdGNhc2UgNDA6IC8vdXBcclxuXHRcdFx0c2Nyb2xsVG9TZWN0aW9uKCd1cCcpXHJcblx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdGNhc2UgMzg6IC8vZG93blxyXG5cdFx0XHRzY3JvbGxUb1NlY3Rpb24oJ2Rvd24nKVxyXG5cdFx0XHRicmVhaztcclxuXHR9XHJcblxyXG59KTtcclxuXHJcbiQoJ1tkYXRhLXNjcm9sbC10b10nKS5vbignY2xpY2snLCBlID0+IHtcclxuXHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0Y29uc3Qgc2VjdGlvbk51bSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKCdkYXRhLXNjcm9sbC10bycpO1xyXG5cdHBlcmZvcm1UcmFuc2l0aW9uKHNlY3Rpb25OdW0pO1xyXG59KVxyXG5cclxuXHJcbi8qc3RhcnQgbW9iaWxlIG9wcyAqL1xyXG5pZihpc0l0TW9iaWxlKSB7XHJcblx0JCh3aW5kb3cpLnN3aXBlKCB7XHJcblx0XHRzd2lwZTpmdW5jdGlvbihcclxuXHRcdFx0ZXZlbnQsXHJcblx0XHRcdGRpcmVjdGlvblxyXG5cdFx0KSB7XHJcblx0XHRcdHNjcm9sbFRvU2VjdGlvbihkaXJlY3Rpb24pO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59XHJcblxyXG5cclxuLyplbmQgT1BTICovXHJcblxyXG5cclxuLypzdGFydCBIVE1MNSB2aWRlbyAqL1xyXG5sZXQgdmlkZW87XHJcbmxldCBkdXJhdGlvbkNvbnRyb2w7IFxyXG5sZXQgc291bmRDb250cm9sO1xyXG5sZXQgaW50ZXJ2YWxJZDtcclxuXHJcbi8vINC00L7QutGD0LzQtdC90YIg0L/QvtC70L3QvtGB0YLRjNGOINC30LDQs9GA0YPQttC10L1cclxuJCgpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcbiAgICB2aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyXCIpOyBcclxuXHJcbiAgICAvLyDQstC10YjQsNC10Lwg0L7QsdGA0LDQsdC+0YLRh9C40Log0YHQvtCx0YvRgtC40Y8gb25jbGljayDQvdCwINGC0LXQsyB2aWRlb1xyXG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwbGF5U3RvcCk7XHJcblxyXG4gICAgLy8g0L7QsdGA0LDQsdC+0YLRh9C40LrQuCDRgdC+0LHRi9GC0LjQuSDQtNC70Y8g0LrQvdC+0L/QvtC6IHBsYXlcclxuICAgIGxldCBwbGF5QnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucGxheVwiKTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGxheUJ1dHRvbnMubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgcGxheUJ1dHRvbnNbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLHBsYXlTdG9wKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDQvtCx0YDQsNCx0L7RgtGH0LjQuiDRgdC+0LHRi9GC0LjQuSDQtNC70Y8g0LrQvdC+0L/QutC4INC00LjQvdCw0LzQuNC6XHJcbiAgICBsZXQgbWljQ29udHJvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWljXCIpO1xyXG4gICAgbWljQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsc291bmRPZilcclxuICAgIFxyXG4gICAgLy8g0L7QsdGA0LDQsdC+0YLRh9C40LrQuCDRgdC+0LHRi9GC0LjQuSDQtNC70Y8g0L/QvtC70LfRg9C90LrQsCDQv9GA0L7QtNC+0LvQttC40YLQtdC70YzQvdC+0YHRgtC4INCy0LjQtNC10L5cclxuICAgIGR1cmF0aW9uQ29udHJvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZHVyYXRpb25MZXZlbFwiKTsgICAgXHJcbiAgICBkdXJhdGlvbkNvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLHNldFZpZGVvRHVyYXRpb24pO1xyXG4gICAgZHVyYXRpb25Db250cm9sLmFkZEV2ZW50TGlzdGVuZXIoJ29ubW91c2Vtb3ZlJyxzZXRWaWRlb0R1cmF0aW9uKTtcclxuICAgIGR1cmF0aW9uQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBzdG9wSW50ZXJ2YWwpOyBcclxuICAgIGR1cmF0aW9uQ29udHJvbC5taW4gPSAwO1xyXG4gICAgZHVyYXRpb25Db250cm9sLnZhbHVlID0gMDsgICAgXHJcblxyXG4gICAgLy8g0L7QsdGA0LDQsdC+0YLRh9C40LrQuCDRgdC+0LHRi9GC0LjQuSDQtNC70Y8g0L/QvtC70LfRg9C90LrQsCDQs9GA0L7QvNC+0LrQvtGB0YLQuFxyXG4gICAgc291bmRDb250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaWNMZXZlbFwiKTsgICAgXHJcbiAgICBzb3VuZENvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjaGFuZ2VTb3VuZFZvbHVtZSk7XHJcbiAgICBzb3VuZENvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignb25tb3VzZW1vdmUnLCBjaGFuZ2VTb3VuZFZvbHVtZSk7XHJcblxyXG4gICAgLy8g0LfQsNC00LDQtdC8INC80LDQutGB0LjQvNCw0LvRjNC90YvQtSDQuCDQvNC40L3QuNC80LDQu9GM0L3Ri9C1INC30L3QsNGH0LXQvdC40Y8g0LPRgNC+0LzQvtC60L7RgdGC0LhcclxuICAgIHNvdW5kQ29udHJvbC5taW4gPSAwO1xyXG4gICAgc291bmRDb250cm9sLm1heCA9IDEwO1xyXG4gICAgLy8g0L/RgNC40YHQstCw0LjQstCw0LXQvCDQv9C+0LvQt9GD0L3QutGDINC80LDQutGB0LjQvNCw0LvRjNC90L7QtSDQt9C90LDRh9C10L3QuNC1XHJcbiAgICBzb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZENvbnRyb2wubWF4O1xyXG4gICAgXHJcbn0pO1xyXG5cclxuLypcclxuINCS0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjQtSDQstC40LTQtdC+XHJcbiovXHJcbmZ1bmN0aW9uIHBsYXlTdG9wKCl7XHJcbiAgICAvLyDQv9C+0LrQsNC30YvQstCw0LXRgiDQuNC70Lgg0YHQutGA0YvQstCw0LXRgiDQsdC10LvRg9GOINC60L3QvtC/0LrRgyBwbGF5XHJcbiAgICAkKFwiLnZpZGVvX19wbGF5ZXItaW1nXCIpLnRvZ2dsZUNsYXNzKFwidmlkZW9fX3BsYXllci1pbWctLWFjdGl2ZVwiKTtcclxuICAgIFxyXG4gICAgLy8g0L/RgNC40YHQstCw0LjQstCw0LXQvCDQv9C+0LvQt9GD0L3QutGDINC/0YDQvtC00L7Qu9C20LjRgtC10LvRjNC90L7RgdGC0Lgg0LzQsNC60YHQuNC80LDQu9GM0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0YDQsNCy0L3QvtC1INC/0YDQvtC00L7Qu9C20LjRgtC10LvRjNC90L7RgdGC0Lgg0L3QsNGI0LXQs9C+INCy0LjQtNC10L4gKNCyINGB0LXQutGD0L3QtNCw0YUpXHJcbiAgICBkdXJhdGlvbkNvbnRyb2wubWF4ID0gdmlkZW8uZHVyYXRpb247XHJcblxyXG4gICAgLy8g0L/RgNC+0LLQtdGA0LjQvCDRgdGC0L7QuNGCINC70Lgg0LLQuNC00LXQviDQvdCwINC/0LDRg9C30LUsINC10YHQu9C4INC00LAg0YLQviDQv9GA0L7QtNC+0LvQttC40Lwg0LLQvtGB0L/RgNC+0LjQt9Cy0LXQtNC10L3QuNC1LiDQldGB0LvQuCwg0L3QsNC+0LHQvtGA0L7Rgiwg0L/RgNC+0LjQs9GA0YvQsNCy0YvQtdGC0YHRjywg0YLQviDQvtGB0YLQsNC90L7QstC40LwuXHJcbiAgICBpZiAodmlkZW8ucGF1c2VkKXtcclxuICAgICAgICAvLyDQt9Cw0L/Rg9GB0LrQsNC10Lwg0LLQuNC00LXQvlxyXG4gICAgICAgIHZpZGVvLnBsYXkoKTtcclxuICAgICAgICBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwodXBkYXRlRHVyYXRpb24sMSlcclxuICAgICAgICAvLyB2aWRlby53ZWJraXRSZXF1ZXN0RnVsbFNjcmVlbigpOyDQstC+0LfQvNC+0LbQvdC+0YHRgtGMINC+0YLQutGA0YvRgtGMINCyINC/0L7Qu9C90L7RjdC60YDQsNC90L3QvtC8INGA0LXQttC40LzQtVxyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgLy8g0L7RgdGC0LDQvdCw0LLQu9C40LLQsNC10Lwg0LLQuNC00LXQvlxyXG4gICAgICAgIHZpZGVvLnBhdXNlKCk7ICBcclxuICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xyXG4gICAgICAgIC8vIGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKCk7INCy0YvQudGC0Lgg0LjQtyDQv9C+0LvQvdC+0Y3QutGA0LDQvdC90L7Qs9C+INGA0LXQttC40LzQsFxyXG4gICAgfVxyXG59XHJcblxyXG4vKlxyXG4gICAg0KPQv9GA0LDQstC70LXQvdC40LUg0LfQstGD0LrQvtC8XHJcbiovXHJcbmZ1bmN0aW9uIHNvdW5kT2YoKXsgICAgXHJcbiAgICAvKlxyXG4gICAgICAgINCU0LXQu9Cw0LXQvCDQv9GA0L7QstC10YDQutGDINGD0YDQvtCy0L3RjyDQs9GA0L7QvNC60L7RgdGC0LguIFxyXG4gICAgICAgINCV0YHQu9C4INGDINC90LDRgSDQvdCw0YjQtdCz0L4g0LLQuNC00LXQviDQtdGB0YLRjCDQt9Cy0YPQuiwg0YLQviDQvNGLINC10LPQviDQstGL0LrQu9GO0YfQsNC10LwuIFxyXG4gICAgICAgINCf0YDQtdC00LLQsNGA0LjRgtC10LvRjNC90L4g0LfQsNC/0L7QvNC90LjQsiDRgtC10LrRg9GJ0YPRjiDQv9C+0LfQuNGG0LjRjiDQs9GA0L7QvNC60L7RgdGC0Lgg0LIg0L/QtdGA0LXQvNC10L3QvdGD0Y4gc291bmRMZXZlbFxyXG4gICAgKi9cclxuICAgIGlmICh2aWRlby52b2x1bWUgPT09MCl7XHJcbiAgICAgICAgdmlkZW8udm9sdW1lID0gc291bmRMZXZlbDtcclxuICAgICAgICBzb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZExldmVsKjEwO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgLypcclxuICAgICAgICAgICAg0JXRgdC70Lgg0YMg0L3QsNGI0LXQs9C+INCy0LjQtNC10L4g0L3QtdGCINC30LLRg9C60LAsINGC0L4g0LLRi9GB0YLQsNCy0LvRj9C10Lwg0YPRgNC+0LLQtdC90Ywg0LPRgNC+0LzQutC+0YHRgtC4INC90LAg0L/RgNC10LbQvdC40Lkg0YPRgNC+0LLQtdC90YwuXHJcbiAgICAgICAgICAgINCl0YDQsNC90LjRgtGB0Y8g0LIg0L/QtdGA0LzQtdC90L3QvtC5IHNvdW5kTGV2ZWxcclxuICAgICAgICAqL1xyXG4gICAgICAgIHNvdW5kTGV2ZWwgPSB2aWRlby52b2x1bWU7XHJcbiAgICAgICAgdmlkZW8udm9sdW1lID0gMDtcclxuICAgICAgICBzb3VuZENvbnRyb2wudmFsdWUgPSAwO1xyXG4gICAgfSAgICBcclxufVxyXG5cclxuZnVuY3Rpb24gc3RvcEludGVydmFsKCl7XHJcbiAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xyXG59XHJcblxyXG4vKlxyXG4gICAg0KDQtdCw0LvQuNC30YPQtdGCINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0L/QtdGA0LXQvNC+0YLQutC4INC90LDRiNC10LPQviDQstC40LTQtdC+XHJcbiovXHJcbmZ1bmN0aW9uIHNldFZpZGVvRHVyYXRpb24oKXtcclxuICAgIHZpZGVvLmN1cnJlbnRUaW1lID0gZHVyYXRpb25Db250cm9sLnZhbHVlOyAgIFxyXG4gICAgaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKHVwZGF0ZUR1cmF0aW9uLDEwMDAvNjYpOyAgICBcclxufVxyXG5cclxuLypcclxuICAgINCj0L/RgNCw0LLQu9C10L3QuNC1INC30LLRg9C60L7QvCDQstC40LTQtdC+XHJcbiovXHJcbmZ1bmN0aW9uIGNoYW5nZVNvdW5kVm9sdW1lKCl7XHJcbiAgICAvKlxyXG4gICAgICAgINCh0LIt0LLQviB2b2x1bWUg0LzQvtC20LXRgiDQv9GA0LjQvdC40LzQsNGC0Ywg0LfQvdCw0YfQtdC90LjRjyDQvtGCIDAg0LTQviAxXHJcbiAgICAgICAg0JTQtdC70LjQvCDQvdCwIDEwINC00LvRjyDRgtC+0LPQviDRh9GC0L4g0LHRiywg0LHRi9C70LAg0LLQvtC30LzQvtC20L3QvtGB0YLRjCDQsdC+0LvQtdC1INGC0L7Rh9C90L7QuSDRgNC10LPRg9C70LjRgNC+0LLQutC4INCy0LjQtNC10L4uIFxyXG4gICAgKi9cclxuICAgIHZpZGVvLnZvbHVtZSA9IHNvdW5kQ29udHJvbC52YWx1ZS8xMDsgIFxyXG59XHJcblxyXG4vKlxyXG4gINCk0YPQvdC60YbQuNGPINC00LvRjyDQvtCx0L3QvtCy0LvQtdC90LjRjyDQv9C+0LfQuNGG0LjQuCDQv9C+0LvQt9GD0L3QutCwINC/0YDQvtC00L7Qu9C20LjRgtC10LvRjNC90L7RgdGC0Lgg0LLQuNC00LXQvi4gICBcclxuKi9cclxuZnVuY3Rpb24gdXBkYXRlRHVyYXRpb24oKXsgICAgXHJcbiAgICBkdXJhdGlvbkNvbnRyb2wudmFsdWUgPSB2aWRlby5jdXJyZW50VGltZTtcclxufVxyXG4vKmVuZCBIVE1MNSB2aWRlbyAqLyJdfQ==
