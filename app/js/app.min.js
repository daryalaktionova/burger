/* Overlay menu */

  
  let menu = (function(options) {

    let button = document.querySelector(options.button);
    let menu = document.querySelector(options.menu);
    let body = document.querySelector('body');
    let link = document.querySelectorAll(".overlay-menu__link");
    



    let _toggleMenu = function(e) {
      button.classList.toggle('hamburger-bar--active');
      menu.classList.toggle('overlay--open');
      body.classList.toggle('body-active-menu');
    }

    let addListeners = function() {
      button.addEventListener('click', _toggleMenu);
        for (i=0;i<link.length;i++){
          link[i].addEventListener('click', _toggleMenu);
        }
    }

    
    return {
        openMenu: addListeners
      };

  })({
    button: '#toggle',
    menu: '#overlay'
  });

  menu.openMenu();


/*end overlay menu */

/*Accodeon team*/
let teamAccordeon = (function() {

    let linkAccordeon = document.querySelectorAll('.accordeon__link');
    
    linkAccordeon.forEach(function(personName) {
    personName.addEventListener('click', function(e) {
          e.preventDefault();
          let activePerson = document.querySelector('.accordeon__item.accordeon__item--is-active');
          if(activePerson) {
            let teamAccordeonDetails = activePerson.querySelector('.accordeon-content');
            teamAccordeonDetails.style.maxHeight = "";
            activePerson.classList.remove('accordeon__item--is-active');
          }
					
          if(!activePerson || activePerson.querySelector('.accordeon__link') !== this) {
            let currentPerson = this.closest('.accordeon__item');
            currentPerson.classList.add('accordeon__item--is-active');
            let currentPersonInfo = currentPerson.querySelector('.accordeon-content');
            currentPersonInfo.style.maxHeight = currentPersonInfo.scrollHeight + 'px';
          }
        })
    })
  })

teamAccordeon();
/*end Accordeon team */

/* Start accordeon horizontal */
let menuAccordeon = (function() {

    let linkMenuAccordeon = document.querySelectorAll('.accordeon-menu__link');
    let userWidth = window.innerWidth;
    let list = document.querySelector('.accordeon-menu__list');
    let itemsList = list.querySelectorAll('.accordeon-menu__item');
		let titleItem = list.querySelector('.accordeon-menu__link');
		let widthTitle = titleItem.clientWidth;
		var neededWidth = userWidth - itemsList.length * widthTitle;
		neededWidth = (neededWidth > 520) ? '520px' : neededWidth + 'px';
    
    let forEachMenuAccordeon = linkMenuAccordeon.forEach(function(categoryName) {
    categoryName.addEventListener('click', function(e) {
          e.preventDefault();
          let activeCategory = document.querySelector('.accordeon-menu__item.accordeon-menu__item--is-active');
          if(activeCategory) {
            let menuAccordeonDetails = activeCategory.querySelector('.accordeon-menu__item-content');
            menuAccordeonDetails.style.maxWidth = "";
            activeCategory.classList.remove('accordeon-menu__item--is-active');
          }

          if(!activeCategory|| activeCategory.querySelector('.accordeon-menu__link') !== this) {
            let currentCategory = this.closest('.accordeon-menu__item');
            currentCategory.classList.add('accordeon-menu__item--is-active');
            let currentCategoryInfo = currentCategory.querySelector('.accordeon-menu__item-content');
            currentCategoryInfo.style.maxWidth = neededWidth;
          }
        })
    })
  })

menuAccordeon();

/*End accordeon horinzontal */



/* popup */
let popup = (function(options) {
	let wrapper = document.querySelector('.reviews__list');

	let _tooglePopup = (function(e) {
		e.preventDefault();

		if (e.target.className == options.button) {
			_openPopup(e.target);
		}
	});

	let _openPopup = (function(button){
		let overlay = document.createElement('div');
		overlay.classList.add('overlay');

		let popupWindow = document.createElement('div');
		popupWindow.classList.add('popup');

		let contentText = document.createElement('div');
		contentText.classList.add('popup__content');

		let content = button.parentNode;

		let text = content.querySelector(options.text).textContent;
	 

		let titleItem= document.createElement('div');
		titleItem.classList.add('popup__title');

    let title = content.querySelector(options.title).textContent;
    contentText.innerHTML = 'Ошибка отправки данных';
    contentText.innerHTML = text;
    titleItem.innerHTML = title;

		let closeIcon = document.createElement("a");
		closeIcon.classList.add("popup__close");
		closeIcon.innerHTML = '<svg class="popup__close-image"><use xlink:href="./images/icons/sprite.svg#close"></use></svg>';
		closeIcon.href = "#";
		closeIcon.addEventListener("click", (function(e){
			e.preventDefault();
			_closePopup(overlay);
		}));

		overlay.appendChild(popupWindow);
		popupWindow.appendChild(titleItem);
		popupWindow.appendChild(contentText);
		popupWindow.appendChild(closeIcon);

		document.body.appendChild(overlay);
	});

	let _closePopup = (function(overlay) {
		document.body.removeChild(overlay);
	});

	let addListeners = (function() {
		wrapper.addEventListener('click', _tooglePopup)
	});

	return {
		init: addListeners
	}
});

popup({
	button: "reviews__button",
	title: ".reviews__title",
	text: ".reviews__text"
}).init();


/* end popup */

/* form*/

let formFunction = (function(options) {

  const myForm = document.querySelector('#myForm');
  const send = document.querySelector('#send');
  const data = {
    name: myForm.elements.name.value,
    phone: myForm.elements.phone.value,
    comment: myForm.elements.comment.value,
    to: "segezmundovna@gmail.com"
  };

	let _ajaxInquiry = (function(e){
    e.preventDefault();
		let overlay = document.createElement('div');
		overlay.classList.add('overlay');
		let popupWindow = document.createElement('div');
		popupWindow.classList.add('popup--form');
		let contentText = document.createElement('div');
		contentText.classList.add('popup__content');

    const xhr = new XMLHttpRequest();
    xhr.responseType = 'json';
    //xhr.open('GET', 'https://webdev-api.loftschool.com/sendmail/fail'); //для отрицательного ответа
    xhr.open('POST', 'http://test.local/mail.php');   //для положительного ответа
    xhr.send(JSON.stringify(data));
    xhr.addEventListener('load', () => {
      
      if(xhr.status>=400) {
        let content = 'Ошибка, данные не отправлены, попробуйте позже';
        contentText.innerHTML = content;
      } else {
        if(xhr.response.status) {
          let content = 'Сообщение отправлено';
          contentText.innerHTML = content;
      } else {
          let content = 'Соединение с сервером не установлено';
          contentText.innerHTML = content;
      }
      }
    })
    
		let closeIcon = document.createElement("a");
		closeIcon.classList.add("popup__close-button");
		closeIcon.innerHTML = 'Закрыть';
		closeIcon.href = "#";
		closeIcon.addEventListener("click", (function(e){
			e.preventDefault();
			_closePopup(overlay);
    }));


		overlay.appendChild(popupWindow);
		popupWindow.appendChild(contentText);
		popupWindow.appendChild(closeIcon);
    document.body.appendChild(overlay);
  
	});

	let _closePopup = (function(overlay) {
		document.body.removeChild(overlay);
	});

	let addListeners = (function() {
    send.addEventListener('click', _ajaxInquiry)
	});

	return {
		init: addListeners
	}
});

formFunction({
	text: ".reviews__text"
}).init();


/*end form */

/* start burger__composition */
let isMobile = () => {
  let screen = document.documentElement.clientWidth;
	let mobile = false;
	if(screen<=768){
    mobile = true;
  } 
	return mobile;
};

let mobileComposition = () => {
		let burgersCompositions = document.querySelectorAll('.burger__composition');
		let buttonsCloseComposition = document.querySelectorAll('.dropdown__close-image');

	for (i=0;i<burgersCompositions.length;i++){
		burgersCompositions[i].addEventListener('mouseenter', e => {
			document.querySelector('.burger__composition').classList.add('active');
		});
		if (isMobile) {
			burgersCompositions[i].addEventListener('click', e => {
				document.querySelector('.burger__composition').classList.add('active');
			});
		}
	}

	for (i=0;i<burgersCompositions.length;i++){
		burgersCompositions[i].addEventListener('mouseleave', e => {
			document.querySelector('.burger__composition').classList.remove('active');
		});
	}


	for (i=0;i<buttonsCloseComposition.length;i++){
			buttonsCloseComposition[i].addEventListener('click', e => {
				e.preventDefault();
				document.querySelector('.burger__composition').classList.remove('active');
			});
		}
	};
	mobileComposition();





/* end burger__composition*/

/* slider*/

let slider = options => {
	let wrapper = document.querySelector(options.wrapper);
	let width = wrapper.clientWidth;
	wrapper.style.width = width  + 'px';
	let step = width;
	let list = document.querySelector(options.list);
	let items = document.querySelectorAll(options.item);

	let left = document.querySelector(options.left);
	let right = document.querySelector(options.right);

	items.forEach(element => {
		element.style.width = width  + 'px';
	});

	let positionMaxRight = width * (items.length - 1);

	let positionRight = 0;

	let _right = position => {
		if (position <= positionMaxRight) {
			positionRight = positionRight + step;
			list.style.right = positionRight + "px";
		}
	};

	let _left = position => {
		if (position >= 0) {
			positionRight = positionRight - step;
			list.style.right = positionRight + "px";
		}
	};

	let initial = () => {
		list.style.right = positionRight;

		right.addEventListener("click", e => {
			e.preventDefault();

			_right(positionRight + step);
		});

		left.addEventListener("click", e => {
			e.preventDefault();

			_left(positionRight - step);
		});

	};

	return {
		init: initial
	}
};

slider({
	wrapper: '.burger__wrapper',
	list: '.burger__list',
	item: '.burger__item',
	right: '.burger__arrows-item--right',
	left: '.burger__arrows-item--left'
}).init();



/*end slider*/


/*start map */
var placemarks = [
	{
		latitude: 59.97, 
		langetude: 30.31,
		hintContent: 'ул. Литераторов, дом 10',
		balloonContent: 'Самые вкусные бургеры у нас!'

	},
	{
		latitude: 59.94, 
		langetude: 30.25,
		hintContent: 'Малый проспект В О, дом 64',
		balloonContent: 'Самые вкусные бургеры у нас!'
	},
	{
		latitude: 59.93, 
		langetude: 30.34,
		hintContent: 'наб. реки Фонтанки, д. 56',
		balloonContent: 'Самые вкусные бургеры у нас!'
	}
];


ymaps.ready(init);

geoObjects = [];

function init() {
	var map = new ymaps.Map('map', {
		center: [59.94, 30.32],
		zoom: 12,
		controls: ['zoomControl'],
		behaviors: ['drag']
	});

	for(var i=0; i < placemarks.length; i++) {
		geoObjects[i] = new ymaps.Placemark([placemarks[i].latitude, placemarks[i].langetude], 
			{
				hintContent: placemarks[i].hintContent,
				balloonContent: placemarks[i].balloonContent
			},
			{
				iconLayout: 'default#image',
				iconImageHref: 'images/icons/map-marker.svg',
				iconImageSize: [46, 57],
				iconImageOffset: [-23, -57]
			});	
	}

	var clusterer = new ymaps.Clusterer({
		clusterIcons: [
			{
				href: "/images/section-main/burger.png",
				size: [100, 100],
				offset: [-50, -50]
			}
		],
		clusterIconContentLayout: null
	});
	
	map.geoObjects.add(clusterer);
	clusterer.add(geoObjects);
}

/*end map */


/*start OPS 


/*end OPS */
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIE92ZXJsYXkgbWVudSAqL1xyXG5cclxuICBcclxuICBsZXQgbWVudSA9IChmdW5jdGlvbihvcHRpb25zKSB7XHJcblxyXG4gICAgbGV0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5idXR0b24pO1xyXG4gICAgbGV0IG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMubWVudSk7XHJcbiAgICBsZXQgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcclxuICAgIGxldCBsaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5vdmVybGF5LW1lbnVfX2xpbmtcIik7XHJcbiAgICBcclxuXHJcblxyXG5cclxuICAgIGxldCBfdG9nZ2xlTWVudSA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgYnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2hhbWJ1cmdlci1iYXItLWFjdGl2ZScpO1xyXG4gICAgICBtZW51LmNsYXNzTGlzdC50b2dnbGUoJ292ZXJsYXktLW9wZW4nKTtcclxuICAgICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdib2R5LWFjdGl2ZS1tZW51Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGFkZExpc3RlbmVycyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfdG9nZ2xlTWVudSk7XHJcbiAgICAgICAgZm9yIChpPTA7aTxsaW5rLmxlbmd0aDtpKyspe1xyXG4gICAgICAgICAgbGlua1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF90b2dnbGVNZW51KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIG9wZW5NZW51OiBhZGRMaXN0ZW5lcnNcclxuICAgICAgfTtcclxuXHJcbiAgfSkoe1xyXG4gICAgYnV0dG9uOiAnI3RvZ2dsZScsXHJcbiAgICBtZW51OiAnI292ZXJsYXknXHJcbiAgfSk7XHJcblxyXG4gIG1lbnUub3Blbk1lbnUoKTtcclxuXHJcblxyXG4vKmVuZCBvdmVybGF5IG1lbnUgKi9cclxuXHJcbi8qQWNjb2Rlb24gdGVhbSovXHJcbmxldCB0ZWFtQWNjb3JkZW9uID0gKGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIGxldCBsaW5rQWNjb3JkZW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFjY29yZGVvbl9fbGluaycpO1xyXG4gICAgXHJcbiAgICBsaW5rQWNjb3JkZW9uLmZvckVhY2goZnVuY3Rpb24ocGVyc29uTmFtZSkge1xyXG4gICAgcGVyc29uTmFtZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgIGxldCBhY3RpdmVQZXJzb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uX19pdGVtLmFjY29yZGVvbl9faXRlbS0taXMtYWN0aXZlJyk7XHJcbiAgICAgICAgICBpZihhY3RpdmVQZXJzb24pIHtcclxuICAgICAgICAgICAgbGV0IHRlYW1BY2NvcmRlb25EZXRhaWxzID0gYWN0aXZlUGVyc29uLnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tY29udGVudCcpO1xyXG4gICAgICAgICAgICB0ZWFtQWNjb3JkZW9uRGV0YWlscy5zdHlsZS5tYXhIZWlnaHQgPSBcIlwiO1xyXG4gICAgICAgICAgICBhY3RpdmVQZXJzb24uY2xhc3NMaXN0LnJlbW92ZSgnYWNjb3JkZW9uX19pdGVtLS1pcy1hY3RpdmUnKTtcclxuICAgICAgICAgIH1cclxuXHRcdFx0XHRcdFxyXG4gICAgICAgICAgaWYoIWFjdGl2ZVBlcnNvbiB8fCBhY3RpdmVQZXJzb24ucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbl9fbGluaycpICE9PSB0aGlzKSB7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50UGVyc29uID0gdGhpcy5jbG9zZXN0KCcuYWNjb3JkZW9uX19pdGVtJyk7XHJcbiAgICAgICAgICAgIGN1cnJlbnRQZXJzb24uY2xhc3NMaXN0LmFkZCgnYWNjb3JkZW9uX19pdGVtLS1pcy1hY3RpdmUnKTtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRQZXJzb25JbmZvID0gY3VycmVudFBlcnNvbi5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLWNvbnRlbnQnKTtcclxuICAgICAgICAgICAgY3VycmVudFBlcnNvbkluZm8uc3R5bGUubWF4SGVpZ2h0ID0gY3VycmVudFBlcnNvbkluZm8uc2Nyb2xsSGVpZ2h0ICsgJ3B4JztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxudGVhbUFjY29yZGVvbigpO1xyXG4vKmVuZCBBY2NvcmRlb24gdGVhbSAqL1xyXG5cclxuLyogU3RhcnQgYWNjb3JkZW9uIGhvcml6b250YWwgKi9cclxubGV0IG1lbnVBY2NvcmRlb24gPSAoZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgbGV0IGxpbmtNZW51QWNjb3JkZW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFjY29yZGVvbi1tZW51X19saW5rJyk7XHJcbiAgICBsZXQgdXNlcldpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbiAgICBsZXQgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tbWVudV9fbGlzdCcpO1xyXG4gICAgbGV0IGl0ZW1zTGlzdCA9IGxpc3QucXVlcnlTZWxlY3RvckFsbCgnLmFjY29yZGVvbi1tZW51X19pdGVtJyk7XHJcblx0XHRsZXQgdGl0bGVJdGVtID0gbGlzdC5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLW1lbnVfX2xpbmsnKTtcclxuXHRcdGxldCB3aWR0aFRpdGxlID0gdGl0bGVJdGVtLmNsaWVudFdpZHRoO1xyXG5cdFx0dmFyIG5lZWRlZFdpZHRoID0gdXNlcldpZHRoIC0gaXRlbXNMaXN0Lmxlbmd0aCAqIHdpZHRoVGl0bGU7XHJcblx0XHRuZWVkZWRXaWR0aCA9IChuZWVkZWRXaWR0aCA+IDUyMCkgPyAnNTIwcHgnIDogbmVlZGVkV2lkdGggKyAncHgnO1xyXG4gICAgXHJcbiAgICBsZXQgZm9yRWFjaE1lbnVBY2NvcmRlb24gPSBsaW5rTWVudUFjY29yZGVvbi5mb3JFYWNoKGZ1bmN0aW9uKGNhdGVnb3J5TmFtZSkge1xyXG4gICAgY2F0ZWdvcnlOYW1lLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgbGV0IGFjdGl2ZUNhdGVnb3J5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1tZW51X19pdGVtLmFjY29yZGVvbi1tZW51X19pdGVtLS1pcy1hY3RpdmUnKTtcclxuICAgICAgICAgIGlmKGFjdGl2ZUNhdGVnb3J5KSB7XHJcbiAgICAgICAgICAgIGxldCBtZW51QWNjb3JkZW9uRGV0YWlscyA9IGFjdGl2ZUNhdGVnb3J5LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tbWVudV9faXRlbS1jb250ZW50Jyk7XHJcbiAgICAgICAgICAgIG1lbnVBY2NvcmRlb25EZXRhaWxzLnN0eWxlLm1heFdpZHRoID0gXCJcIjtcclxuICAgICAgICAgICAgYWN0aXZlQ2F0ZWdvcnkuY2xhc3NMaXN0LnJlbW92ZSgnYWNjb3JkZW9uLW1lbnVfX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGlmKCFhY3RpdmVDYXRlZ29yeXx8IGFjdGl2ZUNhdGVnb3J5LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tbWVudV9fbGluaycpICE9PSB0aGlzKSB7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50Q2F0ZWdvcnkgPSB0aGlzLmNsb3Nlc3QoJy5hY2NvcmRlb24tbWVudV9faXRlbScpO1xyXG4gICAgICAgICAgICBjdXJyZW50Q2F0ZWdvcnkuY2xhc3NMaXN0LmFkZCgnYWNjb3JkZW9uLW1lbnVfX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICBsZXQgY3VycmVudENhdGVnb3J5SW5mbyA9IGN1cnJlbnRDYXRlZ29yeS5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLW1lbnVfX2l0ZW0tY29udGVudCcpO1xyXG4gICAgICAgICAgICBjdXJyZW50Q2F0ZWdvcnlJbmZvLnN0eWxlLm1heFdpZHRoID0gbmVlZGVkV2lkdGg7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcbiAgfSlcclxuXHJcbm1lbnVBY2NvcmRlb24oKTtcclxuXHJcbi8qRW5kIGFjY29yZGVvbiBob3JpbnpvbnRhbCAqL1xyXG5cclxuXHJcblxyXG4vKiBwb3B1cCAqL1xyXG5sZXQgcG9wdXAgPSAoZnVuY3Rpb24ob3B0aW9ucykge1xyXG5cdGxldCB3cmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJldmlld3NfX2xpc3QnKTtcclxuXHJcblx0bGV0IF90b29nbGVQb3B1cCA9IChmdW5jdGlvbihlKSB7XHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0aWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PSBvcHRpb25zLmJ1dHRvbikge1xyXG5cdFx0XHRfb3BlblBvcHVwKGUudGFyZ2V0KTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0bGV0IF9vcGVuUG9wdXAgPSAoZnVuY3Rpb24oYnV0dG9uKXtcclxuXHRcdGxldCBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRvdmVybGF5LmNsYXNzTGlzdC5hZGQoJ292ZXJsYXknKTtcclxuXHJcblx0XHRsZXQgcG9wdXBXaW5kb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdHBvcHVwV2luZG93LmNsYXNzTGlzdC5hZGQoJ3BvcHVwJyk7XHJcblxyXG5cdFx0bGV0IGNvbnRlbnRUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRjb250ZW50VGV4dC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9fY29udGVudCcpO1xyXG5cclxuXHRcdGxldCBjb250ZW50ID0gYnV0dG9uLnBhcmVudE5vZGU7XHJcblxyXG5cdFx0bGV0IHRleHQgPSBjb250ZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy50ZXh0KS50ZXh0Q29udGVudDtcclxuXHQgXHJcblxyXG5cdFx0bGV0IHRpdGxlSXRlbT0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHR0aXRsZUl0ZW0uY2xhc3NMaXN0LmFkZCgncG9wdXBfX3RpdGxlJyk7XHJcblxyXG4gICAgbGV0IHRpdGxlID0gY29udGVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMudGl0bGUpLnRleHRDb250ZW50O1xyXG4gICAgY29udGVudFRleHQuaW5uZXJIVE1MID0gJ9Ce0YjQuNCx0LrQsCDQvtGC0L/RgNCw0LLQutC4INC00LDQvdC90YvRhSc7XHJcbiAgICBjb250ZW50VGV4dC5pbm5lckhUTUwgPSB0ZXh0O1xyXG4gICAgdGl0bGVJdGVtLmlubmVySFRNTCA9IHRpdGxlO1xyXG5cclxuXHRcdGxldCBjbG9zZUljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuXHRcdGNsb3NlSWNvbi5jbGFzc0xpc3QuYWRkKFwicG9wdXBfX2Nsb3NlXCIpO1xyXG5cdFx0Y2xvc2VJY29uLmlubmVySFRNTCA9ICc8c3ZnIGNsYXNzPVwicG9wdXBfX2Nsb3NlLWltYWdlXCI+PHVzZSB4bGluazpocmVmPVwiLi9pbWFnZXMvaWNvbnMvc3ByaXRlLnN2ZyNjbG9zZVwiPjwvdXNlPjwvc3ZnPic7XHJcblx0XHRjbG9zZUljb24uaHJlZiA9IFwiI1wiO1xyXG5cdFx0Y2xvc2VJY29uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZnVuY3Rpb24oZSl7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0X2Nsb3NlUG9wdXAob3ZlcmxheSk7XHJcblx0XHR9KSk7XHJcblxyXG5cdFx0b3ZlcmxheS5hcHBlbmRDaGlsZChwb3B1cFdpbmRvdyk7XHJcblx0XHRwb3B1cFdpbmRvdy5hcHBlbmRDaGlsZCh0aXRsZUl0ZW0pO1xyXG5cdFx0cG9wdXBXaW5kb3cuYXBwZW5kQ2hpbGQoY29udGVudFRleHQpO1xyXG5cdFx0cG9wdXBXaW5kb3cuYXBwZW5kQ2hpbGQoY2xvc2VJY29uKTtcclxuXHJcblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG92ZXJsYXkpO1xyXG5cdH0pO1xyXG5cclxuXHRsZXQgX2Nsb3NlUG9wdXAgPSAoZnVuY3Rpb24ob3ZlcmxheSkge1xyXG5cdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTtcclxuXHR9KTtcclxuXHJcblx0bGV0IGFkZExpc3RlbmVycyA9IChmdW5jdGlvbigpIHtcclxuXHRcdHdyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfdG9vZ2xlUG9wdXApXHJcblx0fSk7XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRpbml0OiBhZGRMaXN0ZW5lcnNcclxuXHR9XHJcbn0pO1xyXG5cclxucG9wdXAoe1xyXG5cdGJ1dHRvbjogXCJyZXZpZXdzX19idXR0b25cIixcclxuXHR0aXRsZTogXCIucmV2aWV3c19fdGl0bGVcIixcclxuXHR0ZXh0OiBcIi5yZXZpZXdzX190ZXh0XCJcclxufSkuaW5pdCgpO1xyXG5cclxuXHJcbi8qIGVuZCBwb3B1cCAqL1xyXG5cclxuLyogZm9ybSovXHJcblxyXG5sZXQgZm9ybUZ1bmN0aW9uID0gKGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHJcbiAgY29uc3QgbXlGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI215Rm9ybScpO1xyXG4gIGNvbnN0IHNlbmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2VuZCcpO1xyXG4gIGNvbnN0IGRhdGEgPSB7XHJcbiAgICBuYW1lOiBteUZvcm0uZWxlbWVudHMubmFtZS52YWx1ZSxcclxuICAgIHBob25lOiBteUZvcm0uZWxlbWVudHMucGhvbmUudmFsdWUsXHJcbiAgICBjb21tZW50OiBteUZvcm0uZWxlbWVudHMuY29tbWVudC52YWx1ZSxcclxuICAgIHRvOiBcInNlZ2V6bXVuZG92bmFAZ21haWwuY29tXCJcclxuICB9O1xyXG5cclxuXHRsZXQgX2FqYXhJbnF1aXJ5ID0gKGZ1bmN0aW9uKGUpe1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0bGV0IG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdG92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnb3ZlcmxheScpO1xyXG5cdFx0bGV0IHBvcHVwV2luZG93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRwb3B1cFdpbmRvdy5jbGFzc0xpc3QuYWRkKCdwb3B1cC0tZm9ybScpO1xyXG5cdFx0bGV0IGNvbnRlbnRUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRjb250ZW50VGV4dC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9fY29udGVudCcpO1xyXG5cclxuICAgIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgeGhyLnJlc3BvbnNlVHlwZSA9ICdqc29uJztcclxuICAgIC8veGhyLm9wZW4oJ0dFVCcsICdodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWwvZmFpbCcpOyAvL9C00LvRjyDQvtGC0YDQuNGG0LDRgtC10LvRjNC90L7Qs9C+INC+0YLQstC10YLQsFxyXG4gICAgeGhyLm9wZW4oJ1BPU1QnLCAnaHR0cDovL3Rlc3QubG9jYWwvbWFpbC5waHAnKTsgICAvL9C00LvRjyDQv9C+0LvQvtC20LjRgtC10LvRjNC90L7Qs9C+INC+0YLQstC10YLQsFxyXG4gICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XHJcbiAgICAgIFxyXG4gICAgICBpZih4aHIuc3RhdHVzPj00MDApIHtcclxuICAgICAgICBsZXQgY29udGVudCA9ICfQntGI0LjQsdC60LAsINC00LDQvdC90YvQtSDQvdC1INC+0YLQv9GA0LDQstC70LXQvdGLLCDQv9C+0L/RgNC+0LHRg9C50YLQtSDQv9C+0LfQttC1JztcclxuICAgICAgICBjb250ZW50VGV4dC5pbm5lckhUTUwgPSBjb250ZW50O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmKHhoci5yZXNwb25zZS5zdGF0dXMpIHtcclxuICAgICAgICAgIGxldCBjb250ZW50ID0gJ9Ch0L7QvtCx0YnQtdC90LjQtSDQvtGC0L/RgNCw0LLQu9C10L3Qvic7XHJcbiAgICAgICAgICBjb250ZW50VGV4dC5pbm5lckhUTUwgPSBjb250ZW50O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbGV0IGNvbnRlbnQgPSAn0KHQvtC10LTQuNC90LXQvdC40LUg0YEg0YHQtdGA0LLQtdGA0L7QvCDQvdC1INGD0YHRgtCw0L3QvtCy0LvQtdC90L4nO1xyXG4gICAgICAgICAgY29udGVudFRleHQuaW5uZXJIVE1MID0gY29udGVudDtcclxuICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgXHJcblx0XHRsZXQgY2xvc2VJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcblx0XHRjbG9zZUljb24uY2xhc3NMaXN0LmFkZChcInBvcHVwX19jbG9zZS1idXR0b25cIik7XHJcblx0XHRjbG9zZUljb24uaW5uZXJIVE1MID0gJ9CX0LDQutGA0YvRgtGMJztcclxuXHRcdGNsb3NlSWNvbi5ocmVmID0gXCIjXCI7XHJcblx0XHRjbG9zZUljb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChmdW5jdGlvbihlKXtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRfY2xvc2VQb3B1cChvdmVybGF5KTtcclxuICAgIH0pKTtcclxuXHJcblxyXG5cdFx0b3ZlcmxheS5hcHBlbmRDaGlsZChwb3B1cFdpbmRvdyk7XHJcblx0XHRwb3B1cFdpbmRvdy5hcHBlbmRDaGlsZChjb250ZW50VGV4dCk7XHJcblx0XHRwb3B1cFdpbmRvdy5hcHBlbmRDaGlsZChjbG9zZUljb24pO1xyXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTtcclxuICBcclxuXHR9KTtcclxuXHJcblx0bGV0IF9jbG9zZVBvcHVwID0gKGZ1bmN0aW9uKG92ZXJsYXkpIHtcclxuXHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7XHJcblx0fSk7XHJcblxyXG5cdGxldCBhZGRMaXN0ZW5lcnMgPSAoZnVuY3Rpb24oKSB7XHJcbiAgICBzZW5kLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX2FqYXhJbnF1aXJ5KVxyXG5cdH0pO1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0aW5pdDogYWRkTGlzdGVuZXJzXHJcblx0fVxyXG59KTtcclxuXHJcbmZvcm1GdW5jdGlvbih7XHJcblx0dGV4dDogXCIucmV2aWV3c19fdGV4dFwiXHJcbn0pLmluaXQoKTtcclxuXHJcblxyXG4vKmVuZCBmb3JtICovXHJcblxyXG4vKiBzdGFydCBidXJnZXJfX2NvbXBvc2l0aW9uICovXHJcbmxldCBpc01vYmlsZSA9ICgpID0+IHtcclxuICBsZXQgc2NyZWVuID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoO1xyXG5cdGxldCBtb2JpbGUgPSBmYWxzZTtcclxuXHRpZihzY3JlZW48PTc2OCl7XHJcbiAgICBtb2JpbGUgPSB0cnVlO1xyXG4gIH0gXHJcblx0cmV0dXJuIG1vYmlsZTtcclxufTtcclxuXHJcbmxldCBtb2JpbGVDb21wb3NpdGlvbiA9ICgpID0+IHtcclxuXHRcdGxldCBidXJnZXJzQ29tcG9zaXRpb25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJ1cmdlcl9fY29tcG9zaXRpb24nKTtcclxuXHRcdGxldCBidXR0b25zQ2xvc2VDb21wb3NpdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kcm9wZG93bl9fY2xvc2UtaW1hZ2UnKTtcclxuXHJcblx0Zm9yIChpPTA7aTxidXJnZXJzQ29tcG9zaXRpb25zLmxlbmd0aDtpKyspe1xyXG5cdFx0YnVyZ2Vyc0NvbXBvc2l0aW9uc1tpXS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgZSA9PiB7XHJcblx0XHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXJnZXJfX2NvbXBvc2l0aW9uJykuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcblx0XHR9KTtcclxuXHRcdGlmIChpc01vYmlsZSkge1xyXG5cdFx0XHRidXJnZXJzQ29tcG9zaXRpb25zW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcblx0XHRcdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1cmdlcl9fY29tcG9zaXRpb24nKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmb3IgKGk9MDtpPGJ1cmdlcnNDb21wb3NpdGlvbnMubGVuZ3RoO2krKyl7XHJcblx0XHRidXJnZXJzQ29tcG9zaXRpb25zW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCBlID0+IHtcclxuXHRcdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1cmdlcl9fY29tcG9zaXRpb24nKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblxyXG5cdGZvciAoaT0wO2k8YnV0dG9uc0Nsb3NlQ29tcG9zaXRpb24ubGVuZ3RoO2krKyl7XHJcblx0XHRcdGJ1dHRvbnNDbG9zZUNvbXBvc2l0aW9uW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXJnZXJfX2NvbXBvc2l0aW9uJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH07XHJcblx0bW9iaWxlQ29tcG9zaXRpb24oKTtcclxuXHJcblxyXG5cclxuXHJcblxyXG4vKiBlbmQgYnVyZ2VyX19jb21wb3NpdGlvbiovXHJcblxyXG4vKiBzbGlkZXIqL1xyXG5cclxubGV0IHNsaWRlciA9IG9wdGlvbnMgPT4ge1xyXG5cdGxldCB3cmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLndyYXBwZXIpO1xyXG5cdGxldCB3aWR0aCA9IHdyYXBwZXIuY2xpZW50V2lkdGg7XHJcblx0d3JhcHBlci5zdHlsZS53aWR0aCA9IHdpZHRoICArICdweCc7XHJcblx0bGV0IHN0ZXAgPSB3aWR0aDtcclxuXHRsZXQgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5saXN0KTtcclxuXHRsZXQgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKG9wdGlvbnMuaXRlbSk7XHJcblxyXG5cdGxldCBsZWZ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLmxlZnQpO1xyXG5cdGxldCByaWdodCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5yaWdodCk7XHJcblxyXG5cdGl0ZW1zLmZvckVhY2goZWxlbWVudCA9PiB7XHJcblx0XHRlbGVtZW50LnN0eWxlLndpZHRoID0gd2lkdGggICsgJ3B4JztcclxuXHR9KTtcclxuXHJcblx0bGV0IHBvc2l0aW9uTWF4UmlnaHQgPSB3aWR0aCAqIChpdGVtcy5sZW5ndGggLSAxKTtcclxuXHJcblx0bGV0IHBvc2l0aW9uUmlnaHQgPSAwO1xyXG5cclxuXHRsZXQgX3JpZ2h0ID0gcG9zaXRpb24gPT4ge1xyXG5cdFx0aWYgKHBvc2l0aW9uIDw9IHBvc2l0aW9uTWF4UmlnaHQpIHtcclxuXHRcdFx0cG9zaXRpb25SaWdodCA9IHBvc2l0aW9uUmlnaHQgKyBzdGVwO1xyXG5cdFx0XHRsaXN0LnN0eWxlLnJpZ2h0ID0gcG9zaXRpb25SaWdodCArIFwicHhcIjtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRsZXQgX2xlZnQgPSBwb3NpdGlvbiA9PiB7XHJcblx0XHRpZiAocG9zaXRpb24gPj0gMCkge1xyXG5cdFx0XHRwb3NpdGlvblJpZ2h0ID0gcG9zaXRpb25SaWdodCAtIHN0ZXA7XHJcblx0XHRcdGxpc3Quc3R5bGUucmlnaHQgPSBwb3NpdGlvblJpZ2h0ICsgXCJweFwiO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGxldCBpbml0aWFsID0gKCkgPT4ge1xyXG5cdFx0bGlzdC5zdHlsZS5yaWdodCA9IHBvc2l0aW9uUmlnaHQ7XHJcblxyXG5cdFx0cmlnaHQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0XHRfcmlnaHQocG9zaXRpb25SaWdodCArIHN0ZXApO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0bGVmdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRcdF9sZWZ0KHBvc2l0aW9uUmlnaHQgLSBzdGVwKTtcclxuXHRcdH0pO1xyXG5cclxuXHR9O1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0aW5pdDogaW5pdGlhbFxyXG5cdH1cclxufTtcclxuXHJcbnNsaWRlcih7XHJcblx0d3JhcHBlcjogJy5idXJnZXJfX3dyYXBwZXInLFxyXG5cdGxpc3Q6ICcuYnVyZ2VyX19saXN0JyxcclxuXHRpdGVtOiAnLmJ1cmdlcl9faXRlbScsXHJcblx0cmlnaHQ6ICcuYnVyZ2VyX19hcnJvd3MtaXRlbS0tcmlnaHQnLFxyXG5cdGxlZnQ6ICcuYnVyZ2VyX19hcnJvd3MtaXRlbS0tbGVmdCdcclxufSkuaW5pdCgpO1xyXG5cclxuXHJcblxyXG4vKmVuZCBzbGlkZXIqL1xyXG5cclxuXHJcbi8qc3RhcnQgbWFwICovXHJcbnZhciBwbGFjZW1hcmtzID0gW1xyXG5cdHtcclxuXHRcdGxhdGl0dWRlOiA1OS45NywgXHJcblx0XHRsYW5nZXR1ZGU6IDMwLjMxLFxyXG5cdFx0aGludENvbnRlbnQ6ICfRg9C7LiDQm9C40YLQtdGA0LDRgtC+0YDQvtCyLCDQtNC+0LwgMTAnLFxyXG5cdFx0YmFsbG9vbkNvbnRlbnQ6ICfQodCw0LzRi9C1INCy0LrRg9GB0L3Ri9C1INCx0YPRgNCz0LXRgNGLINGDINC90LDRgSEnXHJcblxyXG5cdH0sXHJcblx0e1xyXG5cdFx0bGF0aXR1ZGU6IDU5Ljk0LCBcclxuXHRcdGxhbmdldHVkZTogMzAuMjUsXHJcblx0XHRoaW50Q29udGVudDogJ9Cc0LDQu9GL0Lkg0L/RgNC+0YHQv9C10LrRgiDQkiDQniwg0LTQvtC8IDY0JyxcclxuXHRcdGJhbGxvb25Db250ZW50OiAn0KHQsNC80YvQtSDQstC60YPRgdC90YvQtSDQsdGD0YDQs9C10YDRiyDRgyDQvdCw0YEhJ1xyXG5cdH0sXHJcblx0e1xyXG5cdFx0bGF0aXR1ZGU6IDU5LjkzLCBcclxuXHRcdGxhbmdldHVkZTogMzAuMzQsXHJcblx0XHRoaW50Q29udGVudDogJ9C90LDQsS4g0YDQtdC60Lgg0KTQvtC90YLQsNC90LrQuCwg0LQuIDU2JyxcclxuXHRcdGJhbGxvb25Db250ZW50OiAn0KHQsNC80YvQtSDQstC60YPRgdC90YvQtSDQsdGD0YDQs9C10YDRiyDRgyDQvdCw0YEhJ1xyXG5cdH1cclxuXTtcclxuXHJcblxyXG55bWFwcy5yZWFkeShpbml0KTtcclxuXHJcbmdlb09iamVjdHMgPSBbXTtcclxuXHJcbmZ1bmN0aW9uIGluaXQoKSB7XHJcblx0dmFyIG1hcCA9IG5ldyB5bWFwcy5NYXAoJ21hcCcsIHtcclxuXHRcdGNlbnRlcjogWzU5Ljk0LCAzMC4zMl0sXHJcblx0XHR6b29tOiAxMixcclxuXHRcdGNvbnRyb2xzOiBbJ3pvb21Db250cm9sJ10sXHJcblx0XHRiZWhhdmlvcnM6IFsnZHJhZyddXHJcblx0fSk7XHJcblxyXG5cdGZvcih2YXIgaT0wOyBpIDwgcGxhY2VtYXJrcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0Z2VvT2JqZWN0c1tpXSA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoW3BsYWNlbWFya3NbaV0ubGF0aXR1ZGUsIHBsYWNlbWFya3NbaV0ubGFuZ2V0dWRlXSwgXHJcblx0XHRcdHtcclxuXHRcdFx0XHRoaW50Q29udGVudDogcGxhY2VtYXJrc1tpXS5oaW50Q29udGVudCxcclxuXHRcdFx0XHRiYWxsb29uQ29udGVudDogcGxhY2VtYXJrc1tpXS5iYWxsb29uQ29udGVudFxyXG5cdFx0XHR9LFxyXG5cdFx0XHR7XHJcblx0XHRcdFx0aWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxyXG5cdFx0XHRcdGljb25JbWFnZUhyZWY6ICdpbWFnZXMvaWNvbnMvbWFwLW1hcmtlci5zdmcnLFxyXG5cdFx0XHRcdGljb25JbWFnZVNpemU6IFs0NiwgNTddLFxyXG5cdFx0XHRcdGljb25JbWFnZU9mZnNldDogWy0yMywgLTU3XVxyXG5cdFx0XHR9KTtcdFxyXG5cdH1cclxuXHJcblx0dmFyIGNsdXN0ZXJlciA9IG5ldyB5bWFwcy5DbHVzdGVyZXIoe1xyXG5cdFx0Y2x1c3Rlckljb25zOiBbXHJcblx0XHRcdHtcclxuXHRcdFx0XHRocmVmOiBcIi9pbWFnZXMvc2VjdGlvbi1tYWluL2J1cmdlci5wbmdcIixcclxuXHRcdFx0XHRzaXplOiBbMTAwLCAxMDBdLFxyXG5cdFx0XHRcdG9mZnNldDogWy01MCwgLTUwXVxyXG5cdFx0XHR9XHJcblx0XHRdLFxyXG5cdFx0Y2x1c3Rlckljb25Db250ZW50TGF5b3V0OiBudWxsXHJcblx0fSk7XHJcblx0XHJcblx0bWFwLmdlb09iamVjdHMuYWRkKGNsdXN0ZXJlcik7XHJcblx0Y2x1c3RlcmVyLmFkZChnZW9PYmplY3RzKTtcclxufVxyXG5cclxuLyplbmQgbWFwICovXHJcblxyXG5cclxuLypzdGFydCBPUFMgXHJcblxyXG5cclxuLyplbmQgT1BTICovIl19
