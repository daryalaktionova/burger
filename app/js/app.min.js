/* Overlay menu */

  
  let menu = (function(options) {

    let button = document.querySelector(options.button);
    let menu = document.querySelector(options.menu);
    let body = document.querySelector('body');
    let link = document.querySelectorAll(".overlay-menu__link");
    



    let _toggleMenu = function(e) {
      button.classList.toggle('hamburger-bar--active');
      menu.classList.toggle('overlay--open');
      body.classList.toggle('body-active-menu');
    }

    let addListeners = function() {
      button.addEventListener('click', _toggleMenu);
        for (i=0;i<link.length;i++){
          link[i].addEventListener('click', _toggleMenu);
        }
    }

    
    return {
        openMenu: addListeners
      };

  })({
    button: '#toggle',
    menu: '#overlay'
  });

  menu.openMenu();


/*end overlay menu */

/*Accodeon team*/
let teamAccordeon = (function() {

    let linkAccordeon = document.querySelectorAll('.accordeon__link');
    
    linkAccordeon.forEach(function(personName) {
    personName.addEventListener('click', function(e) {
          e.preventDefault();
          let activePerson = document.querySelector('.accordeon__item.accordeon__item--is-active');
          if(activePerson) {
            let teamAccordeonDetails = activePerson.querySelector('.accordeon-content');
            teamAccordeonDetails.style.maxHeight = "";
            activePerson.classList.remove('accordeon__item--is-active');
          }
					
          if(!activePerson || activePerson.querySelector('.accordeon__link') !== this) {
            let currentPerson = this.closest('.accordeon__item');
            currentPerson.classList.add('accordeon__item--is-active');
            let currentPersonInfo = currentPerson.querySelector('.accordeon-content');
            currentPersonInfo.style.maxHeight = currentPersonInfo.scrollHeight + 'px';
          }
        })
    })
  })

teamAccordeon();
/*end Accordeon team */

/* Start accordeon horizontal */
let menuAccordeon = (function() {

    let linkMenuAccordeon = document.querySelectorAll('.accordeon-menu__link');
    let userWidth = window.innerWidth;
    let list = document.querySelector('.accordeon-menu__list');
    let itemsList = list.querySelectorAll('.accordeon-menu__item');
		let titleItem = list.querySelector('.accordeon-menu__link');
		let widthTitle = titleItem.clientWidth;
		var neededWidth = userWidth - itemsList.length * widthTitle;
		neededWidth = (neededWidth > 520) ? '520px' : neededWidth + 'px';
    
    let forEachMenuAccordeon = linkMenuAccordeon.forEach(function(categoryName) {
    categoryName.addEventListener('click', function(e) {
          e.preventDefault();
          let activeCategory = document.querySelector('.accordeon-menu__item.accordeon-menu__item--is-active');
          if(activeCategory) {
            let menuAccordeonDetails = activeCategory.querySelector('.accordeon-menu__item-content');
            menuAccordeonDetails.style.maxWidth = "";
            activeCategory.classList.remove('accordeon-menu__item--is-active');
          }

          if(!activeCategory|| activeCategory.querySelector('.accordeon-menu__link') !== this) {
            let currentCategory = this.closest('.accordeon-menu__item');
            currentCategory.classList.add('accordeon-menu__item--is-active');
            let currentCategoryInfo = currentCategory.querySelector('.accordeon-menu__item-content');
            currentCategoryInfo.style.maxWidth = neededWidth;
          }
        })
    })
  })

menuAccordeon();

/*End accordeon horinzontal */



/* popup */
let popup = (function(options) {
	let wrapper = document.querySelector('.reviews__list');

	let _tooglePopup = (function(e) {
		e.preventDefault();

		if (e.target.className == options.button) {
			_openPopup(e.target);
		}
	});

	let _openPopup = (function(button){
		let overlay = document.createElement('div');
		overlay.classList.add('overlay');

		let popupWindow = document.createElement('div');
		popupWindow.classList.add('popup');

		let contentText = document.createElement('div');
		contentText.classList.add('popup__content');

		let content = button.parentNode;

		let text = content.querySelector(options.text).textContent;
	 

		let titleItem= document.createElement('div');
		titleItem.classList.add('popup__title');

    let title = content.querySelector(options.title).textContent;
    contentText.innerHTML = 'Ошибка отправки данных';
    contentText.innerHTML = text;
    titleItem.innerHTML = title;

		let closeIcon = document.createElement("a");
		closeIcon.classList.add("popup__close");
		closeIcon.innerHTML = '<svg class="popup__close-image"><use xlink:href="./images/icons/sprite.svg#close"></use></svg>';
		closeIcon.href = "#";
		closeIcon.addEventListener("click", (function(e){
			e.preventDefault();
			_closePopup(overlay);
		}));

		overlay.appendChild(popupWindow);
		popupWindow.appendChild(titleItem);
		popupWindow.appendChild(contentText);
		popupWindow.appendChild(closeIcon);

		document.body.appendChild(overlay);
	});

	let _closePopup = (function(overlay) {
		document.body.removeChild(overlay);
	});

	let addListeners = (function() {
		wrapper.addEventListener('click', _tooglePopup)
	});

	return {
		init: addListeners
	}
});

popup({
	button: "reviews__button",
	title: ".reviews__title",
	text: ".reviews__text"
}).init();


/* end popup */

/* form*/

let formFunction = (function(options) {

  const myForm = document.querySelector('#myForm');
  const send = document.querySelector('#send');
  const data = {
    name: myForm.elements.name.value,
    phone: myForm.elements.phone.value,
    comment: myForm.elements.comment.value,
    to: "segezmundovna@gmail.com"
  };

	let _ajaxInquiry = (function(e){
    e.preventDefault();
		let overlay = document.createElement('div');
		overlay.classList.add('overlay');
		let popupWindow = document.createElement('div');
		popupWindow.classList.add('popup--form');
		let contentText = document.createElement('div');
		contentText.classList.add('popup__content');

    const xhr = new XMLHttpRequest();
    xhr.responseType = 'json';
    //xhr.open('GET', 'https://webdev-api.loftschool.com/sendmail/fail'); //для отрицательного ответа
    xhr.open('POST', 'http://test.local/mail.php');   //для положительного ответа
    xhr.send(JSON.stringify(data));
    xhr.addEventListener('load', () => {
      
      if(xhr.status>=400) {
        let content = 'Ошибка, данные не отправлены, попробуйте позже';
        contentText.innerHTML = content;
      } else {
        if(xhr.response.status) {
          let content = 'Сообщение отправлено';
          contentText.innerHTML = content;
      } else {
          let content = 'Соединение с сервером не установлено';
          contentText.innerHTML = content;
      }
      }
    })
    
		let closeIcon = document.createElement("a");
		closeIcon.classList.add("popup__close-button");
		closeIcon.innerHTML = 'Закрыть';
		closeIcon.href = "#";
		closeIcon.addEventListener("click", (function(e){
			e.preventDefault();
			_closePopup(overlay);
    }));


		overlay.appendChild(popupWindow);
		popupWindow.appendChild(contentText);
		popupWindow.appendChild(closeIcon);
    document.body.appendChild(overlay);
  
	});

	let _closePopup = (function(overlay) {
		document.body.removeChild(overlay);
	});

	let addListeners = (function() {
    send.addEventListener('click', _ajaxInquiry)
	});

	return {
		init: addListeners
	}
});

formFunction({
	text: ".reviews__text"
}).init();


/*end form */

/* start burger__composition */
let isMobile = () => {
  let screen = document.documentElement.clientWidth;
	let mobile = false;
	if(screen<=768){
    mobile = true;
  } 
	return mobile;
};

let mobileComposition = () => {
		let slide = document.querySelector('.burger');

	slide.onmouseenter =  function(e) {
			let target = e.target;
			let buttonComposition = target.querySelectorAll('.burger__composition');
			if(target.className == 'burger__composition') {
				console.log('123');
				console.log(buttonComposition);
				buttonComposition.classList.add('active');
			} else {
				return;
			}
			
};

slide.onmouseleave = function(e) {
	let target = e.target;
	let buttonComposition = target.querySelector('.burger__composition');
	if(buttonComposition) {
		buttonComposition.classList.remove('active');
	} else {
		return;
	}
	
}



/*
		buttonCloseComposition.addEventListener('click', e => {
			e.preventDefault();

			buttonComposition.classList.remove('active');
		});


		buttonCloseComposition.addEventListener('touchstart', e => {
			e.preventDefault();

			buttonComposition.classList.remove('active');
		});

		if (isMobile) {
			buttonComposition.addEventListener('click', e => {
				buttonComposition.classList.add('active');
			});
		}
	

		let _removeClass = () => {
			buttonComposition.classList.remove('active');
		}

		for (i=0;i<buttonCompositionAll.length;i++){
			buttonCompositionAll[i].addEventListener('mouseenter', _addClass);
			buttonCompositionAll[i].addEventListener('mouseleave', _removeClass);
		}
*/
	};

	mobileComposition();





/* end burger__composition*/

/* slider*/

let slider = options => {
	let wrapper = document.querySelector(options.wrapper);
	let width = wrapper.clientWidth;
	wrapper.style.width = width  + 'px';
	let step = width;
	let list = document.querySelector(options.list);
	let items = document.querySelectorAll(options.item);

	let left = document.querySelector(options.left);
	let right = document.querySelector(options.right);

	items.forEach(element => {
		element.style.width = width  + 'px';
	});

	let positionMaxRight = width * (items.length - 1);

	let positionRight = 0;

	let _right = position => {
		if (position <= positionMaxRight) {
			positionRight = positionRight + step;
			list.style.right = positionRight + "px";
		}
	};

	let _left = position => {
		if (position >= 0) {
			positionRight = positionRight - step;
			list.style.right = positionRight + "px";
		}
	};

	let initial = () => {
		list.style.right = positionRight;

		right.addEventListener("click", e => {
			e.preventDefault();

			_right(positionRight + step);
		});

		left.addEventListener("click", e => {
			e.preventDefault();

			_left(positionRight - step);
		});

	};

	return {
		init: initial
	}
};

slider({
	wrapper: '.burger__wrapper',
	list: '.burger__list',
	item: '.burger__item',
	right: '.burger__arrows-item--right',
	left: '.burger__arrows-item--left'
}).init();



/*end slider*/


/*start map */
ymaps.ready(init);

function init() {
	var map = new ymaps.Map('map', {
		center: [59.94, 30.32],
		zoom: 12,
		controls: ['zoomControl'],
		behaviors: ['drag']
	});

	var placemark = new ymaps.Placemark([59.97, 30.31], {
			hintContent: 'ул. Литераторов, дом 10',
			balloonContent: 'Самые вкусные бургеры у нас!'
	},
	{
		iconLayout: 'default#image',
		iconImageHref: 'images/icons/map-marker.svg',
		iconImageSize: [46, 57]
	}

);
	map.geoObjects.add(placemark);
}

/*end map */
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogT3ZlcmxheSBtZW51ICovXHJcblxyXG4gIFxyXG4gIGxldCBtZW51ID0gKGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHJcbiAgICBsZXQgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLmJ1dHRvbik7XHJcbiAgICBsZXQgbWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5tZW51KTtcclxuICAgIGxldCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xyXG4gICAgbGV0IGxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm92ZXJsYXktbWVudV9fbGlua1wiKTtcclxuICAgIFxyXG5cclxuXHJcblxyXG4gICAgbGV0IF90b2dnbGVNZW51ID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgnaGFtYnVyZ2VyLWJhci0tYWN0aXZlJyk7XHJcbiAgICAgIG1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnb3ZlcmxheS0tb3BlbicpO1xyXG4gICAgICBib2R5LmNsYXNzTGlzdC50b2dnbGUoJ2JvZHktYWN0aXZlLW1lbnUnKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgYWRkTGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF90b2dnbGVNZW51KTtcclxuICAgICAgICBmb3IgKGk9MDtpPGxpbmsubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICBsaW5rW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX3RvZ2dsZU1lbnUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgb3Blbk1lbnU6IGFkZExpc3RlbmVyc1xyXG4gICAgICB9O1xyXG5cclxuICB9KSh7XHJcbiAgICBidXR0b246ICcjdG9nZ2xlJyxcclxuICAgIG1lbnU6ICcjb3ZlcmxheSdcclxuICB9KTtcclxuXHJcbiAgbWVudS5vcGVuTWVudSgpO1xyXG5cclxuXHJcbi8qZW5kIG92ZXJsYXkgbWVudSAqL1xyXG5cclxuLypBY2NvZGVvbiB0ZWFtKi9cclxubGV0IHRlYW1BY2NvcmRlb24gPSAoZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgbGV0IGxpbmtBY2NvcmRlb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYWNjb3JkZW9uX19saW5rJyk7XHJcbiAgICBcclxuICAgIGxpbmtBY2NvcmRlb24uZm9yRWFjaChmdW5jdGlvbihwZXJzb25OYW1lKSB7XHJcbiAgICBwZXJzb25OYW1lLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgbGV0IGFjdGl2ZVBlcnNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb25fX2l0ZW0uYWNjb3JkZW9uX19pdGVtLS1pcy1hY3RpdmUnKTtcclxuICAgICAgICAgIGlmKGFjdGl2ZVBlcnNvbikge1xyXG4gICAgICAgICAgICBsZXQgdGVhbUFjY29yZGVvbkRldGFpbHMgPSBhY3RpdmVQZXJzb24ucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1jb250ZW50Jyk7XHJcbiAgICAgICAgICAgIHRlYW1BY2NvcmRlb25EZXRhaWxzLnN0eWxlLm1heEhlaWdodCA9IFwiXCI7XHJcbiAgICAgICAgICAgIGFjdGl2ZVBlcnNvbi5jbGFzc0xpc3QucmVtb3ZlKCdhY2NvcmRlb25fX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgICAgICAgfVxyXG5cdFx0XHRcdFx0XHJcbiAgICAgICAgICBpZighYWN0aXZlUGVyc29uIHx8IGFjdGl2ZVBlcnNvbi5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uX19saW5rJykgIT09IHRoaXMpIHtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRQZXJzb24gPSB0aGlzLmNsb3Nlc3QoJy5hY2NvcmRlb25fX2l0ZW0nKTtcclxuICAgICAgICAgICAgY3VycmVudFBlcnNvbi5jbGFzc0xpc3QuYWRkKCdhY2NvcmRlb25fX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICBsZXQgY3VycmVudFBlcnNvbkluZm8gPSBjdXJyZW50UGVyc29uLnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tY29udGVudCcpO1xyXG4gICAgICAgICAgICBjdXJyZW50UGVyc29uSW5mby5zdHlsZS5tYXhIZWlnaHQgPSBjdXJyZW50UGVyc29uSW5mby5zY3JvbGxIZWlnaHQgKyAncHgnO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG50ZWFtQWNjb3JkZW9uKCk7XHJcbi8qZW5kIEFjY29yZGVvbiB0ZWFtICovXHJcblxyXG4vKiBTdGFydCBhY2NvcmRlb24gaG9yaXpvbnRhbCAqL1xyXG5sZXQgbWVudUFjY29yZGVvbiA9IChmdW5jdGlvbigpIHtcclxuXHJcbiAgICBsZXQgbGlua01lbnVBY2NvcmRlb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYWNjb3JkZW9uLW1lbnVfX2xpbmsnKTtcclxuICAgIGxldCB1c2VyV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgIGxldCBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1tZW51X19saXN0Jyk7XHJcbiAgICBsZXQgaXRlbXNMaXN0ID0gbGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcuYWNjb3JkZW9uLW1lbnVfX2l0ZW0nKTtcclxuXHRcdGxldCB0aXRsZUl0ZW0gPSBsaXN0LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tbWVudV9fbGluaycpO1xyXG5cdFx0bGV0IHdpZHRoVGl0bGUgPSB0aXRsZUl0ZW0uY2xpZW50V2lkdGg7XHJcblx0XHR2YXIgbmVlZGVkV2lkdGggPSB1c2VyV2lkdGggLSBpdGVtc0xpc3QubGVuZ3RoICogd2lkdGhUaXRsZTtcclxuXHRcdG5lZWRlZFdpZHRoID0gKG5lZWRlZFdpZHRoID4gNTIwKSA/ICc1MjBweCcgOiBuZWVkZWRXaWR0aCArICdweCc7XHJcbiAgICBcclxuICAgIGxldCBmb3JFYWNoTWVudUFjY29yZGVvbiA9IGxpbmtNZW51QWNjb3JkZW9uLmZvckVhY2goZnVuY3Rpb24oY2F0ZWdvcnlOYW1lKSB7XHJcbiAgICBjYXRlZ29yeU5hbWUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICBsZXQgYWN0aXZlQ2F0ZWdvcnkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uLW1lbnVfX2l0ZW0uYWNjb3JkZW9uLW1lbnVfX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgICAgICAgaWYoYWN0aXZlQ2F0ZWdvcnkpIHtcclxuICAgICAgICAgICAgbGV0IG1lbnVBY2NvcmRlb25EZXRhaWxzID0gYWN0aXZlQ2F0ZWdvcnkucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1tZW51X19pdGVtLWNvbnRlbnQnKTtcclxuICAgICAgICAgICAgbWVudUFjY29yZGVvbkRldGFpbHMuc3R5bGUubWF4V2lkdGggPSBcIlwiO1xyXG4gICAgICAgICAgICBhY3RpdmVDYXRlZ29yeS5jbGFzc0xpc3QucmVtb3ZlKCdhY2NvcmRlb24tbWVudV9faXRlbS0taXMtYWN0aXZlJyk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYoIWFjdGl2ZUNhdGVnb3J5fHwgYWN0aXZlQ2F0ZWdvcnkucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbi1tZW51X19saW5rJykgIT09IHRoaXMpIHtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRDYXRlZ29yeSA9IHRoaXMuY2xvc2VzdCgnLmFjY29yZGVvbi1tZW51X19pdGVtJyk7XHJcbiAgICAgICAgICAgIGN1cnJlbnRDYXRlZ29yeS5jbGFzc0xpc3QuYWRkKCdhY2NvcmRlb24tbWVudV9faXRlbS0taXMtYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50Q2F0ZWdvcnlJbmZvID0gY3VycmVudENhdGVnb3J5LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb24tbWVudV9faXRlbS1jb250ZW50Jyk7XHJcbiAgICAgICAgICAgIGN1cnJlbnRDYXRlZ29yeUluZm8uc3R5bGUubWF4V2lkdGggPSBuZWVkZWRXaWR0aDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxubWVudUFjY29yZGVvbigpO1xyXG5cclxuLypFbmQgYWNjb3JkZW9uIGhvcmluem9udGFsICovXHJcblxyXG5cclxuXHJcbi8qIHBvcHVwICovXHJcbmxldCBwb3B1cCA9IChmdW5jdGlvbihvcHRpb25zKSB7XHJcblx0bGV0IHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmV2aWV3c19fbGlzdCcpO1xyXG5cclxuXHRsZXQgX3Rvb2dsZVBvcHVwID0gKGZ1bmN0aW9uKGUpIHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09IG9wdGlvbnMuYnV0dG9uKSB7XHJcblx0XHRcdF9vcGVuUG9wdXAoZS50YXJnZXQpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRsZXQgX29wZW5Qb3B1cCA9IChmdW5jdGlvbihidXR0b24pe1xyXG5cdFx0bGV0IG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdG92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnb3ZlcmxheScpO1xyXG5cclxuXHRcdGxldCBwb3B1cFdpbmRvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0cG9wdXBXaW5kb3cuY2xhc3NMaXN0LmFkZCgncG9wdXAnKTtcclxuXHJcblx0XHRsZXQgY29udGVudFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdGNvbnRlbnRUZXh0LmNsYXNzTGlzdC5hZGQoJ3BvcHVwX19jb250ZW50Jyk7XHJcblxyXG5cdFx0bGV0IGNvbnRlbnQgPSBidXR0b24ucGFyZW50Tm9kZTtcclxuXHJcblx0XHRsZXQgdGV4dCA9IGNvbnRlbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLnRleHQpLnRleHRDb250ZW50O1xyXG5cdCBcclxuXHJcblx0XHRsZXQgdGl0bGVJdGVtPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdHRpdGxlSXRlbS5jbGFzc0xpc3QuYWRkKCdwb3B1cF9fdGl0bGUnKTtcclxuXHJcbiAgICBsZXQgdGl0bGUgPSBjb250ZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy50aXRsZSkudGV4dENvbnRlbnQ7XHJcbiAgICBjb250ZW50VGV4dC5pbm5lckhUTUwgPSAn0J7RiNC40LHQutCwINC+0YLQv9GA0LDQstC60Lgg0LTQsNC90L3Ri9GFJztcclxuICAgIGNvbnRlbnRUZXh0LmlubmVySFRNTCA9IHRleHQ7XHJcbiAgICB0aXRsZUl0ZW0uaW5uZXJIVE1MID0gdGl0bGU7XHJcblxyXG5cdFx0bGV0IGNsb3NlSWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG5cdFx0Y2xvc2VJY29uLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9fY2xvc2VcIik7XHJcblx0XHRjbG9zZUljb24uaW5uZXJIVE1MID0gJzxzdmcgY2xhc3M9XCJwb3B1cF9fY2xvc2UtaW1hZ2VcIj48dXNlIHhsaW5rOmhyZWY9XCIuL2ltYWdlcy9pY29ucy9zcHJpdGUuc3ZnI2Nsb3NlXCI+PC91c2U+PC9zdmc+JztcclxuXHRcdGNsb3NlSWNvbi5ocmVmID0gXCIjXCI7XHJcblx0XHRjbG9zZUljb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChmdW5jdGlvbihlKXtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRfY2xvc2VQb3B1cChvdmVybGF5KTtcclxuXHRcdH0pKTtcclxuXHJcblx0XHRvdmVybGF5LmFwcGVuZENoaWxkKHBvcHVwV2luZG93KTtcclxuXHRcdHBvcHVwV2luZG93LmFwcGVuZENoaWxkKHRpdGxlSXRlbSk7XHJcblx0XHRwb3B1cFdpbmRvdy5hcHBlbmRDaGlsZChjb250ZW50VGV4dCk7XHJcblx0XHRwb3B1cFdpbmRvdy5hcHBlbmRDaGlsZChjbG9zZUljb24pO1xyXG5cclxuXHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheSk7XHJcblx0fSk7XHJcblxyXG5cdGxldCBfY2xvc2VQb3B1cCA9IChmdW5jdGlvbihvdmVybGF5KSB7XHJcblx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpO1xyXG5cdH0pO1xyXG5cclxuXHRsZXQgYWRkTGlzdGVuZXJzID0gKGZ1bmN0aW9uKCkge1xyXG5cdFx0d3JhcHBlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF90b29nbGVQb3B1cClcclxuXHR9KTtcclxuXHJcblx0cmV0dXJuIHtcclxuXHRcdGluaXQ6IGFkZExpc3RlbmVyc1xyXG5cdH1cclxufSk7XHJcblxyXG5wb3B1cCh7XHJcblx0YnV0dG9uOiBcInJldmlld3NfX2J1dHRvblwiLFxyXG5cdHRpdGxlOiBcIi5yZXZpZXdzX190aXRsZVwiLFxyXG5cdHRleHQ6IFwiLnJldmlld3NfX3RleHRcIlxyXG59KS5pbml0KCk7XHJcblxyXG5cclxuLyogZW5kIHBvcHVwICovXHJcblxyXG4vKiBmb3JtKi9cclxuXHJcbmxldCBmb3JtRnVuY3Rpb24gPSAoZnVuY3Rpb24ob3B0aW9ucykge1xyXG5cclxuICBjb25zdCBteUZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbXlGb3JtJyk7XHJcbiAgY29uc3Qgc2VuZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzZW5kJyk7XHJcbiAgY29uc3QgZGF0YSA9IHtcclxuICAgIG5hbWU6IG15Rm9ybS5lbGVtZW50cy5uYW1lLnZhbHVlLFxyXG4gICAgcGhvbmU6IG15Rm9ybS5lbGVtZW50cy5waG9uZS52YWx1ZSxcclxuICAgIGNvbW1lbnQ6IG15Rm9ybS5lbGVtZW50cy5jb21tZW50LnZhbHVlLFxyXG4gICAgdG86IFwic2VnZXptdW5kb3ZuYUBnbWFpbC5jb21cIlxyXG4gIH07XHJcblxyXG5cdGxldCBfYWpheElucXVpcnkgPSAoZnVuY3Rpb24oZSl7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRsZXQgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0b3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdvdmVybGF5Jyk7XHJcblx0XHRsZXQgcG9wdXBXaW5kb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdHBvcHVwV2luZG93LmNsYXNzTGlzdC5hZGQoJ3BvcHVwLS1mb3JtJyk7XHJcblx0XHRsZXQgY29udGVudFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdGNvbnRlbnRUZXh0LmNsYXNzTGlzdC5hZGQoJ3BvcHVwX19jb250ZW50Jyk7XHJcblxyXG4gICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2pzb24nO1xyXG4gICAgLy94aHIub3BlbignR0VUJywgJ2h0dHBzOi8vd2ViZGV2LWFwaS5sb2Z0c2Nob29sLmNvbS9zZW5kbWFpbC9mYWlsJyk7IC8v0LTQu9GPINC+0YLRgNC40YbQsNGC0LXQu9GM0L3QvtCz0L4g0L7RgtCy0LXRgtCwXHJcbiAgICB4aHIub3BlbignUE9TVCcsICdodHRwOi8vdGVzdC5sb2NhbC9tYWlsLnBocCcpOyAgIC8v0LTQu9GPINC/0L7Qu9C+0LbQuNGC0LXQu9GM0L3QvtCz0L4g0L7RgtCy0LXRgtCwXHJcbiAgICB4aHIuc2VuZChKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbiAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcclxuICAgICAgXHJcbiAgICAgIGlmKHhoci5zdGF0dXM+PTQwMCkge1xyXG4gICAgICAgIGxldCBjb250ZW50ID0gJ9Ce0YjQuNCx0LrQsCwg0LTQsNC90L3Ri9C1INC90LUg0L7RgtC/0YDQsNCy0LvQtdC90YssINC/0L7Qv9GA0L7QsdGD0LnRgtC1INC/0L7Qt9C20LUnO1xyXG4gICAgICAgIGNvbnRlbnRUZXh0LmlubmVySFRNTCA9IGNvbnRlbnQ7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYoeGhyLnJlc3BvbnNlLnN0YXR1cykge1xyXG4gICAgICAgICAgbGV0IGNvbnRlbnQgPSAn0KHQvtC+0LHRidC10L3QuNC1INC+0YLQv9GA0LDQstC70LXQvdC+JztcclxuICAgICAgICAgIGNvbnRlbnRUZXh0LmlubmVySFRNTCA9IGNvbnRlbnQ7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBsZXQgY29udGVudCA9ICfQodC+0LXQtNC40L3QtdC90LjQtSDRgSDRgdC10YDQstC10YDQvtC8INC90LUg0YPRgdGC0LDQvdC+0LLQu9C10L3Qvic7XHJcbiAgICAgICAgICBjb250ZW50VGV4dC5pbm5lckhUTUwgPSBjb250ZW50O1xyXG4gICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgICBcclxuXHRcdGxldCBjbG9zZUljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuXHRcdGNsb3NlSWNvbi5jbGFzc0xpc3QuYWRkKFwicG9wdXBfX2Nsb3NlLWJ1dHRvblwiKTtcclxuXHRcdGNsb3NlSWNvbi5pbm5lckhUTUwgPSAn0JfQsNC60YDRi9GC0YwnO1xyXG5cdFx0Y2xvc2VJY29uLmhyZWYgPSBcIiNcIjtcclxuXHRcdGNsb3NlSWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGZ1bmN0aW9uKGUpe1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdF9jbG9zZVBvcHVwKG92ZXJsYXkpO1xyXG4gICAgfSkpO1xyXG5cclxuXHJcblx0XHRvdmVybGF5LmFwcGVuZENoaWxkKHBvcHVwV2luZG93KTtcclxuXHRcdHBvcHVwV2luZG93LmFwcGVuZENoaWxkKGNvbnRlbnRUZXh0KTtcclxuXHRcdHBvcHVwV2luZG93LmFwcGVuZENoaWxkKGNsb3NlSWNvbik7XHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG92ZXJsYXkpO1xyXG4gIFxyXG5cdH0pO1xyXG5cclxuXHRsZXQgX2Nsb3NlUG9wdXAgPSAoZnVuY3Rpb24ob3ZlcmxheSkge1xyXG5cdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTtcclxuXHR9KTtcclxuXHJcblx0bGV0IGFkZExpc3RlbmVycyA9IChmdW5jdGlvbigpIHtcclxuICAgIHNlbmQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfYWpheElucXVpcnkpXHJcblx0fSk7XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRpbml0OiBhZGRMaXN0ZW5lcnNcclxuXHR9XHJcbn0pO1xyXG5cclxuZm9ybUZ1bmN0aW9uKHtcclxuXHR0ZXh0OiBcIi5yZXZpZXdzX190ZXh0XCJcclxufSkuaW5pdCgpO1xyXG5cclxuXHJcbi8qZW5kIGZvcm0gKi9cclxuXHJcbi8qIHN0YXJ0IGJ1cmdlcl9fY29tcG9zaXRpb24gKi9cclxubGV0IGlzTW9iaWxlID0gKCkgPT4ge1xyXG4gIGxldCBzY3JlZW4gPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7XHJcblx0bGV0IG1vYmlsZSA9IGZhbHNlO1xyXG5cdGlmKHNjcmVlbjw9NzY4KXtcclxuICAgIG1vYmlsZSA9IHRydWU7XHJcbiAgfSBcclxuXHRyZXR1cm4gbW9iaWxlO1xyXG59O1xyXG5cclxubGV0IG1vYmlsZUNvbXBvc2l0aW9uID0gKCkgPT4ge1xyXG5cdFx0bGV0IHNsaWRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1cmdlcicpO1xyXG5cclxuXHRzbGlkZS5vbm1vdXNlZW50ZXIgPSAgZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRsZXQgdGFyZ2V0ID0gZS50YXJnZXQ7XHJcblx0XHRcdGxldCBidXR0b25Db21wb3NpdGlvbiA9IHRhcmdldC5xdWVyeVNlbGVjdG9yQWxsKCcuYnVyZ2VyX19jb21wb3NpdGlvbicpO1xyXG5cdFx0XHRpZih0YXJnZXQuY2xhc3NOYW1lID09ICdidXJnZXJfX2NvbXBvc2l0aW9uJykge1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKCcxMjMnKTtcclxuXHRcdFx0XHRjb25zb2xlLmxvZyhidXR0b25Db21wb3NpdGlvbik7XHJcblx0XHRcdFx0YnV0dG9uQ29tcG9zaXRpb24uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG59O1xyXG5cclxuc2xpZGUub25tb3VzZWxlYXZlID0gZnVuY3Rpb24oZSkge1xyXG5cdGxldCB0YXJnZXQgPSBlLnRhcmdldDtcclxuXHRsZXQgYnV0dG9uQ29tcG9zaXRpb24gPSB0YXJnZXQucXVlcnlTZWxlY3RvcignLmJ1cmdlcl9fY29tcG9zaXRpb24nKTtcclxuXHRpZihidXR0b25Db21wb3NpdGlvbikge1xyXG5cdFx0YnV0dG9uQ29tcG9zaXRpb24uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcblx0fSBlbHNlIHtcclxuXHRcdHJldHVybjtcclxuXHR9XHJcblx0XHJcbn1cclxuXHJcblxyXG5cclxuLypcclxuXHRcdGJ1dHRvbkNsb3NlQ29tcG9zaXRpb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdFx0YnV0dG9uQ29tcG9zaXRpb24uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcblx0XHR9KTtcclxuXHJcblxyXG5cdFx0YnV0dG9uQ2xvc2VDb21wb3NpdGlvbi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZSA9PiB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRcdGJ1dHRvbkNvbXBvc2l0aW9uLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0aWYgKGlzTW9iaWxlKSB7XHJcblx0XHRcdGJ1dHRvbkNvbXBvc2l0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcblx0XHRcdFx0YnV0dG9uQ29tcG9zaXRpb24uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFxyXG5cclxuXHRcdGxldCBfcmVtb3ZlQ2xhc3MgPSAoKSA9PiB7XHJcblx0XHRcdGJ1dHRvbkNvbXBvc2l0aW9uLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZvciAoaT0wO2k8YnV0dG9uQ29tcG9zaXRpb25BbGwubGVuZ3RoO2krKyl7XHJcblx0XHRcdGJ1dHRvbkNvbXBvc2l0aW9uQWxsW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCBfYWRkQ2xhc3MpO1xyXG5cdFx0XHRidXR0b25Db21wb3NpdGlvbkFsbFtpXS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgX3JlbW92ZUNsYXNzKTtcclxuXHRcdH1cclxuKi9cclxuXHR9O1xyXG5cclxuXHRtb2JpbGVDb21wb3NpdGlvbigpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcbi8qIGVuZCBidXJnZXJfX2NvbXBvc2l0aW9uKi9cclxuXHJcbi8qIHNsaWRlciovXHJcblxyXG5sZXQgc2xpZGVyID0gb3B0aW9ucyA9PiB7XHJcblx0bGV0IHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMud3JhcHBlcik7XHJcblx0bGV0IHdpZHRoID0gd3JhcHBlci5jbGllbnRXaWR0aDtcclxuXHR3cmFwcGVyLnN0eWxlLndpZHRoID0gd2lkdGggICsgJ3B4JztcclxuXHRsZXQgc3RlcCA9IHdpZHRoO1xyXG5cdGxldCBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLmxpc3QpO1xyXG5cdGxldCBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwob3B0aW9ucy5pdGVtKTtcclxuXHJcblx0bGV0IGxlZnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMubGVmdCk7XHJcblx0bGV0IHJpZ2h0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLnJpZ2h0KTtcclxuXHJcblx0aXRlbXMuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuXHRcdGVsZW1lbnQuc3R5bGUud2lkdGggPSB3aWR0aCAgKyAncHgnO1xyXG5cdH0pO1xyXG5cclxuXHRsZXQgcG9zaXRpb25NYXhSaWdodCA9IHdpZHRoICogKGl0ZW1zLmxlbmd0aCAtIDEpO1xyXG5cclxuXHRsZXQgcG9zaXRpb25SaWdodCA9IDA7XHJcblxyXG5cdGxldCBfcmlnaHQgPSBwb3NpdGlvbiA9PiB7XHJcblx0XHRpZiAocG9zaXRpb24gPD0gcG9zaXRpb25NYXhSaWdodCkge1xyXG5cdFx0XHRwb3NpdGlvblJpZ2h0ID0gcG9zaXRpb25SaWdodCArIHN0ZXA7XHJcblx0XHRcdGxpc3Quc3R5bGUucmlnaHQgPSBwb3NpdGlvblJpZ2h0ICsgXCJweFwiO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGxldCBfbGVmdCA9IHBvc2l0aW9uID0+IHtcclxuXHRcdGlmIChwb3NpdGlvbiA+PSAwKSB7XHJcblx0XHRcdHBvc2l0aW9uUmlnaHQgPSBwb3NpdGlvblJpZ2h0IC0gc3RlcDtcclxuXHRcdFx0bGlzdC5zdHlsZS5yaWdodCA9IHBvc2l0aW9uUmlnaHQgKyBcInB4XCI7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0bGV0IGluaXRpYWwgPSAoKSA9PiB7XHJcblx0XHRsaXN0LnN0eWxlLnJpZ2h0ID0gcG9zaXRpb25SaWdodDtcclxuXHJcblx0XHRyaWdodC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRcdF9yaWdodChwb3NpdGlvblJpZ2h0ICsgc3RlcCk7XHJcblx0XHR9KTtcclxuXHJcblx0XHRsZWZ0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdFx0X2xlZnQocG9zaXRpb25SaWdodCAtIHN0ZXApO1xyXG5cdFx0fSk7XHJcblxyXG5cdH07XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRpbml0OiBpbml0aWFsXHJcblx0fVxyXG59O1xyXG5cclxuc2xpZGVyKHtcclxuXHR3cmFwcGVyOiAnLmJ1cmdlcl9fd3JhcHBlcicsXHJcblx0bGlzdDogJy5idXJnZXJfX2xpc3QnLFxyXG5cdGl0ZW06ICcuYnVyZ2VyX19pdGVtJyxcclxuXHRyaWdodDogJy5idXJnZXJfX2Fycm93cy1pdGVtLS1yaWdodCcsXHJcblx0bGVmdDogJy5idXJnZXJfX2Fycm93cy1pdGVtLS1sZWZ0J1xyXG59KS5pbml0KCk7XHJcblxyXG5cclxuXHJcbi8qZW5kIHNsaWRlciovXHJcblxyXG5cclxuLypzdGFydCBtYXAgKi9cclxueW1hcHMucmVhZHkoaW5pdCk7XHJcblxyXG5mdW5jdGlvbiBpbml0KCkge1xyXG5cdHZhciBtYXAgPSBuZXcgeW1hcHMuTWFwKCdtYXAnLCB7XHJcblx0XHRjZW50ZXI6IFs1OS45NCwgMzAuMzJdLFxyXG5cdFx0em9vbTogMTIsXHJcblx0XHRjb250cm9sczogWyd6b29tQ29udHJvbCddLFxyXG5cdFx0YmVoYXZpb3JzOiBbJ2RyYWcnXVxyXG5cdH0pO1xyXG5cclxuXHR2YXIgcGxhY2VtYXJrID0gbmV3IHltYXBzLlBsYWNlbWFyayhbNTkuOTcsIDMwLjMxXSwge1xyXG5cdFx0XHRoaW50Q29udGVudDogJ9GD0LsuINCb0LjRgtC10YDQsNGC0L7RgNC+0LIsINC00L7QvCAxMCcsXHJcblx0XHRcdGJhbGxvb25Db250ZW50OiAn0KHQsNC80YvQtSDQstC60YPRgdC90YvQtSDQsdGD0YDQs9C10YDRiyDRgyDQvdCw0YEhJ1xyXG5cdH0sXHJcblx0e1xyXG5cdFx0aWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxyXG5cdFx0aWNvbkltYWdlSHJlZjogJ2ltYWdlcy9pY29ucy9tYXAtbWFya2VyLnN2ZycsXHJcblx0XHRpY29uSW1hZ2VTaXplOiBbNDYsIDU3XVxyXG5cdH1cclxuXHJcbik7XHJcblx0bWFwLmdlb09iamVjdHMuYWRkKHBsYWNlbWFyayk7XHJcbn1cclxuXHJcbi8qZW5kIG1hcCAqLyJdfQ==
